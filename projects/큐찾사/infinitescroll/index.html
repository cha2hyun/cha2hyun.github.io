<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기 | 채수현 개발일지</title><meta name=keywords content="Next.js,React Query,Infinite Scroll"><meta name=description content="React Query의 InfiniteScroll을 적용하는 방법과 상세페이지에 들어갔다 나올때 스크롤 위치를 저장하는 방법에 대해 소개합니다."><meta name=author content="cha2hyun"><link rel=canonical href=https://cha2hyun.github.io/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/><link crossorigin=anonymous href=/assets/css/stylesheet.e2c4e45c227cff2d0b236143ff7f2e39b6a7f2bd2019a845c0f754cd1b58fa1f.css integrity="sha256-4sTkXCJ8/y0LI2FD/38uOban8r0gGahFwPdUzRtY+h8=" rel="preload stylesheet" as=style><link rel=icon href=https://cha2hyun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cha2hyun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cha2hyun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cha2hyun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cha2hyun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기"><meta property="og:description" content="React Query의 InfiniteScroll을 적용하는 방법과 상세페이지에 들어갔다 나올때 스크롤 위치를 저장하는 방법에 대해 소개합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://cha2hyun.github.io/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/"><meta property="og:image" content="https://cha2hyun.github.io/papermod-cover.png"><meta property="article:section" content="projects"><meta property="article:published_time" content="2022-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-04T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cha2hyun.github.io/papermod-cover.png"><meta name=twitter:title content="Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기"><meta name=twitter:description content="React Query의 InfiniteScroll을 적용하는 방법과 상세페이지에 들어갔다 나올때 스크롤 위치를 저장하는 방법에 대해 소개합니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"https://cha2hyun.github.io/projects/"},{"@type":"ListItem","position":3,"name":"Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기","item":"https://cha2hyun.github.io/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기","name":"Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기","description":"React Query의 InfiniteScroll을 적용하는 방법과 상세페이지에 들어갔다 나올때 스크롤 위치를 저장하는 방법에 대해 소개합니다.","keywords":["Next.js","React Query","Infinite Scroll"],"articleBody":"\n들어가며 새로운 홈페이지를 기획, 개발하면서 최대한 앱과 동일한 사용자 경험을 주기 위해 고민을 많이 했습니다. 오랫동안 준비했던 apppage_v2의 경우 react로 제작하였으며 일반적인 페지네이션을 이용했습니다. 다만, 일반적인 페지네이션으로는 모바일에서 앱과 같은 경험을 주지 못하는 점이 아쉬워 아예 새롭게 Next.js로 프로젝트를 새로 만들어서 React Query의 infiniteScroll을 도입하였습니다. infiniteScroll을 도입하면서 배운 내용들을 다룹니다. 속도가 중요한 것은 Modal로 표시하고 상호작용이 중요한 것은 Link로 페이지 이동하였습니다. 이미지 캐싱을 위한 방법과 불러온 데이터를 효과적으로 저장하는 방법에 대해서 알아봅니다. API는 장고로 만들었으며 풀스택으로 내용을 다룹니다.\n고치는 것 보다 새로 만드는게 더 빠른…\nCustom Modal vs Link 무한 스크롤을 도입할 때 다음과 같은 내용이 고려되었습니다.\n무한 스크롤이 적용된 리스트를 클릭했을때 어떤 식으로 상세페이지를 제공할 것인가? 상세페이지에서 다시 리스트로 돌아갈때 이미 불러온 데이터를 다시 불러오지 않아야한다. 2번이 적용된다면 다시 리스트로 돌아갈때 스크롤 했던 위치로 돌아가져야한다. 무한 스크롤이 도입될 곳은 내큐찾기와 커뮤니티 였습니다. 다만 두 카테고리는 각자 다른 특성을 가지고 있습니다. 서비스 핵심 모델이 적요되는 내큐찾기에서는 최대한 빠르게 유저에게 로딩되는 경험을 주어야하고, 커뮤니티에서는 댓글, 답글 등의 추가 기능들이 필요했습니다.\n속도가 중요한 내큐찾기에는 Modal 을 이용하였으며, API 상호작용 및 새로고침이 필요한 커뮤니티에서는 새로운 페이지로 이동하고 뒤로가기 시에 LocalStorage를 참조하여 저장된 ScrollY값으로 스크롤 이동되게 하였습니다.\n내큐찾기 (적용된 페이지)\n페이지 이동없이 Modal이 보여지는 형식으로 제공한다. Modal이 열릴때 따로 API에서 정보 불러오지 않고 즉시 보여질 수 있도록 리스트 불러올 때 API를 모달안의 정보까지 제공할 수 있도록 제작한다. 한번 불러온 이미지나 캐시에 남겨 로딩할 때도 매우빠른 로딩속도를 제공한다. 스크롤 시 마지막 아이템이 보여질 때 마다 Fade in 애니메이션을 적용하여 로딩이 즉각적으로 되는 것처럼 보여지게 한다. Infinite Scroll + Modal + aos fadein\n커뮤니티 (적용된 페이지)\nList에서 Item 클릭 시 새로운 상세페이지로 이동 이동할때 이때 LocalStoarge에 scrollY 값을 저장 상세페이지에서 다시 리스트로 돌아올 때 scrollY 값으로 스크롤 위치 이동 단, 이때 처음부터 List를 다시 불러온다면 저장된 scrollY 값으로 가질 수 없으므로 (1번 이상 추가로딩이 되었을 경우) 리스트 데이터는 새로 불러오면 안된다. Infinite Scroll + Link + LocalStorage\nAPI 준비 API는 Django를 사용합니다. ModelViewSet을 사용하였으며 LimitOffsetPagination을 적용하였습니다.\n일반적인 페이지 페지네이션의 경우 사용자가 다음 리스트를 불러오기 전에 새로운 아이템이 1개가 등록되고 리스트를 불러온다면 중복되는 아이템이 표시될 수 있으므로 offset pagination을 적용하여 전체 게시글이 늘었는지 확인하고 늘은 만큼 offset을 추가로 더해주어야 중복되는 아이템을 방지할 수 있습니다.\n리스트에서 로딩될 필터링 조건을 parameter 로 받기 위해 queryset을 변경하는 과정이 필요하였습니다. offset또한 파라미터로 받아옵니다.\nviews.py views.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class someview(viewsets.ModelViewSet): queryset = somemodel.objects.exclude(Q(something)).prefetch_related(Prefetch(something)).all() permission_classes = somepermission serializer_class = someSerializer pagination_class = LimitOffsetPagination filter_backends = (somefilters) ordering_fields = ('created_at','id') ordering = ('-created_at') search_fields = ['$title', '$content'] filterset_fields = ('__all__') def get_queryset(self): qs = super().get_queryset() # some condition return qs.filter(Query) 리턴 예시\nGET 1 2 3 4 5 6 7 8 { \"count\": 131, \"next\": \"api주소/?limit=20\u0026offset=55\u0026필터링조건\", \"previous\": \"api주소/?limit=20\u0026offset=15\u0026필터링조건\", \"results\":[ ... ] } infiniteScroll 설치 및 준비 react-qeury를 설치해줍니다. 사용된 버전은 다음과 같습니다.\npackage.json 1 2 3 ... \"react-query\": \"^3.39.2\", ... Hydration을 통해 SSR(Server Side Rendering)을 할 수 도 있지만, 시도해본 결과 매 뒤로가기시 캐싱되지 않는 문제가 있었습니다. 정확히 말하면 이미 로딩했던 내용들을 다시 처음부터 로딩해야 했습니다. 내큐찾기 처럼 모달을 사용할 경우 Hydration 사용해도 지장없지만, 페이지 이동이 필요한 경우 해당 방법을 사용하면 비효율적입니다.\n_app.tsx (Hydration) _app.tsx (Hydration) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 /* eslint-disable @typescript-eslint/no-explicit-any */ import AOS from \"aos\"; import Head from \"next/head\"; import { SessionProvider } from \"next-auth/react\"; import React, { useEffect } from \"react\"; import { QueryClient, QueryClientProvider } from \"react-query\"; import \"@/styles/aos.scss\"; import \"@/styles/globals.css\"; import \"@/styles/colors.css\"; const MyApp: NextComponentType\u003cAppContext, AppInitialProps, AppProps\u003e = ({ Component, pageProps, }) =\u003e { const queryClientRef = React.useRef\u003cQueryClient\u003e(); if (!queryClientRef.current) { queryClientRef.current = new QueryClient(); } useEffect(() =\u003e { AOS.init({ once: true, duration: 500, easing: \"ease-out-cubic\", }); }); return ( \u003c\u003e \u003cQueryClientProvider client={queryClientRef.current}\u003e \u003cHydrate state={pageProps.dehydratedState}\u003e \u003cComponent {...pageProps} /\u003e \u003c/Hydrate\u003e {/* */} \u003c/QueryClientProvider\u003e \u003c/\u003e ); }; MyApp.getInitialProps = async ({ Component, ctx, }: AppContext): Promise\u003cAppInitialProps\u003e =\u003e { let pageProps = {}; if (Component.getInitialProps) { pageProps = await Component.getInitialProps(ctx); } return { pageProps }; }; export default MyApp; 따라서 최종적으로 다음과 같이 적용했습니다. 중간에 meta 태그는 아이폰에서 모달이 열릴때 가로폭이 고정되지 않는 문제점을 해결하기 위해 넣었으며 따로 meta tag를 관리하는 컴포넌트가 있으면 추가해주시면 됩니다. 커뮤니티에서 댓글 작성이 로그인 여부를 확인하기 때문에 SessionProvider (next-auth)가 있습니다. 로그인 구현이 필요 없다면 넘기셔도 됩니다.\n_app.tsx _app.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 /* eslint-disable @typescript-eslint/no-explicit-any */ import AOS from \"aos\"; import Head from \"next/head\"; import { SessionProvider } from \"next-auth/react\"; import React, { useEffect } from \"react\"; import { QueryClient, QueryClientProvider } from \"react-query\"; import \"@/styles/aos.scss\"; import \"@/styles/globals.css\"; import \"@/styles/colors.css\"; const MyApp = ({ Component, pageProps: { session, ...pageProps }, }: { Component: any; pageProps: any; }) =\u003e { const [queryClient] = React.useState(() =\u003e new QueryClient()); // AOS 애니메이션 적용 useEffect(() =\u003e { AOS.init({ once: true, duration: 500, easing: \"ease-out-cubic\", }); }); (\"\"); return ( // next-auth 로그인 세션을 위해 사용됨 \u003cSessionProvider session={session}\u003e \u003cHead\u003e {/* 아이폰 가로값 고정되지 않는 이슈 해결 */} \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover\" /\u003e \u003c/Head\u003e {/* infiniteScroll 위해 선언 */} \u003cQueryClientProvider client={queryClient}\u003e {/* PageProps 표시 영역 */} \u003cComponent {...pageProps} /\u003e {/* Debug 모드에서만 활용할 devtools */} {/* import { ReactQueryDevtools } from 'react-query/devtools'; */} \u003c/QueryClientProvider\u003e \u003c/SessionProvider\u003e ); }; export default MyApp; 무한 로딩 리스트를 구현하는 큰 뼈대는 다음과 같습니다. 당연히 코드가 돌아가지 않으므로 참고만 해주시면 됩니다.\nInfiniteListSkeleton.tsx InfiniteListSkeleton.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 const InfiniteListSkeleton = ('필터링 될 내용들') =\u003e { const { data, hasNextPage, fetchNextPage, refetch, isFetching } = useInfiniteQuery( 'some', ({ pageParam = '' }) =\u003e // FetchList 함수는 axios로 api에 request 보내는 함수입니다. (파라미터로 필터링 될 내용을 받습니다.) FetchList( pageParam, '필터링 될 내용들' ), { // 다음 페이지는 offset 으로 확인합니다. getNextPageParam: (lastPage) =\u003e { if (lastPage.next === null) { return undefined; } const url = new URL(lastPage.next); const lastOffset = url.searchParams.get('offset'); if (lastOffset) { return parseInt(lastOffset); } else { return undefined; } }, staleTime: 60 * 1000, cacheTime: 60 * 1000, keepPreviousData: true, refetchOnMount: false, refetchOnWindowFocus: false, } ); // 1. 모달로 오픈할 거면 (커스텀 훅) const dialog = useDialog(); const openModal = (props: Results) =\u003e { dialog({ title: '', description: \u003c\u003e\u003c/\u003e, catchOnCancel: true, submitText: '네', cancleText: '닫기', variant: 'warning', props: props, }) .then() .catch(); return \u003c\u003e\u003c/\u003e; }; // 2. 페이지 이동후 스크롤 Y 값을 저장하여 해당 위치로 바로 보여지게 할 경우 const [scrollY, setScrollY] = useLocalStorage('someScroll', 0); React.useEffect(() =\u003e { if (scrollY !== 0) { window.scrollTo(0, Number(scrollY)); setScrollY(0); } // eslint-disable-next-line react-hooks/exhaustive-deps }, []); // 필터가 적용되면 offset을 초기화하고 처음부터 로딩되어야 합니다. React.useEffect(() =\u003e { if (isRefreshing) { refetch(); } setIsRefreshing(false); }, [isRefreshing, refetch, setIsRefreshing]); // useRef를 이용하여 해당 Ref를 하단에 두고 보여지면 다음 페이지를 로딩합니다. const loadMoreButtonRef = React.useRef(null); useIntersectionObserver({ root: null, target: loadMoreButtonRef, onIntersect: fetchNextPage, enabled: hasNextPage, }); return ( \u003c\u003e \u003cul\u003e {/* 로딩중일때 */} {isFetching \u0026\u0026 \u003cLoadingDiv /\u003e} {/* 리스트를 표시합ㄴ디ㅏ. */} {data?.pages.map((page) =\u003e page.results.map((props: Results) =\u003e ( // data-aos 로 애니메이션 효과를 줍니다. (라이브러리 설치 필요)) \u003cli key={props.id} data-aos='fade-up' data-aos-duration='200'\u003e {/* 1. 모달로 오픈할꺼면 */} \u003cdiv onClick={() =\u003e openModal(props)}\u003e Click ${props.id} to open Modal \u003c/div\u003e {/* 2. 페이지 이동할거면 */} \u003cLink href={{ pathname: `url/${props.id}`, query: { props: JSON.stringify(props) }, }} as={`url/${props.id}`} passHref \u003e \u003ca href={`url/${props.id}`} onClick={() =\u003e setScrollY(window.scrollY)} \u003e \u003cdiv\u003eClick ${props.id} to navigate\u003c/div\u003e \u003c/a\u003e \u003c/Link\u003e \u003c/li\u003e )))} \u003c/ul\u003e {/* 로딩중 표시를 하고 ref가 focus 될때 (리스트의 끝일때) 마다 다음 리스트를 로딩합니다. */} {hasNextPage \u0026\u0026 ( \u003c\u003e \u003cLoadingDiv /\u003e \u003cbutton onClick={() =\u003e fetchNextPage()} className='text-center' /\u003e \u003c/\u003e )} \u003cdiv ref={loadMoreButtonRef} /\u003e \u003c/\u003e ); }; export default InfiniteListSkeleton; infiniteScroll + Modal [내큐찾기] 계속 …\ninfiniteScroll + LocalStorage + ScrollY [커뮤니티] 계속 …\n","wordCount":"1422","inLanguage":"en","datePublished":"2022-11-04T00:00:00Z","dateModified":"2022-11-04T00:00:00Z","author":{"@type":"Person","name":"cha2hyun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cha2hyun.github.io/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/"},"publisher":{"@type":"Organization","name":"채수현 개발일지","logo":{"@type":"ImageObject","url":"https://cha2hyun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div><div class=logo><a href=https://cha2hyun.github.io/ accesskey=h title="채수현 개발일지 (Alt + H)">채수현 개발일지<span style=justify-content:center>
<img src="https://visitor-badge.glitch.me/badge?page_id=cha2hyun.github.io&left_color=black&right_color=black&left_text=HITS" alt=Views></span></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><div class=logo style=margin-bottom:-30px;margin-top:-30px;font-size:15px><span>기억은 유한하나, 기록은 무한하다 📚</span></div></div><ul id=menu><li><a href=https://cha2hyun.github.io/projects/ title=프로젝트><span style=font-weight:700>프로젝트</span></a></li><li><a href=https://cha2hyun.github.io/algorithm/ title=알고리즘><span style=font-weight:700>알고리즘</span></a></li><li><a href=https://cha2hyun.github.io/posts/ title=블로그><span style=font-weight:700>블로그</span></a></li><li><a href=https://cha2hyun.github.io/search/ title=검색><span style=font-weight:700>검색</span></a></li><li><a href=https://cha2hyun.github.io/tags/ title=태그><span style=font-weight:700>태그</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs></div><a href=https://cha2hyun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://cha2hyun.github.io/projects/>Projects</a></div><h1 class=post-title>Next.js] InfiniteScroll 리스트의 아이템을 Modal로 열거나 LocalStorage를 이용해 스크롤된 위치 기억하기</h1><div class=post-meta><div class=views style=margin-right:8px><span class=views><img src="https://visitor-badge.glitch.me/badge?page_id=https%3a%2f%2fcha2hyun.github.io%2fprojects%2f%25ED%2581%2590%25EC%25B0%25BE%25EC%2582%25AC%2finfinitescroll%2f&left_color=gray&right_color=gray&left_text=Article Hits" alt=Views></span></div><span title='2022-11-04 00:00:00 +0000 UTC'>November 4, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;cha2hyun</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0 aria-label=들어가며>들어가며</a></li><li><a href=#custom-modal-vs-link aria-label="Custom Modal vs Link"><code>Custom Modal</code> vs <code>Link</code></a></li><li><a href=#api-%ec%a4%80%eb%b9%84 aria-label="API 준비">API 준비</a><ul><li><a href=#viewspy aria-label=views.py><code>views.py</code></a></li></ul></li><li><a href=#infinitescroll-%ec%84%a4%ec%b9%98-%eb%b0%8f-%ec%a4%80%eb%b9%84 aria-label="infiniteScroll 설치 및 준비"><code>infiniteScroll</code> 설치 및 준비</a><ul><li><a href=#_apptsx-hydration aria-label="_app.tsx (Hydration)"><code>_app.tsx (Hydration)</code></a></li><li><a href=#_apptsx aria-label=_app.tsx><code>_app.tsx</code></a></li><li><a href=#infinitelistskeletontsx aria-label=InfiniteListSkeleton.tsx><code>InfiniteListSkeleton.tsx</code></a></li></ul></li><li><a href=#infinitescroll--modal-%eb%82%b4%ed%81%90%ec%b0%be%ea%b8%b0 aria-label="infiniteScroll + Modal [내큐찾기]"><code>infiniteScroll</code> + <code>Modal</code> [내큐찾기]</a></li><li><a href=#infinitescroll--localstorage--scrolly-%ec%bb%a4%eb%ae%a4%eb%8b%88%ed%8b%b0 aria-label="infiniteScroll + LocalStorage + ScrollY [커뮤니티]"><code>infiniteScroll</code> + <code>LocalStorage</code> + <code>ScrollY</code> [커뮤니티]</a></li></ul></div></details></div><div class=post-content><br><h3 id=들어가며>들어가며<a hidden class=anchor aria-hidden=true href=#들어가며>#</a></h3><p>새로운 홈페이지를 기획, 개발하면서 최대한 <code>앱</code>과 동일한 사용자 경험을 주기 위해 고민을 많이 했습니다. 오랫동안 준비했던 <code>apppage_v2</code>의 경우 <code>react</code>로 제작하였으며 일반적인 페지네이션을 이용했습니다. 다만, 일반적인 페지네이션으로는 모바일에서 <code>앱</code>과 같은 경험을 주지 못하는 점이 아쉬워 아예 새롭게 <code>Next.js</code>로 프로젝트를 새로 만들어서 <code>React Query</code>의 <code>infiniteScroll</code>을 도입하였습니다. <code>infiniteScroll</code>을 도입하면서 배운 내용들을 다룹니다. 속도가 중요한 것은 Modal로 표시하고 상호작용이 중요한 것은 Link로 페이지 이동하였습니다. 이미지 캐싱을 위한 방법과 불러온 데이터를 효과적으로 저장하는 방법에 대해서 알아봅니다. API는 장고로 만들었으며 풀스택으로 내용을 다룹니다.</p><p><figure class=align-center><img loading=lazy src=../img/1.png#center alt="고치는 것 보다 새로 만드는게 더 빠른&amp;hellip;"><figcaption><p>고치는 것 보다 새로 만드는게 더 빠른&mldr;</p></figcaption></figure><br></p><h3 id=custom-modal-vs-link><code>Custom Modal</code> vs <code>Link</code><a hidden class=anchor aria-hidden=true href=#custom-modal-vs-link>#</a></h3><p>무한 스크롤을 도입할 때 다음과 같은 내용이 고려되었습니다.</p><ol><li>무한 스크롤이 적용된 리스트를 클릭했을때 어떤 식으로 상세페이지를 제공할 것인가?</li><li>상세페이지에서 다시 리스트로 돌아갈때 이미 불러온 데이터를 다시 불러오지 않아야한다.</li><li>2번이 적용된다면 다시 리스트로 돌아갈때 스크롤 했던 위치로 돌아가져야한다.</li></ol><p>무한 스크롤이 도입될 곳은 <code>내큐찾기</code>와 <code>커뮤니티</code> 였습니다. 다만 두 카테고리는 각자 다른 특성을 가지고 있습니다. 서비스 핵심 모델이 적요되는 <code>내큐찾기</code>에서는 최대한 빠르게 유저에게 로딩되는 경험을 주어야하고, <code>커뮤니티</code>에서는 댓글, 답글 등의 추가 기능들이 필요했습니다.</p><p>속도가 중요한 <code>내큐찾기</code>에는 <code>Modal</code> 을 이용하였으며, API 상호작용 및 새로고침이 필요한 <code>커뮤니티</code>에서는 <code>새로운 페이지</code>로 이동하고 뒤로가기 시에 LocalStorage를 참조하여 저장된 ScrollY값으로 스크롤 이동되게 하였습니다.</p><p><strong>내큐찾기</strong> <a href=http://kimchibilliards.synology.me:3001/findcue target=_blank>(적용된 페이지)</a></p><ul><li>페이지 이동없이 <code>Modal</code>이 보여지는 형식으로 제공한다.</li><li><code>Modal</code>이 열릴때 따로 API에서 정보 불러오지 않고 즉시 보여질 수 있도록 리스트 불러올 때 API를 모달안의 정보까지 제공할 수 있도록 제작한다.</li><li>한번 불러온 이미지나 <code>캐시</code>에 남겨 로딩할 때도 매우빠른 로딩속도를 제공한다.</li><li>스크롤 시 마지막 아이템이 보여질 때 마다 Fade in 애니메이션을 적용하여 로딩이 즉각적으로 되는 것처럼 보여지게 한다.</li></ul><figure class=align-center><img loading=lazy src=../img/2.gif#center alt="Infinite Scroll + Modal + aos fadein"><figcaption><p><code>Infinite Scroll</code> + <code>Modal</code> + <code>aos fadein</code></p></figcaption></figure><p><strong>커뮤니티</strong> <a href=http://kimchibilliards.synology.me:3001/community target=_blank>(적용된 페이지)</a></p><ul><li><code>List</code>에서 <code>Item</code> 클릭 시 <code>새로운 상세페이지</code>로 이동</li><li>이동할때 이때 <code>LocalStoarge</code>에 <code>scrollY</code> 값을 저장</li><li>상세페이지에서 다시 리스트로 돌아올 때 <code>scrollY 값으로 스크롤 위치 이동</code></li><li>단, 이때 처음부터 List를 다시 불러온다면 저장된 scrollY 값으로 가질 수 없으므로 (1번 이상 추가로딩이 되었을 경우) <code>리스트 데이터는 새로 불러오면 안된다</code>.</li></ul><figure class=align-center><img loading=lazy src=../img/3.gif#center alt="Infinite Scroll + Link + LocalStorage"><figcaption><p><code>Infinite Scroll</code> + <code>Link</code> + <code>LocalStorage</code></p></figcaption></figure><br><h3 id=api-준비>API 준비<a hidden class=anchor aria-hidden=true href=#api-준비>#</a></h3><p>API는 Django를 사용합니다. ModelViewSet을 사용하였으며 <code>LimitOffsetPagination</code>을 적용하였습니다.</p><p>일반적인 페이지 페지네이션의 경우 사용자가 다음 리스트를 불러오기 전에 새로운 아이템이 1개가 등록되고 리스트를 불러온다면 중복되는 아이템이 표시될 수 있으므로 offset pagination을 적용하여 전체 게시글이 늘었는지 확인하고 늘은 만큼 offset을 추가로 더해주어야 중복되는 아이템을 방지할 수 있습니다.</p><p>리스트에서 로딩될 <code>필터링 조건</code>을 <code>parameter</code> 로 받기 위해 queryset을 변경하는 과정이 필요하였습니다. <code>offset</code>또한 파라미터로 받아옵니다.</p><h4 id=viewspy><code>views.py</code><a hidden class=anchor aria-hidden=true href=#viewspy>#</a></h4><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>views.py</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>someview</span><span class=p>(</span><span class=n>viewsets</span><span class=o>.</span><span class=n>ModelViewSet</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>queryset</span> <span class=o>=</span> <span class=n>somemodel</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>exclude</span><span class=p>(</span><span class=n>Q</span><span class=p>(</span><span class=n>something</span><span class=p>))</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=n>Prefetch</span><span class=p>(</span><span class=n>something</span><span class=p>))</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>permission_classes</span> <span class=o>=</span> <span class=n>somepermission</span>
</span></span><span class=line><span class=cl>    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>someSerializer</span>
</span></span><span class=line><span class=cl>    <span class=n>pagination_class</span> <span class=o>=</span> <span class=n>LimitOffsetPagination</span>
</span></span><span class=line><span class=cl>    <span class=n>filter_backends</span> <span class=o>=</span> <span class=p>(</span><span class=n>somefilters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ordering_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;created_at&#39;</span><span class=p>,</span><span class=s1>&#39;id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ordering</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;-created_at&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>search_fields</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;$title&#39;</span><span class=p>,</span> <span class=s1>&#39;$content&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>filterset_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;__all__&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_queryset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>qs</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>get_queryset</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># some condition</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>qs</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>Query</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><p>리턴 예시</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>GET</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Json data-lang=Json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;count&#34;</span><span class=p>:</span> <span class=mi>131</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;next&#34;</span><span class=p>:</span> <span class=s2>&#34;api주소/?limit=20&amp;offset=55&amp;필터링조건&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;previous&#34;</span><span class=p>:</span> <span class=s2>&#34;api주소/?limit=20&amp;offset=15&amp;필터링조건&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;results&#34;</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>        <span class=err>...</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><h3 id=infinitescroll-설치-및-준비><code>infiniteScroll</code> 설치 및 준비<a hidden class=anchor aria-hidden=true href=#infinitescroll-설치-및-준비>#</a></h3><p>react-qeury를 설치해줍니다. 사용된 버전은 다음과 같습니다.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>package.json</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Json data-lang=Json><span class=line><span class=cl><span class=err>...</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;react-query&#34;</span><span class=err>:</span> <span class=s2>&#34;^3.39.2&#34;</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><p>Hydration을 통해 SSR(Server Side Rendering)을 할 수 도 있지만, 시도해본 결과 매 뒤로가기시 <code>캐싱되지 않는 문제</code>가 있었습니다. 정확히 말하면 이미 로딩했던 내용들을 다시 처음부터 로딩해야 했습니다. 내큐찾기 처럼 모달을 사용할 경우 Hydration 사용해도 지장없지만, 페이지 이동이 필요한 경우 해당 방법을 사용하면 비효율적입니다.</p><h4 id=_apptsx-hydration><code>_app.tsx (Hydration)</code><a hidden class=anchor aria-hidden=true href=#_apptsx-hydration>#</a></h4><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>_app.tsx (Hydration)</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=cm>/* eslint-disable @typescript-eslint/no-explicit-any */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>AOS</span> <span class=kr>from</span> <span class=s2>&#34;aos&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Head</span> <span class=kr>from</span> <span class=s2>&#34;next/head&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>SessionProvider</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;next-auth/react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QueryClient</span><span class=p>,</span> <span class=nx>QueryClientProvider</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;react-query&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/aos.scss&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/globals.css&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/colors.css&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>MyApp</span>: <span class=kt>NextComponentType</span><span class=p>&lt;</span><span class=nt>AppContext</span><span class=err>,</span> <span class=na>AppInitialProps</span><span class=err>,</span> <span class=na>AppProps</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>Component</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>pageProps</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>queryClientRef</span> <span class=o>=</span> <span class=nx>React</span><span class=p>.</span><span class=nx>useRef</span><span class=p>&lt;</span><span class=nt>QueryClient</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>queryClientRef</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>queryClientRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>AOS</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>once</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>easing</span><span class=o>:</span> <span class=s2>&#34;ease-out-cubic&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>QueryClientProvider</span> <span class=na>client</span><span class=o>=</span><span class=p>{</span><span class=nx>queryClientRef</span><span class=p>.</span><span class=nx>current</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Hydrate</span> <span class=na>state</span><span class=o>=</span><span class=p>{</span><span class=nx>pageProps</span><span class=p>.</span><span class=nx>dehydratedState</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Component</span> <span class=p>{</span><span class=na>...pageProps</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>Hydrate</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* &lt;ReactQueryDevtools /&gt; */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>QueryClientProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>MyApp</span><span class=p>.</span><span class=nx>getInitialProps</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>Component</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=o>:</span> <span class=nx>AppContext</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>AppInitialProps</span><span class=p>&gt;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>pageProps</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>Component</span><span class=p>.</span><span class=nx>getInitialProps</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pageProps</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Component</span><span class=p>.</span><span class=nx>getInitialProps</span><span class=p>(</span><span class=nx>ctx</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>pageProps</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>MyApp</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><p>따라서 최종적으로 다음과 같이 적용했습니다. 중간에 <code>meta</code> 태그는 아이폰에서 모달이 열릴때 가로폭이 고정되지 않는 문제점을 해결하기 위해 넣었으며 따로 meta tag를 관리하는 컴포넌트가 있으면 추가해주시면 됩니다. 커뮤니티에서 댓글 작성이 로그인 여부를 확인하기 때문에 <code>SessionProvider (next-auth)</code>가 있습니다. 로그인 구현이 필요 없다면 넘기셔도 됩니다.</p><h4 id=_apptsx><code>_app.tsx</code><a hidden class=anchor aria-hidden=true href=#_apptsx>#</a></h4><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>_app.tsx</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=cm>/* eslint-disable @typescript-eslint/no-explicit-any */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>AOS</span> <span class=kr>from</span> <span class=s2>&#34;aos&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Head</span> <span class=kr>from</span> <span class=s2>&#34;next/head&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>SessionProvider</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;next-auth/react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QueryClient</span><span class=p>,</span> <span class=nx>QueryClientProvider</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;react-query&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/aos.scss&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/globals.css&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;@/styles/colors.css&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>MyApp</span> <span class=o>=</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>Component</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>pageProps</span><span class=o>:</span> <span class=p>{</span> <span class=nx>session</span><span class=p>,</span> <span class=p>...</span><span class=nx>pageProps</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>Component</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>pageProps</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>queryClient</span><span class=p>]</span> <span class=o>=</span> <span class=nx>React</span><span class=p>.</span><span class=nx>useState</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// AOS 애니메이션 적용
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>AOS</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>once</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>easing</span><span class=o>:</span> <span class=s2>&#34;ease-out-cubic&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// next-auth 로그인 세션을 위해 사용됨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>&lt;</span><span class=nt>SessionProvider</span> <span class=na>session</span><span class=o>=</span><span class=p>{</span><span class=nx>session</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* 아이폰 가로값 고정되지 않는 이슈 해결 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>meta</span>
</span></span><span class=line><span class=cl>          <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>Head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* infiniteScroll 위해 선언 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>QueryClientProvider</span> <span class=na>client</span><span class=o>=</span><span class=p>{</span><span class=nx>queryClient</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* PageProps 표시 영역 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Component</span> <span class=p>{</span><span class=na>...pageProps</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* Debug 모드에서만 활용할 devtools */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* import { ReactQueryDevtools } from &#39;react-query/devtools&#39;;
</span></span></span><span class=line><span class=cl><span class=cm>        &lt;ReactQueryDevtools initialIsOpen={false} /&gt; */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>QueryClientProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>SessionProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>MyApp</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><p>무한 로딩 리스트를 구현하는 큰 뼈대는 다음과 같습니다. 당연히 코드가 돌아가지 않으므로 참고만 해주시면 됩니다.</p><h4 id=infinitelistskeletontsx><code>InfiniteListSkeleton.tsx</code><a hidden class=anchor aria-hidden=true href=#infinitelistskeletontsx>#</a></h4><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>InfiniteListSkeleton.tsx</div></div><div class=terminalbody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Typescript data-lang=Typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>InfiniteListSkeleton</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;필터링 될 내용들&#39;</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>hasNextPage</span><span class=p>,</span> <span class=nx>fetchNextPage</span><span class=p>,</span> <span class=nx>refetch</span><span class=p>,</span> <span class=nx>isFetching</span> <span class=p>}</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>useInfiniteQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;some&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>({</span> <span class=nx>pageParam</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=p>})</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// FetchList 함수는 axios로 api에 request 보내는 함수입니다. (파라미터로 필터링 될 내용을 받습니다.)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>FetchList</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nx>pageParam</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;필터링 될 내용들&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 다음 페이지는 offset 으로 확인합니다.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>getNextPageParam</span><span class=o>:</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>lastPage</span><span class=p>.</span><span class=nx>next</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>undefined</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>lastPage</span><span class=p>.</span><span class=nx>next</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>lastOffset</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;offset&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>lastOffset</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>lastOffset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>undefined</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleTime</span>: <span class=kt>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>cacheTime</span>: <span class=kt>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>keepPreviousData</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>refetchOnMount</span>: <span class=kt>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>refetchOnWindowFocus</span>: <span class=kt>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 1. 모달로 오픈할 거면 (커스텀 훅)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>dialog</span> <span class=o>=</span> <span class=nx>useDialog</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>openModal</span> <span class=o>=</span> <span class=p>(</span><span class=nx>props</span>: <span class=kt>Results</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>dialog</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>description</span><span class=o>:</span> <span class=p>&lt;&gt;&lt;/&gt;,</span>
</span></span><span class=line><span class=cl>      <span class=nx>catchOnCancel</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>submitText</span><span class=o>:</span> <span class=s1>&#39;네&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cancleText</span><span class=o>:</span> <span class=s1>&#39;닫기&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>variant</span><span class=o>:</span> <span class=s1>&#39;warning&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>props</span>: <span class=kt>props</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>&lt;&gt;&lt;/&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. 페이지 이동후 스크롤 Y 값을 저장하여 해당 위치로 바로 보여지게 할 경우
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>scrollY</span><span class=p>,</span> <span class=nx>setScrollY</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useLocalStorage</span><span class=p>(</span><span class=s1>&#39;someScroll&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>React</span><span class=p>.</span><span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>scrollY</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>window</span><span class=p>.</span><span class=nx>scrollTo</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>scrollY</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>setScrollY</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// eslint-disable-next-line react-hooks/exhaustive-deps
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 필터가 적용되면 offset을 초기화하고 처음부터 로딩되어야 합니다.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>React</span><span class=p>.</span><span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>isRefreshing</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>refetch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>setIsRefreshing</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>isRefreshing</span><span class=p>,</span> <span class=nx>refetch</span><span class=p>,</span> <span class=nx>setIsRefreshing</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// useRef를 이용하여 해당 Ref를 하단에 두고 보여지면 다음 페이지를 로딩합니다.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>loadMoreButtonRef</span> <span class=o>=</span> <span class=nx>React</span><span class=p>.</span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>useIntersectionObserver</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>root</span>: <span class=kt>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span>: <span class=kt>loadMoreButtonRef</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>onIntersect</span>: <span class=kt>fetchNextPage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span>: <span class=kt>hasNextPage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* 로딩중일때 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>isFetching</span> <span class=o>&amp;&amp;</span> <span class=p>&lt;</span><span class=nt>LoadingDiv</span> <span class=p>/&gt;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* 리스트를 표시합ㄴ디ㅏ. */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>pages</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>page</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>page</span><span class=p>.</span><span class=nx>results</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>props</span>: <span class=kt>Results</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=c1>// data-aos 로 애니메이션 효과를 줍니다. (라이브러리 설치 필요))
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>&lt;</span><span class=nt>li</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=na>data</span><span class=err>-</span><span class=na>aos</span><span class=o>=</span><span class=s>&#39;fade-up&#39;</span> <span class=na>data</span><span class=err>-</span><span class=na>aos</span><span class=err>-</span><span class=na>duration</span><span class=o>=</span><span class=s>&#39;200&#39;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 1. 모달로 오픈할꺼면 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>openModal</span><span class=p>(</span><span class=nx>props</span><span class=p>)}&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>Click</span> <span class=nx>$</span><span class=p>{</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=nx>to</span> <span class=nx>open</span> <span class=nx>Modal</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 2. 페이지 이동할거면 */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>Link</span>
</span></span><span class=line><span class=cl>                <span class=na>href</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>pathname</span><span class=o>:</span> <span class=sb>`url/</span><span class=si>${</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>query</span><span class=o>:</span> <span class=p>{</span> <span class=nx>props</span>: <span class=kt>JSON.stringify</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>}}</span>
</span></span><span class=line><span class=cl>                <span class=na>as</span><span class=o>=</span><span class=p>{</span><span class=sb>`url/</span><span class=si>${</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=na>passHref</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>a</span>
</span></span><span class=line><span class=cl>                  <span class=na>href</span><span class=o>=</span><span class=p>{</span><span class=sb>`url/</span><span class=si>${</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>setScrollY</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>scrollY</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>                <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>Click</span> <span class=nx>$</span><span class=p>{</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=nx>to</span> <span class=nx>navigate</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)))}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* 로딩중 표시를 하고 ref가 focus 될때 (리스트의 끝일때) 마다 다음 리스트를 로딩합니다. */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nx>hasNextPage</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>LoadingDiv</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>fetchNextPage</span><span class=p>()}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;text-center&#39;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>loadMoreButtonRef</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>InfiniteListSkeleton</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></div></div><br><h3 id=infinitescroll--modal-내큐찾기><code>infiniteScroll</code> + <code>Modal</code> [내큐찾기]<a hidden class=anchor aria-hidden=true href=#infinitescroll--modal-내큐찾기>#</a></h3><p>계속 &mldr;</p><h3 id=infinitescroll--localstorage--scrolly-커뮤니티><code>infiniteScroll</code> + <code>LocalStorage</code> + <code>ScrollY</code> [커뮤니티]<a hidden class=anchor aria-hidden=true href=#infinitescroll--localstorage--scrolly-커뮤니티>#</a></h3><p>계속 &mldr;</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://cha2hyun.github.io/tags/next.js/>Next.js</a></li><li><a href=https://cha2hyun.github.io/tags/react-query/>React Query</a></li><li><a href=https://cha2hyun.github.io/tags/infinite-scroll/>Infinite Scroll</a></li></ul><div style=padding-top:15px;padding-bottom:2px;font-size:x-large;font-weight:700>Any Comments? 😀</div><div class=share-buttons></div><script src=https://utteranc.es/client.js repo=cha2hyun/blog-comments issue-term=title theme=boxy-light crossorigin=anonymous async></script></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://cha2hyun.github.io/>채수현 개발일지</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>