<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 | 채수현 개발일지</title>
<meta name="keywords" content="python, websockets, bs4, selenium, crawling">
<meta name="description" content="feat.배돌이의 당구생활) 멀티쓰레딩 &#43; 실행파일로 생성">
<meta name="author" content="cha2hyun">
<link rel="canonical" href="https://cha2hyun.github.io/content/posts/youtubeafreecacrawling/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e101c64fade41186dce194e30cf9ac31add774d65925e79e6abda73f402a3a42.css" integrity="sha256-4QHGT63kEYbc4ZTjDPmsMa3XdNZZJeeear2nP0AqOkI=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cha2hyun.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cha2hyun.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cha2hyun.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cha2hyun.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://cha2hyun.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="유튜브 라이브 실시간채팅 크롤링하기 - 파이썬" />
<meta property="og:description" content="feat.배돌이의 당구생활) 멀티쓰레딩 &#43; 실행파일로 생성" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cha2hyun.github.io/content/posts/youtubeafreecacrawling/" /><meta property="og:image" content="https://cha2hyun.github.io/papermod-cover.png"/><meta property="article:section" content="content" />
<meta property="article:published_time" content="2023-03-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-03-10T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cha2hyun.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="유튜브 라이브 실시간채팅 크롤링하기 - 파이썬"/>
<meta name="twitter:description" content="feat.배돌이의 당구생활) 멀티쓰레딩 &#43; 실행파일로 생성"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Contents",
      "item": "https://cha2hyun.github.io/content/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://cha2hyun.github.io/content/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "유튜브 라이브 실시간채팅 크롤링하기 - 파이썬",
      "item": "https://cha2hyun.github.io/content/posts/youtubeafreecacrawling/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "유튜브 라이브 실시간채팅 크롤링하기 - 파이썬",
  "name": "유튜브 라이브 실시간채팅 크롤링하기 - 파이썬",
  "description": "feat.배돌이의 당구생활) 멀티쓰레딩 + 실행파일로 생성",
  "keywords": [
    "python", "websockets", "bs4", "selenium", "crawling"
  ],
  "articleBody": "👉 시리즈 유튜브 실시간채팅 크롤링하기 (현재글)\n아프리카TV 실시간채팅 크롤링하기\n아프리카도우미 실시간채팅 크롤링하기\n유튜브 댓글 분석 및 댓글 이벤트\n들어가며 김치빌리아드, 큐찾사 유튜브채널 배돌이의 당구생활의 컨텐츠인 라이브 개인큐 랜덤 추첨에서 실시간 시청자들의 댓글을 긁어와서 추첨하는게 필요했습니다. (다시봐도 매주 백만원 넘게 뿌리는 진짜 미친 이벤트이긴 합니다.)\n배당생 개인큐 추첨 라이브 진짜 100% 진짜..\n이벤트는 매우 매우 간단한 방법으로 채팅에 참여한 사람들을 추출해서 돌림판에 넣고 추첨합니다. 초반에는 유튜브에서 제공하는 채팅방 실시간 참여자를 드래그해서 추첨판에 복붙하였습니다. 저의 부캐 채PD로 제가 직접 방송에 참여하면서 컴퓨터를 조작하면 괜찮지만 방송에 참여하지 못하는 날들엔 배돌이가 직접 하기에 어려운 부분이 있어서 클릭 한 번만 하면 자동으로 해주는 실행파일 프로그램을 만들기로 했습니다.\n유튜브 라이브 실시간 댓글 크롤링 결과 미리보기\n구상한 순서는 다음과 같습니다.\n배돌이가 채팅 참여해주세요 라고 말하고 크롤링 프로그램을 킨다. 배돌이가 마감합니다 라고 말하고 아무 키를 누르면 크롤링이 끝난다 채팅에 참여한 모든 사람들을 추출한다. 셀레늄으로 돌림판 제공하는 사이트를 띄우고 추출한 사람들을 자동으로 넣고 돌린다. 라이브러리 유튜브 라이브의 경우 서드파티 라이브러리가 많이 있습니다. Don't reinvent the wheel이란 말처럼 (귀차니즘) 라이브러리를 사용하기로 했고 여기서 사용한 라이브러리는 pychat 입니다.\nThread 추첨을 시작하고 추첨을 끝내기 위해선 어떠한 이벤트가 발생해야 하는데 키보드의 아무 키가 입력되면 멈추게끔 프로그램을 작동시켜야합니다. 그러기 위해서는 멀티쓰레드로 키보드 이벤트를 감지하는 쓰레드가 하나 계속 돌고있어야 합니다.\n코드 youtube 크롤링 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 import pyperclip import pytchat import time import threading as th import os from selenium import webdriver from selenium.webdriver.common.by import By from selenium.webdriver.chrome.service import Service from webdriver_manager.chrome import ChromeDriverManager # 키보드 이벤트 감지 CAPTURING = True def stop_capture(): global CAPTURING input() CAPTURING = False def start_capture(video_id): # 키보드 이벤트 감지를 쓰레드로 실행 th.Thread(target=stop_capture, args=(), name='stop_capture', daemon=True).start() chat = pytchat.create(video_id=video_id) author_name = [] start = time.strftime('%Y-%m-%d %H-%M-%S', time.localtime(time.time())) today = time.strftime('%Y-%m-%d', time.localtime(time.time())) # 결과값을 저장할 위치 current = os.getcwd() path = f'{current}/{today}' try: if not os.path.exists(path): os.makedirs(path) except OSError: print(\"Error: Cannot create the directory {}\".format(path)) fp = open(f'{path}/{start}.txt', 'w') cnt = 0 # 크롤링 시작 while CAPTURING and chat.is_alive(): try: for c in chat.get().sync_items(): if c.author.name not in author_name: author_name.append(f'{c.author.name} | @{c.author.channelId}') print(f\"[{c.datetime[11:]}] 아이디: {c.author.name} | @{c.author.channelId}\\n\\t 내용: {c.message}\") fp.write(f\"[{c.datetime[11:]}] 아이디: {c.author.name} | @{c.author.channelId}\\n\\t 내용: {c.message}\\n\") cnt += 1 except KeyboardInterrupt: break chat.terminate() end = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(time.time())) author_name.sort() author_name = (list(set(author_name))) print('\\n====================================================================') print(f\"배돌이의당구생활 라이브 추첨 댓글 추출\\n시작 {start} | 종료 {end}\") print(f\"채팅에 참여한 사람 {len(list(set(author_name)))}명 (중복제거) | 총 채팅수 : {format(cnt, ',')}개\") print(author_name) print('====================================================================\\n\\n') print('추출을 종료합니다.') fp.write('\\n====================================================================\\n') fp.write(f\"배돌이의당구생활 라이브 추첨 댓글 추출\\n시작 {start} | 종료 {end}\\n\") fp.write(f\"채팅에 참여한 사람 {len(list(set(author_name)))}명 (중복제거) | 총 채팅수 : {cnt}개\\n\") fp.write(f\"{author_name}\\n\") fp.write('====================================================================\\n') fp.close() time.sleep(0.5) picker(author_name) return author_name def list_chuck(arr, n): return [arr[i: i + n] for i in range(0, len(arr), n)] def picker(author_name): try: driver = webdriver.Chrome(service=Service(ChromeDriverManager().install())) url = 'https://spinnerwheel.ahaslides.com/?entries=\u0026action=true' driver.get(url) driver.implicitly_wait(3) input_box = driver.find_element(By.XPATH, '//*[@id=\"aha-spinner-wheel\"]/div[2]/div/div[3]/div[2]/form/div/div/input') add_button = driver.find_element(By.XPATH, '//*[@id=\"aha-spinner-wheel\"]/div[2]/div/div[3]/div[2]/form/button') result = list_chuck(author_name, 30) for r in result: text = ','.join(r) JS_ADD_TEXT_TO_INPUT = \"\"\" var elm = arguments[0], txt = arguments[1]; elm.value += txt; elm.dispatchEvent(new Event('change')); \"\"\" driver.execute_script(JS_ADD_TEXT_TO_INPUT, input_box, text) time.sleep(1) input_box.send_keys(' ') add_button.click() while(1): pass except: pass print('\\n========================================') print(f\"배돌이의당구생활 라이브 추첨 댓글 추출\") video_id = input(\"영상 URL을 입력해주세요 : \") print(f\"확인되었습니다. 댓글 추출을 시작합니다.\") print('========================================') author_name = start_capture(video_id) 코드설명 pychat 라이브러리를 사용하기 떄문에 코드가 매우 간단합니다. start_capture로 캡쳐가 시작되고 함께 th.Thread(target=stop_capture, args=(), name='stop_capture', daemon=True).start()로 stop_capture 함수를 쓰레드로 시작합니다.\nstop_capture에서 input()을 기다리고 있는데 이는 실행중에 키보드값이 입력되면 global로 선언된 CAPTURING 변수를 false로 변경하여 크롤링을 멈추게 됩니다. 쓰레드를 활용하는 환경에서 전체적으로 참조해야할 변수를 선언하려면 꼭 global을 사용해야합니다.\n키보드 이벤트가 감지되어 추출이 멈추게되면 picker 함수를 실행시킵니다. 해당 함수는 selenium을 이용하여 결과값을 돌림판에 입력하는것 까지 자동으로 진행되게 합니다. 닉네임 중복이 가능하므로 유저의 고유번호까지 추출되어야하며 나중에 비교하기 위해서 텍스트 파일로 결과를 저장합니다. 추출 결과값을 브라우저의 인풋에 넣고 확인을 눌러줘야 하는데 이때 어쩔 수 없이 자바스크립트 문법이 필요하였습니다.\n실행파일 실행파일로 만들고 어떠한 환경에서도 실행되어야 해서 기존의 웹드라이버를 수동으로 다운받아서 옮기지 않고 자동으로 다운로드 받아야하여 다음 명령어로 웹드라이버를 로드하였습니다. webdriver.Chrome(service=Service(ChromeDriverManager().install()))\n실행파일로 만들어주기 위해 pyinstaller 라이브러리를 사용했습니다. 이렇게 하면 최신 드라이버를 받아주고 실행파일 용량압박에도 살아남을 수 있게됩니다.\n이미지도 깜찍하게\n결과 실제로 어떻게 작동되는지 궁금하시면 다음 링크나 아래 영상을 확인해주세요. 도움이 되셨다면 구독과.. 좋..아…요…\n",
  "wordCount" : "744",
  "inLanguage": "en",
  "datePublished": "2023-03-10T00:00:00Z",
  "dateModified": "2023-03-10T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "cha2hyun"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cha2hyun.github.io/content/posts/youtubeafreecacrawling/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "채수현 개발일지",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cha2hyun.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cha2hyun.github.io/" accesskey="h" title="채수현 개발일지 (Alt + H)">채수현 개발일지</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://cha2hyun.github.io/archives" title="전체">
                    <span>전체</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.github.io/content/posts/" title="개발일상">
                    <span>개발일상</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.github.io/content/projects/" title="프로젝트">
                    <span>프로젝트</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.github.io/content/algorithm/" title="알고리즘">
                    <span>알고리즘</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.github.io/search/" title="검색">
                    <span>검색</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cha2hyun.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://cha2hyun.github.io/content/">Contents</a>&nbsp;»&nbsp;<a href="https://cha2hyun.github.io/content/posts/">Posts</a></div>
    <h1 class="post-title">
      유튜브 라이브 실시간채팅 크롤링하기 - 파이썬
    </h1>
    <div class="post-meta"><span title='2023-03-10 00:00:00 +0000 UTC'>March 10, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;cha2hyun

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#-%ec%8b%9c%eb%a6%ac%ec%a6%88" aria-label="👉 시리즈">👉 시리즈</a></li>
                <li>
                    <a href="#%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0" aria-label="들어가며">들어가며</a></li>
                <li>
                    <a href="#%ec%9c%a0%ed%8a%9c%eb%b8%8c-%eb%9d%bc%ec%9d%b4%eb%b8%8c-%ec%8b%a4%ec%8b%9c%ea%b0%84-%eb%8c%93%ea%b8%80-%ed%81%ac%eb%a1%a4%eb%a7%81" aria-label="유튜브 라이브 실시간 댓글 크롤링">유튜브 라이브 실시간 댓글 크롤링</a></li>
                <li>
                    <a href="#%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac" aria-label="라이브러리">라이브러리</a></li>
                <li>
                    <a href="#thread" aria-label="Thread">Thread</a></li>
                <li>
                    <a href="#%ec%bd%94%eb%93%9c" aria-label="코드">코드</a></li>
                <li>
                    <a href="#%ec%bd%94%eb%93%9c%ec%84%a4%eb%aa%85" aria-label="코드설명">코드설명</a></li>
                <li>
                    <a href="#%ec%8b%a4%ed%96%89%ed%8c%8c%ec%9d%bc" aria-label="실행파일">실행파일</a></li>
                <li>
                    <a href="#%ea%b2%b0%ea%b3%bc" aria-label="결과">결과</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="-시리즈">👉 시리즈<a hidden class="anchor" aria-hidden="true" href="#-시리즈">#</a></h3>
<ul>
<li>
<p><a href="/posts/youtubeafreecacrawling">유튜브 실시간채팅 크롤링하기 (현재글)</a></p>
</li>
<li>
<p><a href="/posts/youtubeafreecacrawling1">아프리카TV 실시간채팅 크롤링하기</a></p>
</li>
<li>
<p><a href="/posts/youtubeafreecacrawling2">아프리카도우미 실시간채팅 크롤링하기</a></p>
</li>
<li>
<p><a href="/posts/youtubecrawling">유튜브 댓글 분석 및 댓글 이벤트</a></p>
</li>
</ul>
<br>
<h3 id="들어가며">들어가며<a hidden class="anchor" aria-hidden="true" href="#들어가며">#</a></h3>
<p>김치빌리아드, 큐찾사 유튜브채널 <code>배돌이의 당구생활</code>의 컨텐츠인 <strong>라이브 개인큐 랜덤 추첨</strong>에서 실시간 시청자들의 댓글을 긁어와서 추첨하는게 필요했습니다. (다시봐도 매주 백만원 넘게 뿌리는 진짜 미친 이벤트이긴 합니다.)</p>
<figure class="align-center ">
    <img loading="lazy" src="../img/7.png#center"
         alt="배당생 개인큐 추첨 라이브 진짜 100% 진짜.."/> <figcaption>
            <p>배당생 개인큐 추첨 라이브 진짜 100% 진짜..</p>
        </figcaption>
</figure>

<p>이벤트는 매우 매우 간단한 방법으로 채팅에 참여한 사람들을 추출해서 돌림판에 넣고 추첨합니다. 초반에는 유튜브에서 제공하는 채팅방 실시간 참여자를 드래그해서 추첨판에 복붙하였습니다. 저의 부캐 <strong>채PD</strong>로 제가 직접 방송에 참여하면서 컴퓨터를 조작하면 괜찮지만 방송에 참여하지 못하는 날들엔 배돌이가 직접 하기에 어려운 부분이 있어서 클릭 한 번만 하면 자동으로 해주는 <strong>실행파일</strong> 프로그램을 만들기로 했습니다.</p>
<br>
<h3 id="유튜브-라이브-실시간-댓글-크롤링">유튜브 라이브 실시간 댓글 크롤링<a hidden class="anchor" aria-hidden="true" href="#유튜브-라이브-실시간-댓글-크롤링">#</a></h3>
<p><figure class="align-center ">
    <img loading="lazy" src="../img/8.png#center"
         alt="결과 미리보기"/> <figcaption>
            <p>결과 미리보기</p>
        </figcaption>
</figure>

구상한 순서는 다음과 같습니다.</p>
<ol>
<li>배돌이가 채팅 참여해주세요 라고 말하고 크롤링 프로그램을 킨다.</li>
<li>배돌이가 마감합니다 라고 말하고 아무 키를 누르면 크롤링이 끝난다</li>
<li>채팅에 참여한 모든 사람들을 추출한다.</li>
<li>셀레늄으로 돌림판 제공하는 사이트를 띄우고</li>
<li>추출한 사람들을 자동으로 넣고 돌린다.</li>
</ol>
<h3 id="라이브러리">라이브러리<a hidden class="anchor" aria-hidden="true" href="#라이브러리">#</a></h3>
<p>유튜브 라이브의 경우 서드파티 라이브러리가 많이 있습니다. <code>Don't reinvent the wheel</code>이란 말처럼 (귀차니즘) 라이브러리를 사용하기로 했고 여기서 사용한 라이브러리는 <code>pychat</code> 입니다.</p>
<h3 id="thread">Thread<a hidden class="anchor" aria-hidden="true" href="#thread">#</a></h3>
<p>추첨을 시작하고 추첨을 끝내기 위해선 어떠한 이벤트가 발생해야 하는데 키보드의 아무 키가 입력되면 멈추게끔 프로그램을 작동시켜야합니다. 그러기 위해서는 <code>멀티쓰레드</code>로 키보드 이벤트를 감지하는 쓰레드가 하나 계속 돌고있어야 합니다.</p>
<h3 id="코드">코드<a hidden class="anchor" aria-hidden="true" href="#코드">#</a></h3>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      youtube 크롤링
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyperclip</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytchat</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span> <span class="k">as</span> <span class="nn">th</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 키보드 이벤트 감지</span>
</span></span><span class="line"><span class="cl"><span class="n">CAPTURING</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">stop_capture</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">CAPTURING</span>
</span></span><span class="line"><span class="cl">    <span class="nb">input</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">CAPTURING</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_capture</span><span class="p">(</span><span class="n">video_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 키보드 이벤트 감지를 쓰레드로 실행</span>
</span></span><span class="line"><span class="cl">    <span class="n">th</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">stop_capture</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stop_capture&#39;</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">chat</span> <span class="o">=</span> <span class="n">pytchat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">video_id</span><span class="o">=</span><span class="n">video_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">author_name</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H-%M-%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">    <span class="n">today</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 결과값을 저장할 위치</span>
</span></span><span class="line"><span class="cl">    <span class="n">current</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Error: Cannot create the directory </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 크롤링 시작</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">CAPTURING</span> <span class="ow">and</span> <span class="n">chat</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chat</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">sync_items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">author_name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">author_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | @</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">channelId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span><span class="si">}</span><span class="s2">] 아이디: </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> | @</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">channelId</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">   내용: </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span><span class="si">}</span><span class="s2">] 아이디: </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> | @</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">channelId</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">   내용: </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">chat</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">    <span class="n">author_name</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">author_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">author_name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">====================================================================&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;배돌이의당구생활 라이브 추첨 댓글 추출</span><span class="se">\n</span><span class="s2">시작 </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> | 종료 </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;채팅에 참여한 사람 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">author_name</span><span class="p">)))</span><span class="si">}</span><span class="s2">명 (중복제거) | 총 채팅수 : </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">개&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">author_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;====================================================================</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;추출을 종료합니다.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">====================================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;배돌이의당구생활 라이브 추첨 댓글 추출</span><span class="se">\n</span><span class="s2">시작 </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> | 종료 </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;채팅에 참여한 사람 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">author_name</span><span class="p">)))</span><span class="si">}</span><span class="s2">명 (중복제거) | 총 채팅수 : </span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2">개</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">author_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;====================================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">picker</span><span class="p">(</span><span class="n">author_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">author_name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">list_chuck</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">n</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">picker</span><span class="p">(</span><span class="n">author_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://spinnerwheel.ahaslides.com/?entries=&amp;action=true&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&#34;aha-spinner-wheel&#34;]/div[2]/div/div[3]/div[2]/form/div/div/input&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">add_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&#34;aha-spinner-wheel&#34;]/div[2]/div/div[3]/div[2]/form/button&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">list_chuck</span><span class="p">(</span><span class="n">author_name</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">JS_ADD_TEXT_TO_INPUT</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">            var elm = arguments[0], txt = arguments[1];
</span></span></span><span class="line"><span class="cl"><span class="s2">            elm.value += txt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            elm.dispatchEvent(new Event(&#39;change&#39;));
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">JS_ADD_TEXT_TO_INPUT</span><span class="p">,</span> <span class="n">input_box</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">input_box</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">add_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">========================================&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;배돌이의당구생활 라이브 추첨 댓글 추출&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">video_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;영상 URL을 입력해주세요 : &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;확인되었습니다. 댓글 추출을 시작합니다.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;========================================&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">author_name</span> <span class="o">=</span> <span class="n">start_capture</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h3 id="코드설명">코드설명<a hidden class="anchor" aria-hidden="true" href="#코드설명">#</a></h3>
<p>pychat 라이브러리를 사용하기 떄문에 코드가 매우 간단합니다. <code>start_capture</code>로 캡쳐가 시작되고 함께 <code>th.Thread(target=stop_capture, args=(), name='stop_capture', daemon=True).start()</code>로 <code>stop_capture</code> 함수를 쓰레드로 시작합니다.</p>
<p><code>stop_capture</code>에서 <code>input()</code>을 기다리고 있는데 이는 실행중에 키보드값이 입력되면 <code>global</code>로 선언된 <code>CAPTURING</code> 변수를 <code>false</code>로 변경하여 크롤링을 멈추게 됩니다. 쓰레드를 활용하는 환경에서 전체적으로 참조해야할 변수를 선언하려면 꼭 <code>global</code>을 사용해야합니다.</p>
<p>키보드 이벤트가 감지되어 추출이 멈추게되면 <code>picker</code> 함수를 실행시킵니다. 해당 함수는 <code>selenium</code>을 이용하여 결과값을 돌림판에 입력하는것 까지 자동으로 진행되게 합니다. 닉네임 중복이 가능하므로 유저의 고유번호까지 추출되어야하며 나중에 비교하기 위해서 텍스트 파일로 결과를 저장합니다. 추출 결과값을 브라우저의 인풋에 넣고 확인을 눌러줘야 하는데 이때 어쩔 수 없이 자바스크립트 문법이 필요하였습니다.</p>
<br>
<h3 id="실행파일">실행파일<a hidden class="anchor" aria-hidden="true" href="#실행파일">#</a></h3>
<p><code>실행파일</code>로 만들고 어떠한 환경에서도 실행되어야 해서 기존의 <strong>웹드라이버</strong>를 수동으로 다운받아서 옮기지 않고 자동으로 다운로드 받아야하여 다음 명령어로 웹드라이버를 로드하였습니다. <code>webdriver.Chrome(service=Service(ChromeDriverManager().install()))</code></p>
<p>실행파일로 만들어주기 위해 <code>pyinstaller</code> 라이브러리를 사용했습니다. 이렇게 하면 최신 드라이버를 받아주고 실행파일 용량압박에도 살아남을 수 있게됩니다.</p>
<figure class="align-center ">
    <img loading="lazy" src="../img/9.png#center"
         alt="이미지도 깜찍하게"/> <figcaption>
            <p>이미지도 깜찍하게</p>
        </figcaption>
</figure>

<h3 id="결과">결과<a hidden class="anchor" aria-hidden="true" href="#결과">#</a></h3>
<p>실제로 어떻게 작동되는지 궁금하시면 <a href="https://www.youtube.com/live/WbriWhcdozk?feature=share" target="_blank">다음 링크나</a> 아래 영상을 확인해주세요. 도움이 되셨다면 구독과.. 좋..아&hellip;요&hellip;</p>
<center>
<iframe width="600" height="320" src="https://www.youtube.com/embed/egb1Vl5A__k?start=1670" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</center>
<br>
<br>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cha2hyun.github.io/tags/python/">python</a></li>
      <li><a href="https://cha2hyun.github.io/tags/websockets/">websockets</a></li>
      <li><a href="https://cha2hyun.github.io/tags/bs4/">bs4</a></li>
      <li><a href="https://cha2hyun.github.io/tags/selenium/">selenium</a></li>
      <li><a href="https://cha2hyun.github.io/tags/crawling/">crawling</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cha2hyun.github.io/content/posts/youtubeafreecacrawling1/">
    <span class="title">« Prev</span>
    <br>
    <span>아프리카TV 실시간채팅 크롤링하기 - 파이썬</span>
  </a>
  <a class="next" href="https://cha2hyun.github.io/content/posts/firstcollaborator/">
    <span class="title">Next »</span>
    <br>
    <span>처음으로 오픈소스 Collaborator가 되다</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on twitter"
        href="https://twitter.com/intent/tweet/?text=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac&amp;url=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f&amp;hashtags=python%2cwebsockets%2cbs4%2cselenium%2ccrawling">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f&amp;title=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac&amp;summary=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac&amp;source=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f&title=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on whatsapp"
        href="https://api.whatsapp.com/send?text=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac%20-%20https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on telegram"
        href="https://telegram.me/share/url?text=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac&amp;url=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 유튜브 라이브 실시간채팅 크롤링하기 - 파이썬 on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=%ec%9c%a0%ed%8a%9c%eb%b8%8c%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%20%ec%8b%a4%ec%8b%9c%ea%b0%84%ec%b1%84%ed%8c%85%20%ed%81%ac%eb%a1%a4%eb%a7%81%ed%95%98%ea%b8%b0%20-%20%ed%8c%8c%ec%9d%b4%ec%8d%ac&u=https%3a%2f%2fcha2hyun.github.io%2fcontent%2fposts%2fyoutubeafreecacrawling%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://cha2hyun.github.io/">채수현 개발일지</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
