<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기) | 채수현 개발일지</title>
<meta name="keywords" content="NestJS, graphql, prisma, postgres, jwt">
<meta name="description" content="NestJS &#43; Grahpql &#43; Prisma &#43; Postgres &#43; jwt">
<meta name="author" content="cha2hyun">
<link rel="canonical" href="https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a0df97853b646022cff587d94d85b7235723b13f55f2c0ed1e6b317d931ddfa5.css" integrity="sha256-oN&#43;XhTtkYCLP9YfZTYW3I1cjsT9V8sDtHmsxfZMd36U=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cha2hyun.blog/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cha2hyun.blog/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cha2hyun.blog/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cha2hyun.blog/favicon/apple-icon-76x76.png">
<link rel="mask-icon" href="https://cha2hyun.blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)" />
<meta property="og:description" content="NestJS &#43; Grahpql &#43; Prisma &#43; Postgres &#43; jwt" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/" /><meta property="og:image" content="https://cha2hyun.blog/papermod-cover.png"/><meta property="article:section" content="content" />
<meta property="article:published_time" content="2023-11-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-11-20T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cha2hyun.blog/papermod-cover.png"/>

<meta name="twitter:title" content="첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)"/>
<meta name="twitter:description" content="NestJS &#43; Grahpql &#43; Prisma &#43; Postgres &#43; jwt"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Contents",
      "item": "https://cha2hyun.blog/content/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://cha2hyun.blog/content/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)",
      "item": "https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)",
  "name": "첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)",
  "description": "NestJS + Grahpql + Prisma + Postgres + jwt",
  "keywords": [
    "NestJS", "graphql", "prisma", "postgres", "jwt"
  ],
  "articleBody": "들어가며 ✅ 해당 프로젝트는 Boilerplate 템플릿 https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt으로 제작되어있습니다.\nDon’t reinvent the wheel! NestJS 공식문서에도 기재되어있는 무려 2,000 스타수가 넘는 notiz-dev/nestjs-prisma-starter를 기반으로 카카오 OAUTH 부분만 추가해두었습니다.\n하다보니 에러가 있어서 pr 보냈더니 merged 되었다🖐️ 스타수 2K 기여했다는 이 뿌듯함..\n카카오 OAUTH는 대부분 한국에서 사용되겠지만, 그래도 범용(?)적으로 처음으로 영문으로 Readme도 적어보았습니다.\nInstructions 🚀 This project is generated from notiz-dev/nestjs-prisma-starter starter template which is referenced in the NestJS official documentation. If you need more information, such as installation and setup, please check README within the template.\n👀 This project provides Kakao Oauth login with Passport JWT authentication.\n📝 Feel free to let me know if encounter any errors or have any questions. Pull requests are welcome.\nFeatures login/signup with kakao account with JWT tokens Overview 1. Setup a kakao sdk in your frontend. Please check kakao documents for setup. In my case i use next.js for the example.\n2. Login with kakao account. Here are some Next.js frontend code examples\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u003cScript src=\"https://t1.kakaocdn.net/kakao_js_sdk/2.1.0/kakao.min.js\" integrity=\"sha384-dpu02ieKC6NUeKFoGMOKz6102CLEWi9+5RQjWSV0ikYSFFd8M3Wp2reIcquJOemx\" crossOrigin=\"anonymous\" onReady={() =\u003e { if (!(\"Kakao\" in window)) return; // eslint-disable-next-line @typescript-eslint/no-explicit-any if ((window as any).Kakao == null) return; if (process.env.NEXT_PUBLIC_KAKAO_JS_KEY == null) return; // eslint-disable-next-line @typescript-eslint/no-explicit-any const kakao = (window as any).Kakao; if (kakao.isInitialized() !== true) { kakao.init(process.env.NEXT_PUBLIC_KAKAO_JS_KEY); } }} /\u003e Add kakao sdk on _app.tsx\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 const handleLogin = useCallback(async () =\u003e { if (!(\"Kakao\" in window)) return; // eslint-disable-next-line @typescript-eslint/no-explicit-any if ((window as any).Kakao == null) return; // eslint-disable-next-line @typescript-eslint/no-explicit-any const kakao = (window as any).Kakao; kakao.Auth.authorize({ redirectUri: typeof window !== \"undefined\" ? window.location.origin + \"/auth/kakao\" : null, prompts: \"login\", }); }, []); In this case redirect url is /auth/kakao\n3. Get Code Parameter. If your account passes the login, the browser will redirect to your redirectUri with code parameters. The URL will look like http://localhost:3002/auth/kakao?code=TJx7M1-sTWkrKQgvOTmfvSUnC5bD2GqtWrA....\n4. Perform a Mutation and Await Server Response On your redirect page, initiate a login mutation to the NestJS server using code and redirectUri as variables.\nFor instance, here are some Next.js frontend code snippets.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 /* eslint-disable no-console */ import { Spinner } from \"@nextui-org/react\"; import { NextPage } from \"next\"; import { useRouter } from \"next/router\"; import { useEffect, useState } from \"react\"; import { useLoginMutation } from \"@/src/core/config/graphql\"; import Authentication from \"@/src/core/function/authentication\"; const KakaoOauth: NextPage = () =\u003e { const router = useRouter(); const [login] = useLoginMutation(); const [isFetched, setIsFetched] = useState(false); useEffect(() =\u003e { const params = new URL(document.location.toString()).searchParams; const code = params.get(\"code\"); const fetchData = async () =\u003e { try { if (code \u0026\u0026 typeof window !== undefined \u0026\u0026 !isFetched) { await login({ variables: { code: code, redirectUri: window.location.origin + \"/auth/kakao\", }, onCompleted: async (res) =\u003e { setIsFetched(true); Authentication.setToken({ accessToken: res.login.accessToken, refreshToken: res.login.refreshToken, }); console.log(\"jwt\", res.login.accessToken); }, }); } } catch (err) { console.log(err); } }; fetchData(); }, [isFetched, login, router]); return ( \u003cdiv className=\"bg-defualt my-20 flex w-full justify-center \"\u003e \u003cdiv className=\"mx-auto w-full flex-1 text-center \"\u003e \u003cSpinner label=\"Waiting for server response...\" color=\"warning\" /\u003e \u003c/div\u003e \u003c/div\u003e ); }; export default KakaoOauth; auth/kakao.tsx\n5. Returning JWT Token on the NestJS server First, auth.reslover.ts 1 2 3 4 5 6 7 8 9 10 11 @Mutation(() =\u003e Auth) async login( @Args(\"code\") code: string, @Args(\"redirectUri\") redirectUri: string, ) { const { accessToken, refreshToken } = await this.auth.kakaoLogin(code, redirectUri); return { accessToken, refreshToken, }; src \u003e auth \u003e auth.resolver.ts\nit will call kakaoLogin functions in auth.service.ts\nSecond in auth.service.ts It will fetch the kakao access token using the code and redirectUri parameters. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 async kakaoLogin(code: string, redirectUri: string): Promise\u003cToken\u003e { try { const tokenResponse = await this.kakaoLoginService.getToken(code, redirectUri); const kakaoUser = await this.kakaoLoginService.getUser(tokenResponse.access_token); const isJoined = await this.prisma.user.findUnique({ where: { kakaoId: kakaoUser.id.toString() } }); if (!isJoined) { return this.createUser({ kakaoId: kakaoUser.id.toString(), email: kakaoUser.kakao_account.email, nickname: kakaoUser.properties.nickname, connectedAt: kakaoUser.connected_at, ageRange: kakaoUser.kakao_account.age_range, birthday: kakaoUser.kakao_account.birthday, gender: kakaoUser.kakao_account.gender, profileImageUrl: kakaoUser.properties.profile_image, thumbnailImageUrl: kakaoUser.properties.thumbnail_image, }); } else { const userId = (await this.prisma.user.findUnique({ where: { kakaoId: kakaoUser.id.toString() } })).id; return this.generateTokens({ userId: userId, }); } } catch (e) { throw new Error(e); } } src \u003e auth \u003e auth.service.ts\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 async getToken(code: string, redirectUri: string): Promise\u003cKakaoOauthToken\u003e { try { const url = new URL(\"/oauth/token\", KAKAO_AUTH_URL).href; const tokenResponse = await new Promise\u003cKakaoOauthToken\u003e((resolve, reject) =\u003e { this.httpService .post( url, new URLSearchParams({ grant_type: \"authorization_code\", client_id: this.configService.get(\"KAKAO_API_CLIENT_ID\"), client_secret: this.configService.get(\"KAKAO_API_CLIENT_SECRET\"), code: code, redirect_uri: redirectUri, }), { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\", }, }, ) .subscribe({ error: err =\u003e reject(err), next: response =\u003e resolve(response.data), }); }); return tokenResponse; } catch (e) { const err = e as AxiosError; // eslint-disable-next-line no-console console.log(err); } } Third, it will attempt to retrieve Kakao user information using the access-code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 async getUser(token: string) { try { const url = new URL(\"/v2/user/me\", KAKAO_API_URL).href; const infoResponse = await new Promise\u003cKakaoV2UserMe\u003e((resolve, reject) =\u003e { this.httpService .get(url, { headers: { Authorization: `Bearer ${token}`, \"Content-type\": \"Content-type: application/x-www-form-urlencoded;charset=utf-8\", }, params: { secure_resource: true, }, }) .subscribe({ error: err =\u003e reject(err), next: response =\u003e resolve(response.data), }); }); return infoResponse; } catch (e) { throw new UnauthorizedException(); } } Fourth, utilizing the id from kakao user information to validate wheater the user already exist on database. If not it will create a new user and generate a JWT token associated with the userId, returning it. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 async createUser(payload: SignupInput): Promise\u003cToken\u003e { try { const user = await this.prisma.user.create({ data: { kakaoId: payload.kakaoId, email: payload.email, nickname: payload.nickname, ageRange: payload.ageRange, birthday: payload.birthday, gender: payload.gender, role: \"USER\", kakaoProfile: { create: { profileImageUrl: payload.profileImageUrl, thumbnailImageUrl: payload.thumbnailImageUrl, connectedAt: payload.connectedAt, }, }, }, }); return this.generateTokens({ userId: user.id, }); } catch (e) { throw new Error(e); } } Fifthly, if the user already exists on database. It will return a JWT token genertated with the userId 6. Saving Returned JWT Token on your frontend The token will be returned to frontend. ensure to save it within the browser.\nToken will be like\n1 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbG95aDBydXIwMDAwM2hvYm9taTl3N21iIiwiaWF0IjoxNzAwMDM2MTA4LCJleHAiOjE3MDAwMzYyMjh9.M1YjIJcKjeUfYo4P8Humh7fAtc4PAxRI54tJAJDP 7. Execute the ‘Me’ query using JWT tokens. Add Authorization header with your JWT tokens to retrieve ‘Me’ Authorization : Bearer \"YOUR JWT TOKENS\"\non success\nwith worng token\n8. Begin building your own projects 🚀 마치며 처음으로 제작한 Boilerplate template. 고작 한 기능이 추가되었지만 하면서 여러 공부도 되었고 공식문서에 적혀있는 기존 템플릿에 PR도 Merged 되어서 매우 뿌듯합니다. 누군가에게 언젠가 사용되길 바랍니다 😀\n템플릿 바로가기 : https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt\n",
  "wordCount" : "1196",
  "inLanguage": "en",
  "datePublished": "2023-11-20T00:00:00Z",
  "dateModified": "2023-11-20T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "cha2hyun"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "채수현 개발일지",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cha2hyun.blog/favicon/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cha2hyun.blog/" accesskey="h" title="채수현 개발일지 (Alt + H)">채수현 개발일지<span style="justify-content: center; padding-left:7px;">
                    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fcha2hyun.blog&count_bg=%23000000&title_bg=%23000000&icon=&icon_color=%23E7E7E7&title=HITS&edge_flat=false"/>
                </span>
                <div style="font-size: 14px; margin-top:-30px; font-weight: normal;">📚 기억은 유한하나, 기록은 무한하다</div>
            </a>            
        </div>
        <ul id="menu">
            <li>
                <a href="https://cha2hyun.blog/archives" title="전체">
                    <span style="font-weight: bold;">전체</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/posts/" title="일상">
                    <span style="font-weight: bold;">일상</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/projects/" title="플젝">
                    <span style="font-weight: bold;">플젝</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/algorithm/" title="공부">
                    <span style="font-weight: bold;">공부</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/hacking/" title="해킹">
                    <span style="font-weight: bold;">해킹</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/search/" title="검색">
                    <span style="font-weight: bold;">검색</span>
                </a>
            </li>
            <li>
                <div class="logo-switches">
                    <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                    <ul class="lang-switch"><li>|</li>
                    </ul>
                </div>
            </li>
        </ul>
        
    </nav>
    
    
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cha2hyun.blog/">Home</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/">Contents</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)
    </h1>
    <div class="post-meta"><span title='2023-11-20 00:00:00 +0000 UTC'>November 20, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;cha2hyun


    </div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0" aria-label="들어가며">들어가며</a></li></ul>
                    
                <li>
                    <a href="#instructions" aria-label="Instructions">Instructions</a><ul>
                        
                <li>
                    <a href="#features" aria-label="Features">Features</a></li>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a><ul>
                        
                <li>
                    <a href="#1-setup-a-kakao-sdk-in-your-frontend" aria-label="1. Setup a kakao sdk in your frontend.">1. Setup a kakao sdk in your frontend.</a></li>
                <li>
                    <a href="#2-login-with-kakao-account" aria-label="2. Login with kakao account.">2. Login with kakao account.</a></li>
                <li>
                    <a href="#3-get-code-parameter" aria-label="3. Get Code Parameter.">3. Get Code Parameter.</a></li>
                <li>
                    <a href="#4-perform-a-mutation-and-await-server-response" aria-label="4. Perform a Mutation and Await Server Response">4. Perform a Mutation and Await Server Response</a></li>
                <li>
                    <a href="#5-returning-jwt-token-on-the-nestjs-server" aria-label="5. Returning JWT Token on the NestJS server">5. Returning JWT Token on the NestJS server</a><ul>
                        
                <li>
                    <a href="#first-authresloverts" aria-label="First, auth.reslover.ts">First, auth.reslover.ts</a></li>
                <li>
                    <a href="#second-in-authservicets-it-will-fetch-the-kakao-access-token-using-the-code-and-redirecturi-parameters" aria-label="Second in auth.service.ts It will fetch the kakao access token using the code and redirectUri parameters.">Second in auth.service.ts It will fetch the kakao access token using the code and redirectUri parameters.</a></li>
                <li>
                    <a href="#third-it-will-attempt-to-retrieve-kakao-user-information-using-the-access-code" aria-label="Third, it will attempt to retrieve Kakao user information using the access-code">Third, it will attempt to retrieve Kakao user information using the access-code</a></li>
                <li>
                    <a href="#fourth-utilizing-the-id-from-kakao-user-information-to-validate-wheater-the-user-already-exist-on-database-if-not-it-will-create-a-new-user-and-generate-a-jwt-token-associated-with-the-userid-returning-it" aria-label="Fourth, utilizing the id from kakao user information to validate wheater the user already exist on database. If not it will create a new user and generate a JWT token associated with the userId, returning it.">Fourth, utilizing the id from kakao user information to validate wheater the user already exist on database. If not it will create a new user and generate a JWT token associated with the userId, returning it.</a></li>
                <li>
                    <a href="#fifthly-if-the-user-already-exists-on-database-it-will-return-a-jwt-token-genertated-with-the-userid" aria-label="Fifthly, if the user already exists on database. It will return a JWT token genertated with the userId">Fifthly, if the user already exists on database. It will return a JWT token genertated with the userId</a></li></ul>
                </li>
                <li>
                    <a href="#6-saving-returned-jwt-token-on-your-frontend" aria-label="6. Saving Returned JWT Token on your frontend">6. Saving Returned JWT Token on your frontend</a></li>
                <li>
                    <a href="#7-execute-the-me-query-using-jwt-tokens" aria-label="7. Execute the &lsquo;Me&rsquo; query using JWT tokens.">7. Execute the &lsquo;Me&rsquo; query using JWT tokens.</a></li>
                <li>
                    <a href="#8-begin-building-your-own-projects-" aria-label="8. Begin building your own projects 🚀">8. Begin building your own projects 🚀</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%eb%a7%88%ec%b9%98%eb%a9%b0" aria-label="마치며">마치며</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="들어가며">들어가며<a hidden class="anchor" aria-hidden="true" href="#들어가며">#</a></h2>
<p>✅ 해당 프로젝트는 Boilerplate 템플릿 <a href="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt" target="_blank"><a href="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt">https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt</a></a>으로 제작되어있습니다.</p>
<p><b>Don&rsquo;t reinvent the wheel!</b><br/>
<a href="https://docs.nestjs.com/recipes/prisma" target="_blank">NestJS 공식문서</a>에도 기재되어있는 무려 2,000 스타수가 넘는 <a target="_blank" href="https://github.com/notiz-dev/nestjs-prisma-starter">notiz-dev/nestjs-prisma-starter</a>를 기반으로 <b>카카오 OAUTH</b> 부분만 추가해두었습니다.</p>
<figure class="align-center ">
    <img loading="lazy" src="../img/42.png#center"
         alt="하다보니 에러가 있어서 pr 보냈더니 merged 되었다🖐️ 스타수 2K 기여했다는 이 뿌듯함.."/> <figcaption>
            <p>하다보니 에러가 있어서 pr 보냈더니 merged 되었다🖐️ 스타수 2K 기여했다는 이 뿌듯함..</p>
        </figcaption>
</figure>

<p>카카오 OAUTH는 대부분 한국에서 사용되겠지만, 그래도 범용(?)적으로 처음으로 영문으로 Readme도 적어보았습니다.</p>
<h1 id="instructions">Instructions<a hidden class="anchor" aria-hidden="true" href="#instructions">#</a></h1>
<p><a href="https://hits.seeyoufarm.com"><img loading="lazy" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2Fcha2hyun%2Fnestjs-prisma-starter-kakao-oauth-jwt%2Fedit%2Fmain%2FREADME.md&amp;count_bg=%23F7E600&amp;title_bg=%23000000&amp;icon=github.svg&amp;icon_color=%23FFFFFF&amp;title=HITS&amp;edge_flat=true" alt="Hits"  />
</a></p>
<p>🚀 This project is generated from <a href="https://github.com/notiz-dev/nestjs-prisma-starter">notiz-dev/nestjs-prisma-starter</a> starter template which is referenced in the <a href="https://docs.nestjs.com/recipes/prisma">NestJS official documentation</a>. If you need more information, such as installation and setup, please check <a href="https://github.com/notiz-dev/nestjs-prisma-starter#readme">README</a> within the template.</p>
<p>👀 This project provides Kakao Oauth login with Passport JWT authentication.</p>
<p>📝 Feel free to let me know if encounter any errors or have any questions. Pull requests are welcome.</p>
<br>
<h2 id="features">Features<a hidden class="anchor" aria-hidden="true" href="#features">#</a></h2>
<ul>
<li>login/signup with kakao account with JWT tokens</li>
</ul>
<br>
<h2 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h2>
<h3 id="1-setup-a-kakao-sdk-in-your-frontend">1. Setup a kakao sdk in your frontend.<a hidden class="anchor" aria-hidden="true" href="#1-setup-a-kakao-sdk-in-your-frontend">#</a></h3>
<p>Please check <a href="https://developers.kakao.com/docs/latest/ko/javascript/download">kakao documents</a> for setup. In my case i use next.js for the example.</p>
<br>
<h3 id="2-login-with-kakao-account">2. Login with kakao account.<a hidden class="anchor" aria-hidden="true" href="#2-login-with-kakao-account">#</a></h3>
<img width="1014" alt="image" src="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt/assets/56015532/6030789f-9fc0-4e55-80e8-4271d6929b51">
<p>Here are some Next.js frontend code examples</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">Script</span>
</span></span><span class="line"><span class="cl">  <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://t1.kakaocdn.net/kakao_js_sdk/2.1.0/kakao.min.js&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-dpu02ieKC6NUeKFoGMOKz6102CLEWi9+5RQjWSV0ikYSFFd8M3Wp2reIcquJOemx&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">crossOrigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">onReady</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s2">&#34;Kakao&#34;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// eslint-disable-next-line @typescript-eslint/no-explicit-any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="nb">window</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">).</span><span class="nx">Kakao</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_KAKAO_JS_KEY</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// eslint-disable-next-line @typescript-eslint/no-explicit-any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">kakao</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">).</span><span class="nx">Kakao</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">kakao</span><span class="p">.</span><span class="nx">isInitialized</span><span class="p">()</span> <span class="o">!==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">kakao</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_KAKAO_JS_KEY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Add kakao sdk on <code>_app.tsx</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">handleLogin</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span><span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s2">&#34;Kakao&#34;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// eslint-disable-next-line @typescript-eslint/no-explicit-any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">((</span><span class="nb">window</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">).</span><span class="nx">Kakao</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// eslint-disable-next-line @typescript-eslint/no-explicit-any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">kakao</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">).</span><span class="nx">Kakao</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">kakao</span><span class="p">.</span><span class="nx">Auth</span><span class="p">.</span><span class="nx">authorize</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">redirectUri</span>:
</span></span><span class="line"><span class="cl">      <span class="kt">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="s2">&#34;undefined&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s2">&#34;/auth/kakao&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">prompts</span><span class="o">:</span> <span class="s2">&#34;login&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">[]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>In this case redirect url is <code>/auth/kakao</code></p>
</blockquote>
<br>
<h3 id="3-get-code-parameter">3. Get Code Parameter.<a hidden class="anchor" aria-hidden="true" href="#3-get-code-parameter">#</a></h3>
<p>If your account passes the login, the browser will redirect to your <code>redirectUri</code> with <code>code</code> parameters.
<img width="1020" alt="image" src="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt/assets/56015532/77d7364f-70e6-4d37-b024-be0fb26f7df9"></p>
<blockquote>
<p>The URL will look like <code>http://localhost:3002/auth/kakao?code=TJx7M1-sTWkrKQgvOTmfvSUnC5bD2GqtWrA....</code></p>
</blockquote>
<br>
<h3 id="4-perform-a-mutation-and-await-server-response">4. Perform a Mutation and Await Server Response<a hidden class="anchor" aria-hidden="true" href="#4-perform-a-mutation-and-await-server-response">#</a></h3>
<p>On your redirect page, initiate a login mutation to the NestJS server using <code>code</code> and <code>redirectUri</code> as variables.</p>
<p>For instance, here are some Next.js frontend code snippets.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="cm">/* eslint-disable no-console */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Spinner</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@nextui-org/react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NextPage</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useRouter</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next/router&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useLoginMutation</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@/src/core/config/graphql&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Authentication</span> <span class="kr">from</span> <span class="s2">&#34;@/src/core/function/authentication&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">KakaoOauth</span>: <span class="kt">NextPage</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">useRouter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">login</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useLoginMutation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">isFetched</span><span class="p">,</span> <span class="nx">setIsFetched</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">()).</span><span class="nx">searchParams</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">fetchData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isFetched</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">await</span> <span class="nx">login</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">code</span>: <span class="kt">code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">redirectUri</span>: <span class="kt">window.location.origin</span> <span class="o">+</span> <span class="s2">&#34;/auth/kakao&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onCompleted</span>: <span class="kt">async</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">setIsFetched</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="nx">Authentication</span><span class="p">.</span><span class="nx">setToken</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">accessToken</span>: <span class="kt">res.login.accessToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">refreshToken</span>: <span class="kt">res.login.refreshToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;jwt&#34;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">login</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">isFetched</span><span class="p">,</span> <span class="nx">login</span><span class="p">,</span> <span class="nx">router</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;bg-defualt my-20 flex w-full justify-center &#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;mx-auto w-full flex-1 text-center &#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">Spinner</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;Waiting for server response...&#34;</span> <span class="na">color</span><span class="o">=</span><span class="s">&#34;warning&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">KakaoOauth</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>auth/kakao.tsx</code></p>
</blockquote>
<br>
<h3 id="5-returning-jwt-token-on-the-nestjs-server">5. Returning JWT Token on the NestJS server<a hidden class="anchor" aria-hidden="true" href="#5-returning-jwt-token-on-the-nestjs-server">#</a></h3>
<h4 id="first-authresloverts">First, <code>auth.reslover.ts</code><a hidden class="anchor" aria-hidden="true" href="#first-authresloverts">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">@Mutation</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">login</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Args</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span> <span class="nx">code</span>: <span class="kt">string</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Args</span><span class="p">(</span><span class="s2">&#34;redirectUri&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">redirectUri</span>: <span class="kt">string</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">accessToken</span><span class="p">,</span> <span class="nx">refreshToken</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">kakaoLogin</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">redirectUri</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">accessToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">refreshToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>src &gt; auth &gt; auth.resolver.ts</p>
</blockquote>
<p>it will call kakaoLogin functions in <code>auth.service.ts</code></p>
<br>
<h4 id="second-in-authservicets-it-will-fetch-the-kakao-access-token-using-the-code-and-redirecturi-parameters">Second in <code>auth.service.ts</code> It will fetch the <code>kakao access token</code> using the <code>code</code> and <code>redirectUri</code> parameters.<a hidden class="anchor" aria-hidden="true" href="#second-in-authservicets-it-will-fetch-the-kakao-access-token-using-the-code-and-redirecturi-parameters">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">kakaoLogin</span><span class="p">(</span><span class="nx">code</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">redirectUri</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">Token</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">kakaoLoginService</span><span class="p">.</span><span class="nx">getToken</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">redirectUri</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">kakaoUser</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">kakaoLoginService</span><span class="p">.</span><span class="nx">getUser</span><span class="p">(</span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">access_token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">isJoined</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span> <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">kakaoId</span>: <span class="kt">kakaoUser.id.toString</span><span class="p">()</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isJoined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">createUser</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">kakaoId</span>: <span class="kt">kakaoUser.id.toString</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span>: <span class="kt">kakaoUser.kakao_account.email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">nickname</span>: <span class="kt">kakaoUser.properties.nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">connectedAt</span>: <span class="kt">kakaoUser.connected_at</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ageRange</span>: <span class="kt">kakaoUser.kakao_account.age_range</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">birthday</span>: <span class="kt">kakaoUser.kakao_account.birthday</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gender</span>: <span class="kt">kakaoUser.kakao_account.gender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">profileImageUrl</span>: <span class="kt">kakaoUser.properties.profile_image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">thumbnailImageUrl</span>: <span class="kt">kakaoUser.properties.thumbnail_image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span> <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">kakaoId</span>: <span class="kt">kakaoUser.id.toString</span><span class="p">()</span> <span class="p">}</span> <span class="p">})).</span><span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateTokens</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">userId</span>: <span class="kt">userId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>src &gt; auth &gt; auth.service.ts</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"> <span class="kr">async</span> <span class="nx">getToken</span><span class="p">(</span><span class="nx">code</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">redirectUri</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">KakaoOauthToken</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="s2">&#34;/oauth/token&#34;</span><span class="p">,</span> <span class="nx">KAKAO_AUTH_URL</span><span class="p">).</span><span class="nx">href</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">tokenResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">KakaoOauthToken</span><span class="p">&gt;((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">httpService</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">grant_type</span><span class="o">:</span> <span class="s2">&#34;authorization_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">client_id</span>: <span class="kt">this.configService.get</span><span class="p">(</span><span class="s2">&#34;KAKAO_API_CLIENT_ID&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="nx">client_secret</span>: <span class="kt">this.configService.get</span><span class="p">(</span><span class="s2">&#34;KAKAO_API_CLIENT_SECRET&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="nx">code</span>: <span class="kt">code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">redirect_uri</span>: <span class="kt">redirectUri</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">}),</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;application/x-www-form-urlencoded&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">error</span>: <span class="kt">err</span> <span class="o">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">next</span>: <span class="kt">response</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">tokenResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">e</span> <span class="kr">as</span> <span class="nx">AxiosError</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// eslint-disable-next-line no-console
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h4 id="third-it-will-attempt-to-retrieve-kakao-user-information-using-the-access-code">Third, it will attempt to retrieve <code>Kakao user information</code> using the <code>access-code</code><a hidden class="anchor" aria-hidden="true" href="#third-it-will-attempt-to-retrieve-kakao-user-information-using-the-access-code">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">getUser</span><span class="p">(</span><span class="nx">token</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="s2">&#34;/v2/user/me&#34;</span><span class="p">,</span> <span class="nx">KAKAO_API_URL</span><span class="p">).</span><span class="nx">href</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">infoResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">KakaoV2UserMe</span><span class="p">&gt;((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">httpService</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Authorization</span><span class="o">:</span> <span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-type&#34;</span><span class="o">:</span> <span class="s2">&#34;Content-type: application/x-www-form-urlencoded;charset=utf-8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">secure_resource</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">error</span>: <span class="kt">err</span> <span class="o">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">next</span>: <span class="kt">response</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">infoResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnauthorizedException</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h4 id="fourth-utilizing-the-id-from-kakao-user-information-to-validate-wheater-the-user-already-exist-on-database-if-not-it-will-create-a-new-user-and-generate-a-jwt-token-associated-with-the-userid-returning-it">Fourth, utilizing the <code>id</code> from <code>kakao user information</code> to validate wheater the user already exist on database. If not it will create a new user and generate a JWT token associated with the <code>userId</code>, returning it.<a hidden class="anchor" aria-hidden="true" href="#fourth-utilizing-the-id-from-kakao-user-information-to-validate-wheater-the-user-already-exist-on-database-if-not-it-will-create-a-new-user-and-generate-a-jwt-token-associated-with-the-userid-returning-it">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">createUser</span><span class="p">(</span><span class="nx">payload</span>: <span class="kt">SignupInput</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">Token</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">kakaoId</span>: <span class="kt">payload.kakaoId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">email</span>: <span class="kt">payload.email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">nickname</span>: <span class="kt">payload.nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ageRange</span>: <span class="kt">payload.ageRange</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">birthday</span>: <span class="kt">payload.birthday</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gender</span>: <span class="kt">payload.gender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">role</span><span class="o">:</span> <span class="s2">&#34;USER&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">kakaoProfile</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">create</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">profileImageUrl</span>: <span class="kt">payload.profileImageUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">thumbnailImageUrl</span>: <span class="kt">payload.thumbnailImageUrl</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">connectedAt</span>: <span class="kt">payload.connectedAt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateTokens</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">userId</span>: <span class="kt">user.id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h4 id="fifthly-if-the-user-already-exists-on-database-it-will-return-a-jwt-token-genertated-with-the-userid">Fifthly, if the user already exists on database. It will return a JWT token genertated with the <code>userId</code><a hidden class="anchor" aria-hidden="true" href="#fifthly-if-the-user-already-exists-on-database-it-will-return-a-jwt-token-genertated-with-the-userid">#</a></h4>
<br>
<h3 id="6-saving-returned-jwt-token-on-your-frontend">6. Saving Returned JWT Token on your frontend<a hidden class="anchor" aria-hidden="true" href="#6-saving-returned-jwt-token-on-your-frontend">#</a></h3>
<p>The token will be returned to frontend. ensure to save it within the browser.</p>
<img width="1012" alt="image" src="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt/assets/56015532/3788177a-9ba5-42b3-874f-8882c1cb02aa">
<p>Token will be like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbG95aDBydXIwMDAwM2hvYm9taTl3N21iIiwiaWF0IjoxNzAwMDM2MTA4LCJleHAiOjE3MDAwMzYyMjh9.M1YjIJcKjeUfYo4P8Humh7fAtc4PAxRI54tJAJDP
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="7-execute-the-me-query-using-jwt-tokens">7. Execute the &lsquo;Me&rsquo; query using JWT tokens.<a hidden class="anchor" aria-hidden="true" href="#7-execute-the-me-query-using-jwt-tokens">#</a></h3>
<p>Add Authorization header with your JWT tokens to retrieve &lsquo;Me&rsquo;
<code>Authorization : Bearer &quot;YOUR JWT TOKENS&quot;</code></p>
<img width="1327" alt="스크린샷 2023-11-15 오후 5 28 01" src="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt/assets/56015532/7a883a36-0f8b-47bd-bf6d-b798c5b353b8">
<blockquote>
<p>on success</p>
</blockquote>
<img width="1325" alt="image" src="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt/assets/56015532/1ac02c0d-3c37-484b-900e-0b3469efe3a8">
<blockquote>
<p>with worng token</p>
</blockquote>
<br>
<h3 id="8-begin-building-your-own-projects-">8. Begin building your own projects 🚀<a hidden class="anchor" aria-hidden="true" href="#8-begin-building-your-own-projects-">#</a></h3>
<h1 id="마치며">마치며<a hidden class="anchor" aria-hidden="true" href="#마치며">#</a></h1>
<p>처음으로 제작한 Boilerplate template. 고작 한 기능이 추가되었지만 하면서 여러 공부도 되었고 공식문서에 적혀있는 기존 템플릿에 PR도 Merged 되어서 매우 뿌듯합니다. 누군가에게 언젠가 사용되길 바랍니다 😀</p>
<p>템플릿 바로가기 : <a href="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt" target="_blank"><a href="https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt">https://github.com/cha2hyun/nestjs-prisma-starter-kakao-oauth-jwt</a></a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cha2hyun.blog/tags/nestjs/">NestJS</a></li>
      <li><a href="https://cha2hyun.blog/tags/graphql/">Graphql</a></li>
      <li><a href="https://cha2hyun.blog/tags/prisma/">Prisma</a></li>
      <li><a href="https://cha2hyun.blog/tags/postgres/">Postgres</a></li>
      <li><a href="https://cha2hyun.blog/tags/jwt/">Jwt</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cha2hyun.blog/content/hacking/hacking1/">
    <span class="title">« Prev</span>
    <br>
    <span>해킹] M1맥에 Kali Linux 설치 (VMware Fusion 13)</span>
  </a>
  <a class="next" href="https://cha2hyun.blog/content/posts/synologychat/">
    <span class="title">Next »</span>
    <br>
    <span>Synology Chat 멘션 색상 바꾸기</span>
  </a>
</nav>


<div
  style="
    padding-top: 15px;
    padding-bottom: 2px;
    font-size: x-large;
    font-weight: 700;
  "
>
  궁금하신 점이 있으신가요? 😀
</div>





<script
  src="https://giscus.app/client.js"
  data-repo="cha2hyun/cha2hyun.github.io"
  data-repo-id="R_kgDOICTfkg"
  data-category="Comments"
  data-category-id="DIC_kwDOICTfks4CcDAW"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="dark_dimmed"
  data-lang="ko"
  crossorigin="anonymous"
  async
></script>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://cha2hyun.blog/">채수현 개발일지</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
