<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>유튜브 API를 이용한 댓글 오래 버티기 이벤트 | 채수현 개발일지</title>
<meta name="keywords" content="python, websockets, bs4, selenium, crawling">
<meta name="description" content="유튜브에 댓글이 N분동안 달리지 않으면 승리하게 됩니다. feat)팩토리">
<meta name="author" content="cha2hyun">
<link rel="canonical" href="https://cha2hyun.blog/content/projects/%EB%B0%B0%EB%8F%8C%EC%9D%B4%EC%9D%98%EB%8B%B9%EA%B5%AC%EC%83%9D%ED%99%9C/youtube-comment-event/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.06cc1401233af506ee36c5cc89872a4bb4866704e48f666797e0ab85a990bd8f.css" integrity="sha256-BswUASM69QbuNsXMiYcqS7SGZwTkj2Znl&#43;CrhamQvY8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cha2hyun.blog/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cha2hyun.blog/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cha2hyun.blog/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cha2hyun.blog/favicon/apple-icon-76x76.png">
<link rel="mask-icon" href="https://cha2hyun.blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="유튜브 API를 이용한 댓글 오래 버티기 이벤트" />
<meta property="og:description" content="유튜브에 댓글이 N분동안 달리지 않으면 승리하게 됩니다. feat)팩토리" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cha2hyun.blog/content/projects/%EB%B0%B0%EB%8F%8C%EC%9D%B4%EC%9D%98%EB%8B%B9%EA%B5%AC%EC%83%9D%ED%99%9C/youtube-comment-event/" /><meta property="og:image" content="https://cha2hyun.blog/papermod-cover.png"/><meta property="article:section" content="content" />
<meta property="article:published_time" content="2023-04-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-28T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cha2hyun.blog/papermod-cover.png"/>

<meta name="twitter:title" content="유튜브 API를 이용한 댓글 오래 버티기 이벤트"/>
<meta name="twitter:description" content="유튜브에 댓글이 N분동안 달리지 않으면 승리하게 됩니다. feat)팩토리"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Contents",
      "item": "https://cha2hyun.blog/content/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Projects",
      "item": "https://cha2hyun.blog/content/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "유튜브 API를 이용한 댓글 오래 버티기 이벤트",
      "item": "https://cha2hyun.blog/content/projects/%EB%B0%B0%EB%8F%8C%EC%9D%B4%EC%9D%98%EB%8B%B9%EA%B5%AC%EC%83%9D%ED%99%9C/youtube-comment-event/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "유튜브 API를 이용한 댓글 오래 버티기 이벤트",
  "name": "유튜브 API를 이용한 댓글 오래 버티기 이벤트",
  "description": "유튜브에 댓글이 N분동안 달리지 않으면 승리하게 됩니다. feat)팩토리",
  "keywords": [
    "python", "websockets", "bs4", "selenium", "crawling"
  ],
  "articleBody": "\n들어가며 유튜브 채널 팩토리 님께서 진행해주신 레전드 컨텐츠 이벤트가 있습니다. (아마도 팩토리님은 개발자일지도) 아직도 안끝나고 댓글이 150만개가 달려서 세계10위에 들었다고 합니다\n배돌이의 당구생활 유튜브에서도 비슷한 다양한 이벤트들을 진행중입니다.\n라이브에서 실시간 추첨 (참고글) 컨텐츠에 댓글달고 오랫동안 버틴사람 컨텐츠 댓글중 좋아요가 가장 많은 사람 컨텐츠 댓글중 답글이 제일 많은 사람 컨텐츠에 댓글을 가장 많이 작성한 사람 위 뿐만 아니라 여러가지 이벤트들을 진행\u0026기획중으로 프로그램을 제작하게 되었습니다. 코드 \u0026 코드설명 constant.py 상수를 모아놓은 파일입니다. constant.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 LINE = \"=\" * 28 SMALL_LINE = '-' * 65 SYNOLOGY_LINE = '-' * 38 YOUTUBEAPI_KEY = \"\" YOUTUBEAPI_SUB_KEY = \"\" YOUTUBEAPI_VIDEOS_URL = \"https://www.googleapis.com/youtube/v3/videos\" YOUTUBEAPI_COMMENTTHREADS_URL = \"https://www.googleapis.com/youtube/v3/commentThreads\" YOUTUBEAPI_REQUEST_PER_TIME = 10 YOUTUBEAPI_RESEND_TIMEOUT = 3 MOST_CNT = 5 MAXRESULTS = 100 LIVE_MAXRESULTS = 30 # SYNOLOGY CHAT에 보낼 경우 SYNOLOGYAPI_URL = \"\" # 메세지를 처리하는 api를 따로 만들어야합니다. SYNOLOGYAPI_REQUEST_PER_TIME = 0.5 SYNOLOGYCHAT_LINE_SPLIT = 5 crwaler.py 프로그램 코어입니다. 설명은 주석으로 달아놓았습니다. crwaler.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 from datetime import datetime, timezone from operator import itemgetter import time import os import requests from constant import * def utc_to_local(utc_dt): # 유튜브 API 로 받아오면 미국 시간으로 받아와짐 # 미국 \u003e 한국으로 변경 return utc_dt.replace(tzinfo=timezone.utc).astimezone(tz=None) def sorter(list, value): # [{},{},..,{}] 리스트에서 딕셔너리의 밸류를 이용해 정렬 return sorted(list, key=itemgetter(value), reverse=True) def listDivider(arr, n): # arr배열을 n개씩 나누어 배열로 감싸 리턴합니다. return [arr[i: i + n] for i in range(0, len(arr), n)] class Printer: # 1. 화면에 출력 # 2. 로컬에 저장 # 3. 시놀로지채팅에 전송 # 위 3가지를 담당하는 클래스 def __init__(self): # 파일 저장할 디렉토리 생성 today = time.strftime('%Y-%m-%d', time.localtime(time.time())) start = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(time.time())) current = os.getcwd() path = f'{current}/{today}' try: if not os.path.exists(path): os.makedirs(path) except OSError: print(\"Error: Cannot create the directory {}\".format(path)) self.fp = open(f'{path}/{start}.txt', 'w') def saveOnLocal(self, msg): # 출력하고 파일에 저장합니다. self.fp.write(f'{msg}\\n') print(msg) def sendToChat(self, msg): # 시놀로지채팅에 보내고, 출력하고, 로컬에 저장합니다. self.saveOnLocal(msg) # 텍스트가 너무 길면 시놀로지챗에서 410 에러를 반환한다. n 줄씩 끊어서 배열로 리턴 (\\n으로) msgs_array = listDivider(msg.split('\\n'), SYNOLOGYCHAT_LINE_SPLIT) # 시놀로지에서 이쁘게 표시되게 변경합니다. for msgs in msgs_array: text = '\\n'.join(msgs) text = text.replace(SMALL_LINE, SYNOLOGY_LINE) text = text.replace(\"\\t\",'') text = text.replace(\" \",\" \") text = text.replace(\"닉네임\",\"\\n닉네임\") text = text.replace(\"| @\",\"\\n@\") # 해당 텍스트를 시놀로지 챗봇으로 보낼 수 있는 API를 만들어놓았습니다. requests.get(SYNOLOGYAPI_URL, data={\"msg\":text}) time.sleep(SYNOLOGYAPI_REQUEST_PER_TIME) def close(self): self.fp.close() class Youtube: apikey = YOUTUBEAPI_KEY videoId = '' videoInfo = { \"title\": '', # 제목 \"description\": '', # 설명 \"viewCount\": 0, # 조회수 \"likeCount\": 0, # 좋아요 \"commentCount\": 0, # 댓글수 } comments = [{ \"authorDisplayName\": '', # 닉네임 \"textDisplay\": '', # 댓글 \"publisedAt\": '', # 작성일 \"likeCount\": '', # 좋아요 \"diffTime\": '', # 다음글 작성시간의 차이 \"authorChannelId\": '', # 유저 채널 아이디 (고유값) \"totalReplyCount\": '', # 답글 수 }] def __init__(self): self.printer = Printer() self.greeting() # 유저한테 동영상 ID를 받아오고 self.videoId = self.getVideoId() # 동영상 정보를 출력하고 self.videoInfo = self.getVideoInfo() # 동영상의 댓글을 저장합니다. self.comments = [] self.comments = self.getVideoComments() # 저장된 댓글을 분석해서 몇분만에 다음 댓글이 달렸는지 저장합니다. self.addDiffTime(self.comments) self.start() def start(self): while True: self.printer.saveOnLocal(f'\\n\\n{LINE}') self.printer.saveOnLocal(\"유튜브 댓글 조회 프로그램\\nby.배돌이의당구생활 채PD\") self.printer.saveOnLocal(f'{LINE}') self.printer.saveOnLocal(\" 0. 종료\") self.printer.saveOnLocal(\" 1. 모든 댓글 조회\") self.printer.saveOnLocal(\" 2. 가장 많은 좋아요 댓글 조회\") self.printer.saveOnLocal(\" 3. 가장 많은 답글수 댓글 조회\") self.printer.saveOnLocal(\" 4. 가장 많이 작성한 사람 조회\") self.printer.saveOnLocal(\" 5. 가장 오래 버틴 댓글 조회\") self.printer.saveOnLocal(\" 6. 닉네임 조회\") self.printer.saveOnLocal(\" 7. 댓글 버티기 이벤트 시작\") self.printer.saveOnLocal(\" 8. 다른 영상 조회하기\") self.printer.saveOnLocal(f'{LINE}') command = input(\"번호를 입력해주세요 : \") self.printer.saveOnLocal(f' \u003e 입력된 번호 : {command}') if command == \"0\": # 종료 self.printer.saveOnLocal(\"프로그램을 종료합니다.\") self.printer.close() break elif command == \"1\": # 모든 댓글 조회 os.system('clear') self.printComments(self.comments) elif command == \"2\": # 가장 많은 좋아요 os.system('clear') self.printMostLiker() elif command == \"3\": # 가장 많은 답글수 os.system('clear') self.printMostReply() elif command == \"4\": # 가장 많이 작성한 사람 os.system('clear') self.printMostCommenter() elif command == \"5\": # 가장 오래 버틴 댓글 os.system('clear') self.printMostDiffTime() elif command == \"6\": # 유저 검색 os.system('clear') username = input(\"검색할 닉네임을 적어주세요 : \") self.printUsersComment(username) elif command == \"7\": # 버티기 이벤트 시작 os.system('clear') print(LINE) print(\"🚨 댓글 고정이 없는지 확인해주세요. 되어있다면 고정해제 해주세요.\") print(\"🚨 이벤트가 종료될 때 까지 프로그램은 계속 진행됩니다.\") print(LINE) stop = input(\" \u003e 몇 분 버티기를 하실건지 입력해주세요 : \") os.system('clear') self.startDiffTimeEvent(stop) elif command == \"8\": # 다른 동영상 조회 os.system('clear') self.__init__() else: os.system('clear') def greeting(self): text = f'\\n{LINE}\\n✋ 프로그램이 시작됩니다. {time.strftime(\"%y년 %m월 %d일 %H:%M:%S\")}\\n' text += f'\u003e By.배돌이의당구생활 채PD\\n\u003e 영상 댓글 이벤트\\n{LINE}' self.printer.saveOnLocal(text) def youtubeAPIExceed(self): # 유튜브 API가 일일 한도가 정해져 있음. # 일일한도를 초과하면 다른 키로 변경합니다. self.printer.sendToChat(f'🚨 유튜브 API 요청 한도 초과. {YOUTUBEAPI_RESEND_TIMEOUT}초 후 다시 시도합니다.') if self.apikey == YOUTUBEAPI_KEY: self.apikey = YOUTUBEAPI_SUB_KEY elif self.apikey == YOUTUBEAPI_SUB_KEY: self.apikey = YOUTUBEAPI_KEY time.sleep(YOUTUBEAPI_RESEND_TIMEOUT) def youtubeNotFound(self): # 유튜브 url을 찾지 못했을 경우 print(f'🚨 해당 유튜브 영상 URL을 확인할 수 없습니다. 다시 시도해주세요.\\n{LINE}') self.__init__() def getVideoId(self): while True: videoId = input(\"1️⃣ 영상 URL을 입력해주세요 : \") # 유튜브 URL 인지 확인 try: if 'youtu' not in videoId: raise Exception if 'watch?v=' in videoId: videoId = videoId.split(\"=\")[1] else: videoId = videoId.split(\"/\")[-1] return videoId except Exception as e: print(\"🚨 해당 영상을 확인할 수 없습니다. 다시 입력해주세요.\", e) print(LINE) def getVideoInfo(self): # 유저로부터 받은 동영상url이 정상적인지 확인하고 정상인 경우 동영상 정보를 리턴합니다. res = requests.get(f\"{YOUTUBEAPI_VIDEOS_URL}?key={self.apikey}\u0026part=snippet,statistics\u0026id={self.videoId}\") if res.status_code == 200: data = res.json() items = data[\"items\"] # url이 잘못되어도 status 200값과 함께 items는 빈 배열을 리턴합니다. if len(items) \u003c 1 : self.youtubeNotFound() title = items[0][\"snippet\"][\"title\"] description = items[0][\"snippet\"][\"description\"].replace(\"\\n\", \" \").replace(\"\n\",\" \") if len(description) \u003e 25: description = f'{description[:25]}...' commentCount = int(items[0][\"statistics\"][\"commentCount\"]) likeCount = int(items[0][\"statistics\"][\"likeCount\"]) viewCount = int(items[0][\"statistics\"][\"viewCount\"]) msg = f'✅ 영상이 확인되었습니다.\\n' msg += f'\u003e 제목: {title}\\n' msg += f'\u003e 설명: {description}...\\n' msg += f\"\u003e 조회수 {format(viewCount, ',')} | 좋아요 {format(likeCount, ',')} | 댓글수 {format(commentCount, ',')}\\n\" msg += LINE self.printer.saveOnLocal(msg) return { \"title\": title, \"description\": description, \"viewCount\": viewCount, \"likeCount\": likeCount, \"commentCount\": commentCount, } else: # 200을 리턴받지 않으면 유튜브 api 일일한도 초과로 403을 리턴받습니다. self.youtubeAPIExceed() def getVideoComments(self): self.printer.saveOnLocal(f\"2️⃣ 댓글을 가져옵니다.\") url = f\"{YOUTUBEAPI_COMMENTTHREADS_URL}?key={self.apikey}\u0026maxResults={MAXRESULTS}\u0026part=snippet,replies\u0026videoId={self.videoId}\" # 동영상의 댓글을 불러옵니다. self.getComments(url, 1) self.comments = sorted(self.comments, key=itemgetter('publishedAt')) self.printer.saveOnLocal(f'✅ 모든 댓글이 확인되었습니다.\\n{LINE}') return self.comments def getComments(self, url, cnt): # 1회 요청에 100개까지 받아올 수 있고 100개가 초과하는 댓글의 동영상은 다음 페이지 토큰이 주어집니다. # 재귀적으로 다음 페이지 토큰이 없을때 까지 실행됩니다. percent = cnt * MAXRESULTS / self.videoInfo[\"commentCount\"] * 100 if percent \u003e 100: percent = 100 currCnt = cnt * MAXRESULTS self.printer.saveOnLocal(f\"- ({percent:6.2f}%) {format(currCnt,',')}개 까지 추출중...\") response = requests.get(url).json() try: for item in response[\"items\"]: self.comments.append(self.validateComment(item)) except Exception as e: # Exception 발생은 api 일일조회를 초과했을 때 나타납니다. # api 키를 바꾸고 현재 댓글을 다시 조회합니다. self.youtubeAPIExceed() self.getComments(url, cnt) if \"nextPageToken\" in response.keys(): # 다음 댓글이 있으면 재귀로 다시 불러옵니다. nextPageToken = str(response[\"nextPageToken\"]) self.getComments(f\"{url}\u0026pageToken={nextPageToken}\", cnt + 1) def validateComment(self, item): # api로 받은 json 에서 필요한 값만 저장합니다. publisedAt = item[\"snippet\"][\"topLevelComment\"][\"snippet\"][\"publishedAt\"] publisedAt = datetime.strptime(publisedAt, \"%Y-%m-%dT%H:%M:%SZ\") publisedAt = datetime.strftime(utc_to_local(publisedAt), \"%y-%m-%d %H:%M:%S\") comment = { \"publishedAt\" : publisedAt, \"authorDisplayName\" : item[\"snippet\"][\"topLevelComment\"][\"snippet\"][\"authorDisplayName\"], # 는 PC에서 유튜브에만 존재하는 이모티콘이 이러게 나옵니다 \"textDisplay\" : item[\"snippet\"][\"topLevelComment\"][\"snippet\"][\"textDisplay\"].replace(\"\n\",\" \").replace(\"\u0026quot;\",\" \").replace('','[이모티콘]'), \"likeCount\" : item[\"snippet\"][\"topLevelComment\"][\"snippet\"][\"likeCount\"], \"authorChannelId\" : f'@{item[\"snippet\"][\"topLevelComment\"][\"snippet\"][\"authorChannelId\"][\"value\"]}', \"totalReplyCount\" : item[\"snippet\"][\"totalReplyCount\"] } return comment def addDiffTime(self, comments): # 배열을 돌면서 현재댓글과 다음댓글의 시간차이를 저장합니다. # 마지막 댓글은 현재시간과 시간차이를 저장합니다. lastCommentDiffTime = (datetime.now() - datetime.strptime(comments[-1][\"publishedAt\"], \"%y-%m-%d %H:%M:%S\")).total_seconds()/60 comments[-1].update({\"diffTime\": lastCommentDiffTime}) for idx in range(0, len(comments)-1): curr = datetime.strptime(comments[idx][\"publishedAt\"], \"%y-%m-%d %H:%M:%S\") next = datetime.strptime(comments[idx+1][\"publishedAt\"], \"%y-%m-%d %H:%M:%S\") diffTime = (next-curr).total_seconds()/60 # 삭제되는 댓글이 있을 수 있어서 음수가 나오면 0으로 표시합니다. if diffTime \u003c 0: diffTime = 0.00 comments[idx].update({\"diffTime\": diffTime}) def printMostCommenter(self): # 가장 많이 댓글 작성한 사람을 MOST_CNT번 출력합니다. userDict = {} for comment in self.comments: username = f'{comment[\"authorDisplayName\"]} | {comment[\"authorChannelId\"]}' if username in userDict: userDict[username] += 1 else: userDict[username] = 1 mostCommenter = sorted(userDict.items(), key=lambda x:x[1], reverse=True) msg = f'\\n{LINE}\\n👑 가장 댓글 많이 작성한 사람 (총 {format(len(mostCommenter),\",\")}명)\\n' if len(mostCommenter) \u003e MOST_CNT: for idx in range(0, MOST_CNT): msg += f'{mostCommenter[idx][1]}회 | {mostCommenter[idx][0]}\\n' else: for idx in range(0, len(mostCommenter)): msg += f'{mostCommenter[idx][1]}회 | {mostCommenter[idx][0]}\\n' self.printer.saveOnLocal(msg) def printMostLiker(self): # 가장 많이 좋아요 받은 댓글을 MOST_CNT번 출력합니다. mostLiker = [] for comment in sorter(self.comments, 'likeCount'): if comment['likeCount'] \u003e 0: mostLiker.append(comment) else: mostLiker = mostLiker[:MOST_CNT] self.printComments(mostLiker, f'{LINE}\\n👑 가장 좋아요 많이 받은 댓글') def printMostReply(self): # 가장 많이 답글 받은 댓글을 MOST_CNT번 출력합니다. mostReply = [] for comment in sorter(self.comments, 'totalReplyCount'): if comment['totalReplyCount'] \u003e 0: mostReply.append(comment) else: mostReply = mostReply[:MOST_CNT] self.printComments(mostReply, f'{LINE}\\n👑 가장 많이 답글 달린 댓글') def printMostDiffTime(self): # 가장 많이 버틴 댓글을 MOST_CNT번 출력합니다. mostDiffTime = sorter(self.comments, 'diffTime') self.printComments(mostDiffTime[:MOST_CNT], f'{LINE}\\n👑 가장 오래버틴 댓글 (삭제된 댓글은 집계하지 않습니다.)') def printUsersComment(self, username): # 특정 유저가 작성한 댓글을 모두 출력합니다. userComment = [] for comment in self.comments: if comment[\"authorDisplayName\"] == username: userComment.append(comment) if len(userComment) == 0: self.printer.saveOnLocal(f'\\n{LINE}\\n👑 [{username}]님이 작성한 댓글이 없습니다\\n') else: mostLike = sorter(userComment, 'likeCount')[0][\"likeCount\"] mostReply = sorter(userComment, 'totalReplyCount')[0][\"totalReplyCount\"] mostDiffTime = sorter(userComment, 'diffTime')[0][\"diffTime\"] self.printComments(userComment, f'{LINE}\\n👑 [{username}]이 작성한 댓글 (삭제된 댓글은 집계하지 않습니다.)') self.printer.saveOnLocal(f'\\n총 [{format(len(userComment), \",\")}]개의 댓글을 작성하셨습니다.') self.printer.saveOnLocal(f' 💚 [{username}]님이 받은 가장 많은 좋아요 갯수는 [{mostLike}]개 입니다') self.printer.saveOnLocal(f' 📩 [{username}]님이 받은 가장 많은 답글 갯수는 [{mostReply}]개 입니다') self.printer.saveOnLocal(f' ⏰ [{username}]님이 가장 오래 버틴 댓글은 [{mostDiffTime:.2f}]분 입니다') def printComments(self, comments, type=''): # 댓글들을 출력합니다. self.printer.saveOnLocal(f\"\\n{type}\\n{SMALL_LINE}\") msg = '' for comment in comments: msg += self.commentPrettier(comment) msg += '\\n' self.printer.saveOnLocal(msg) def commentPrettier(self, comment): # 댓글을 출력할때 포맷을 정해줍니다. msg = f'{comment[\"publishedAt\"]}\\t닉네임: {comment[\"authorDisplayName\"]} | {comment[\"authorChannelId\"]}\\n\\t\\t\\t댓글: {comment[\"textDisplay\"]:.33s}\\n\\t\\t\\t좋아요: {comment[\"likeCount\"]} | 답글수: {comment[\"totalReplyCount\"]} | 버틴시간: {comment[\"diffTime\"]:.2f}분\\n{SMALL_LINE}' return msg def startDiffTimeEvent(self, stop): # 앞으로 실시간으로 댓글을 불러옵니다 # 프로그램이 추출 이후 삭제한 댓글들도 저장됩니다 msg = f'{LINE}\\n✋ *{stop}분 버티기 이벤트 시작*\\n\u003e 제목: {self.videoInfo[\"title\"]}\\n\u003e 지금부터 {YOUTUBEAPI_REQUEST_PER_TIME}초마다 새로운 댓글을 확인합니다.\\n{LINE}\\n\\n{SMALL_LINE}' self.printer.sendToChat(msg) url = f\"{YOUTUBEAPI_COMMENTTHREADS_URL}?key={self.apikey}\u0026maxResults={LIVE_MAXRESULTS}\u0026part=snippet,replies\u0026videoId={self.videoId}\" # 이미 추출한 댓글의 마지막 댓글은 버틴시간이 없기 때문에 -1 까지 추출합니다. time.sleep(1) self.printer.sendToChat(self.commentPrettier(self.comments[-2])) while True: try: # 이미 추출한 댓글의 publishedAt, authorChannelId 를 합쳐서 고유 key를 생성합니다 prev = self.comments keys = [] for p in prev: key = f'{p[\"publishedAt\"]}{p[\"authorChannelId\"]}' keys.append(key) # comments 리스트에 받아놓는데 에러 발생하면 유튜브 api 키 변경 comments = [] response = requests.get(url).json() try: for item in response[\"items\"]: comments.append(self.validateComment(item)) except Exception as e: print(\"ERROR\", e) self.youtubeAPIExceed() # 새로운 댓글이 나오면 New 배열에 저장합니다. found = False new = [] for comment in comments: key = f'{comment[\"publishedAt\"]}{comment[\"authorChannelId\"]}' if key not in keys: new.append(comment) self.comments.append(comment) found = True # 새로운 댓글 -1 까지 추출 (끝은 diffTime이 없기 떄문) winner = [] if found: self.addDiffTime(self.comments) for comment in self.comments[len(self.comments)-len(new)-1:-1]: if comment[\"diffTime\"] \u003e int(stop): winner.append(comment) self.printer.sendToChat(self.commentPrettier(comment)) # 우승자가 있으면 프로그램 종료 if len(winner) \u003e 0: msg = (f\"\\n@channel\\n👑 {stop}분 버티기 당첨자가 나왔습니다.\\n\") msg += (f'{SMALL_LINE}\\n{self.commentPrettier(winner[0])}\\n') msg += (\"이벤트를 종료합니다.\") self.printer.sendToChat(msg) break # 계속해서 리퀘스트를 보내면 api 일일횟수가 금방 달성하기 떄문에 sleep # 10초가 적당합니다. time.sleep(YOUTUBEAPI_REQUEST_PER_TIME) except Exception as e: # 에러가 나면 api 일일횟수 초과 api 키 변경 print(\"ERROR\", e) self.youtubeAPIExceed() os.system('clear') youtube = Youtube() synology api Synology 챗봇으로 텍스트를 전송하기 위한 간단한 API입니다. 장고로 제작했습니다.\nsynology api 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class Comment(APIView): title = \"배돌이의당구생활\" headers = {'Content-Type': 'text/text; charset=utf-8'} synology = SynologyChat() baedori_url = BAEDORI_BOT_URL def get(self, request): msg = request.data.get(\"msg\") self.synology.send_message(self.baedori_url, self.title, msg) return Response(status=200) class SynologyChat(): headers = {'Content-Type': 'text/text; charset=utf-8'} def send_message(self, url, title, message): message = self.clean_text(message) payload = 'payload={\"text\": \"' + message + '\"}' res = requests.post(url, data=payload.encode('utf-8'), headers=self.headers) time.sleep(1) if res.json()[\"success\"] != True: self.send_error(res, title) def send_error(self, res, title): LogSave(f\"\u003e{ADMIN_NICKNAME} {title} \\nres \u003e {res.json()}\") def clean_text(self, text): text = text.replace(\"%\",\"퍼센트\") # text = re.sub('[%+#\\^@*\\\"※~ㆍ!\u0026;』‘\\(\\)\\\\\\'…》\\”\\“\\’·]', ' ', text) text = re.sub('[%+#\\^\\\"※~ㆍ!\u0026;』‘\\\\\\'…》\\”\\“\\’·]', ' ', text) text = text.replace(\"\n\",\" \").replace(\"\",\"\") text = text.replace(\"\n\", \" \").replace(\"nbsp\", \" \") text = text.replace(\" \", \" \").replace(\" \",\" \") return text exe 파일로 추출 utils.py 코드를 pyinstaller로 exe파일로 추출합니다. 가상환경을 pipenv를 사용했습니다.\n1 2 pipenv install pyinstaller pipenv run pyinstaller -F utils.py 위 커맨드를 진행하면 프로젝트 상위 폴더에 ‘dist’ 디렉토리가 생성되고 exe 파일이 생성됩니다.\n크기는 약 7MB며 아이콘은 따로 변경했습니다.\n결과 1. 모든댓글조회 2. 가장 많은 좋아요 댓글 조회 3. 가장 많은 답글수 댓글 조회 4. 가장 많이 작성한 댓글 조회 5. 가장 많이 작성한 댓글 조회 6. 닉네임 조회 7. 댓글 버티기 이벤트 (일정시간마다 계속 새로운 댓글 확인) 로컬 파일 저장 \u0026 시놀로지 챗봇 프로그램에 출력되는 모든 글은 동시에 로컬에도 저장됩니다.\n7번 댓글 버티기 이벤트 진행시 챗봇으로 모든 댓글이 오게 해놓고 당첨자 발생시 채널에 알럿이 오게 했습니다.\n마치며 유튜브에서 제공하는 API로 여러가지 이벤트를 기획할 수 있습니다. 다음번에는 인스타그램 API로 비슷한 이벤트를 진행해볼까 계획중입니다. 궁금하신 점이 있으시면 댓글로 남겨주시기 바랍니다.\n도움이 되셨으면 배돌이의 당구생활 에도 한번 놀러와주세요 ! 다양한 이벤트 진행중 ~💚\n",
  "wordCount" : "2446",
  "inLanguage": "en",
  "datePublished": "2023-04-28T00:00:00Z",
  "dateModified": "2023-04-28T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "cha2hyun"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cha2hyun.blog/content/projects/%EB%B0%B0%EB%8F%8C%EC%9D%B4%EC%9D%98%EB%8B%B9%EA%B5%AC%EC%83%9D%ED%99%9C/youtube-comment-event/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "채수현 개발일지",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cha2hyun.blog/favicon/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cha2hyun.blog/" accesskey="h" title="채수현 개발일지 (Alt + H)">채수현 개발일지<span style="justify-content: center; padding-left:7px;">
                    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fcha2hyun.blog&count_bg=%23000000&title_bg=%23000000&icon=&icon_color=%23E7E7E7&title=HITS&edge_flat=false"/>
                </span>
                <div style="font-size: 14px; margin-top:-30px; font-weight: normal;">📚 기억은 유한하나, 기록은 무한하다</div>
            </a>            
        </div>
        <ul id="menu">
            <li>
                <a href="https://cha2hyun.blog/archives" title="전체">
                    <span style="font-weight: bold;">전체</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/posts/" title="개발일상">
                    <span style="font-weight: bold;">개발일상</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/projects/" title="프로젝트">
                    <span style="font-weight: bold;">프로젝트</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/algorithm/" title="알고리즘">
                    <span style="font-weight: bold;">알고리즘</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/search/" title="검색">
                    <span style="font-weight: bold;">검색</span>
                </a>
            </li>
            <li>
                <div class="logo-switches">
                    <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
            </li>
        </ul>
        
    </nav>
    
    
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cha2hyun.blog/">Home</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/">Contents</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/projects/">Projects</a></div>
    <h1 class="post-title entry-hint-parent">
      유튜브 API를 이용한 댓글 오래 버티기 이벤트
    </h1>
    <div class="post-meta"><span title='2023-04-28 00:00:00 +0000 UTC'>April 28, 2023</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;cha2hyun


    </div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0" aria-label="들어가며">들어가며</a></li>
                <li>
                    <a href="#%ec%bd%94%eb%93%9c--%ec%bd%94%eb%93%9c%ec%84%a4%eb%aa%85" aria-label="코드 &amp; 코드설명">코드 &amp; 코드설명</a><ul>
                        
                <li>
                    <a href="#constantpy" aria-label="constant.py">constant.py</a></li>
                <li>
                    <a href="#crwalerpy" aria-label="crwaler.py">crwaler.py</a></li>
                <li>
                    <a href="#synology-api" aria-label="synology api">synology api</a></li>
                <li>
                    <a href="#exe-%ed%8c%8c%ec%9d%bc%eb%a1%9c-%ec%b6%94%ec%b6%9c" aria-label="exe 파일로 추출">exe 파일로 추출</a></li></ul>
                </li>
                <li>
                    <a href="#%ea%b2%b0%ea%b3%bc" aria-label="결과">결과</a><ul>
                        
                <li>
                    <a href="#1-%eb%aa%a8%eb%93%a0%eb%8c%93%ea%b8%80%ec%a1%b0%ed%9a%8c" aria-label="1. 모든댓글조회">1. 모든댓글조회</a></li>
                <li>
                    <a href="#2-%ea%b0%80%ec%9e%a5-%eb%a7%8e%ec%9d%80-%ec%a2%8b%ec%95%84%ec%9a%94-%eb%8c%93%ea%b8%80-%ec%a1%b0%ed%9a%8c" aria-label="2. 가장 많은 좋아요 댓글 조회">2. 가장 많은 좋아요 댓글 조회</a></li>
                <li>
                    <a href="#3-%ea%b0%80%ec%9e%a5-%eb%a7%8e%ec%9d%80-%eb%8b%b5%ea%b8%80%ec%88%98-%eb%8c%93%ea%b8%80-%ec%a1%b0%ed%9a%8c" aria-label="3. 가장 많은 답글수 댓글 조회">3. 가장 많은 답글수 댓글 조회</a></li>
                <li>
                    <a href="#4-%ea%b0%80%ec%9e%a5-%eb%a7%8e%ec%9d%b4-%ec%9e%91%ec%84%b1%ed%95%9c-%eb%8c%93%ea%b8%80-%ec%a1%b0%ed%9a%8c" aria-label="4. 가장 많이 작성한 댓글 조회">4. 가장 많이 작성한 댓글 조회</a></li>
                <li>
                    <a href="#5-%ea%b0%80%ec%9e%a5-%eb%a7%8e%ec%9d%b4-%ec%9e%91%ec%84%b1%ed%95%9c-%eb%8c%93%ea%b8%80-%ec%a1%b0%ed%9a%8c" aria-label="5. 가장 많이 작성한 댓글 조회">5. 가장 많이 작성한 댓글 조회</a></li>
                <li>
                    <a href="#6-%eb%8b%89%eb%84%a4%ec%9e%84-%ec%a1%b0%ed%9a%8c" aria-label="6. 닉네임 조회">6. 닉네임 조회</a></li>
                <li>
                    <a href="#7-%eb%8c%93%ea%b8%80-%eb%b2%84%ed%8b%b0%ea%b8%b0-%ec%9d%b4%eb%b2%a4%ed%8a%b8-%ec%9d%bc%ec%a0%95%ec%8b%9c%ea%b0%84%eb%a7%88%eb%8b%a4-%ea%b3%84%ec%86%8d-%ec%83%88%eb%a1%9c%ec%9a%b4-%eb%8c%93%ea%b8%80-%ed%99%95%ec%9d%b8" aria-label="7. 댓글 버티기 이벤트 (일정시간마다 계속 새로운 댓글 확인)">7. 댓글 버티기 이벤트 (일정시간마다 계속 새로운 댓글 확인)</a></li>
                <li>
                    <a href="#%eb%a1%9c%ec%bb%ac-%ed%8c%8c%ec%9d%bc-%ec%a0%80%ec%9e%a5--%ec%8b%9c%eb%86%80%eb%a1%9c%ec%a7%80-%ec%b1%97%eb%b4%87" aria-label="로컬 파일 저장 &amp; 시놀로지 챗봇">로컬 파일 저장 &amp; 시놀로지 챗봇</a></li></ul>
                </li>
                <li>
                    <a href="#%eb%a7%88%ec%b9%98%eb%a9%b0" aria-label="마치며">마치며</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><br>
<h3 id="들어가며">들어가며<a hidden class="anchor" aria-hidden="true" href="#들어가며">#</a></h3>
<p>유튜브 채널 팩토리 님께서 진행해주신 레전드 컨텐츠 이벤트가 있습니다. (아마도 팩토리님은 개발자일지도)
<figure class="align-center ">
    <img loading="lazy" src="../img/44.png#center"
         alt="아직도 안끝나고 댓글이 150만개가 달려서 세계10위에 들었다고 합니다"/> <figcaption>
            <p>아직도 안끝나고 댓글이 150만개가 달려서 세계10위에 들었다고 합니다</p>
        </figcaption>
</figure>
</p>
<br>
<p>배돌이의 당구생활 유튜브에서도 비슷한 다양한 이벤트들을 진행중입니다.</p>
<ol>
<li>라이브에서 실시간 추첨 <a href="/projects/배돌이의당구생활/youtube-live-crawling">(참고글)</a></li>
<li>컨텐츠에 댓글달고 오랫동안 버틴사람</li>
<li>컨텐츠 댓글중 좋아요가 가장 많은 사람</li>
<li>컨텐츠 댓글중 답글이 제일 많은 사람</li>
<li>컨텐츠에 댓글을 가장 많이 작성한 사람</li>
</ol>
<p>위 뿐만 아니라 여러가지 이벤트들을 진행&amp;기획중으로 프로그램을 제작하게 되었습니다.
<figure class="align-center ">
    <img loading="lazy" src="../img/6.gif#center"/> 
</figure>
</p>
<br/>
<h3 id="코드--코드설명">코드 &amp; 코드설명<a hidden class="anchor" aria-hidden="true" href="#코드--코드설명">#</a></h3>
<h4 id="constantpy">constant.py<a hidden class="anchor" aria-hidden="true" href="#constantpy">#</a></h4>
<p>상수를 모아놓은 파일입니다.


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      constant.py
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">LINE</span> <span class="o">=</span> <span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">28</span>
</span></span><span class="line"><span class="cl"><span class="n">SMALL_LINE</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">65</span>
</span></span><span class="line"><span class="cl"><span class="n">SYNOLOGY_LINE</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">38</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_KEY</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_SUB_KEY</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_VIDEOS_URL</span> <span class="o">=</span> <span class="s2">&#34;https://www.googleapis.com/youtube/v3/videos&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_COMMENTTHREADS_URL</span> <span class="o">=</span> <span class="s2">&#34;https://www.googleapis.com/youtube/v3/commentThreads&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_REQUEST_PER_TIME</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">YOUTUBEAPI_RESEND_TIMEOUT</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">MOST_CNT</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">MAXRESULTS</span> <span class="o">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="n">LIVE_MAXRESULTS</span> <span class="o">=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># SYNOLOGY CHAT에 보낼 경우</span>
</span></span><span class="line"><span class="cl"><span class="n">SYNOLOGYAPI_URL</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>    <span class="c1"># 메세지를 처리하는 api를 따로 만들어야합니다.</span>
</span></span><span class="line"><span class="cl"><span class="n">SYNOLOGYAPI_REQUEST_PER_TIME</span> <span class="o">=</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">SYNOLOGYCHAT_LINE_SPLIT</span> <span class="o">=</span> <span class="mi">5</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />
</p>
<h4 id="crwalerpy">crwaler.py<a hidden class="anchor" aria-hidden="true" href="#crwalerpy">#</a></h4>
<p>프로그램 코어입니다. 설명은 주석으로 달아놓았습니다.


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      crwaler.py
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">constant</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">utc_to_local</span><span class="p">(</span><span class="n">utc_dt</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 유튜브 API 로 받아오면 미국 시간으로 받아와짐</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 미국 &gt; 한국으로 변경</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">utc_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sorter</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># [{},{},..,{}] 리스트에서 딕셔너리의 밸류를 이용해 정렬</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">listDivider</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># arr배열을 n개씩 나누어 배열로 감싸 리턴합니다.</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">n</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Printer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. 화면에 출력</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 2. 로컬에 저장</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. 시놀로지채팅에 전송</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 위 3가지를 담당하는 클래스</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 파일 저장할 디렉토리 생성</span>
</span></span><span class="line"><span class="cl">        <span class="n">today</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="n">current</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Error: Cannot create the directory </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">saveOnLocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 출력하고 파일에 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">sendToChat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 시놀로지채팅에 보내고, 출력하고, 로컬에 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 텍스트가 너무 길면 시놀로지챗에서 410 에러를 반환한다. n 줄씩 끊어서 배열로 리턴 (\n으로)</span>
</span></span><span class="line"><span class="cl">        <span class="n">msgs_array</span> <span class="o">=</span> <span class="n">listDivider</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">SYNOLOGYCHAT_LINE_SPLIT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 시놀로지에서 이쁘게 표시되게 변경합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">msgs</span> <span class="ow">in</span> <span class="n">msgs_array</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">SMALL_LINE</span><span class="p">,</span> <span class="n">SYNOLOGY_LINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;  &#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;닉네임&#34;</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">닉네임&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;| @&#34;</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">@&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 해당 텍스트를 시놀로지 챗봇으로 보낼 수 있는 API를 만들어놓았습니다.</span>
</span></span><span class="line"><span class="cl">            <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SYNOLOGYAPI_URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;msg&#34;</span><span class="p">:</span><span class="n">text</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SYNOLOGYAPI_REQUEST_PER_TIME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Youtube</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">apikey</span> <span class="o">=</span> <span class="n">YOUTUBEAPI_KEY</span>
</span></span><span class="line"><span class="cl">    <span class="n">videoId</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">videoInfo</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>        <span class="c1"># 제목</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># 설명</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;viewCount&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="c1"># 조회수</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;likeCount&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="c1"># 좋아요</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;commentCount&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># 댓글수</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">comments</span> <span class="o">=</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;authorDisplayName&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>    <span class="c1"># 닉네임</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;textDisplay&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="c1"># 댓글</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;publisedAt&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>           <span class="c1"># 작성일</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;likeCount&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>            <span class="c1"># 좋아요</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;diffTime&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>             <span class="c1"># 다음글 작성시간의 차이</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;authorChannelId&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>      <span class="c1"># 유저 채널 아이디 (고유값)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;totalReplyCount&#34;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>      <span class="c1"># 답글 수</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">greeting</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 유저한테 동영상 ID를 받아오고</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">videoId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoId</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 동영상 정보를 출력하고</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">videoInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoInfo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 동영상의 댓글을 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVideoComments</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 저장된 댓글을 분석해서 몇분만에 다음 댓글이 달렸는지 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">addDiffTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;유튜브 댓글 조회 프로그램</span><span class="se">\n</span><span class="s2">by.배돌이의당구생활 채PD&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  0. 종료&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  1. 모든 댓글 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  2. 가장 많은 좋아요 댓글 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  3. 가장 많은 답글수 댓글 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  4. 가장 많이 작성한 사람 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  5. 가장 오래 버틴 댓글 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  6. 닉네임 조회&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  7. 댓글 버티기 이벤트 시작&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;  8. 다른 영상 조회하기&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;번호를 입력해주세요 : &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; &gt; 입력된 번호 : </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;0&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 종료</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="s2">&#34;프로그램을 종료합니다.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;1&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 모든 댓글 조회</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printComments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;2&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 가장 많은 좋아요</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printMostLiker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;3&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 가장 많은 답글수</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printMostReply</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;4&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 가장 많이 작성한 사람</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printMostCommenter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;5&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 가장 오래 버틴 댓글</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printMostDiffTime</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;6&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 유저 검색</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;검색할 닉네임을 적어주세요 : &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">printUsersComment</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;7&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 버티기 이벤트 시작</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">LINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;🚨   댓글 고정이 없는지 확인해주세요. 되어있다면 고정해제 해주세요.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;🚨   이벤트가 종료될 때 까지 프로그램은 계속 진행됩니다.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">LINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">stop</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;  &gt; 몇 분 버티기를 하실건지 입력해주세요 : &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">startDiffTimeEvent</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;8&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 다른 동영상 조회</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">✋ 프로그램이 시작됩니다. </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;%y년 %m월 </span><span class="si">%d</span><span class="s2">일 %H:%M:%S&#34;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&gt;  By.배돌이의당구생활 채PD</span><span class="se">\n</span><span class="s1">&gt;  영상 댓글 이벤트</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">youtubeAPIExceed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 유튜브 API가 일일 한도가 정해져 있음.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 일일한도를 초과하면 다른 키로 변경합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">sendToChat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;🚨 유튜브 API 요청 한도 초과. </span><span class="si">{</span><span class="n">YOUTUBEAPI_RESEND_TIMEOUT</span><span class="si">}</span><span class="s1">초 후 다시 시도합니다.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">==</span> <span class="n">YOUTUBEAPI_KEY</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">=</span> <span class="n">YOUTUBEAPI_SUB_KEY</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">==</span> <span class="n">YOUTUBEAPI_SUB_KEY</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">=</span> <span class="n">YOUTUBEAPI_KEY</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">YOUTUBEAPI_RESEND_TIMEOUT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">youtubeNotFound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 유튜브 url을 찾지 못했을 경우</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;🚨 해당 유튜브 영상 URL을 확인할 수 없습니다. 다시 시도해주세요.</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getVideoId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">videoId</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;1️⃣  영상 URL을 입력해주세요 : &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 유튜브 URL 인지 확인</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="s1">&#39;youtu&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">videoId</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">raise</span> <span class="ne">Exception</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="s1">&#39;watch?v=&#39;</span> <span class="ow">in</span> <span class="n">videoId</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">videoId</span> <span class="o">=</span> <span class="n">videoId</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">videoId</span> <span class="o">=</span> <span class="n">videoId</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">videoId</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;🚨 해당 영상을 확인할 수 없습니다. 다시 입력해주세요.&#34;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">LINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getVideoInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 유저로부터 받은 동영상url이 정상적인지 확인하고 정상인 경우 동영상 정보를 리턴합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">YOUTUBEAPI_VIDEOS_URL</span><span class="si">}</span><span class="s2">?key=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="si">}</span><span class="s2">&amp;part=snippet,statistics&amp;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">videoId</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">items</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;items&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># url이 잘못되어도 status 200값과 함께 items는 빈 배열을 리턴합니다.</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">youtubeNotFound</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">title</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;title&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;description&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">description</span><span class="p">[:</span><span class="mi">25</span><span class="p">]</span><span class="si">}</span><span class="s1">...&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">commentCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;statistics&#34;</span><span class="p">][</span><span class="s2">&#34;commentCount&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">likeCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;statistics&#34;</span><span class="p">][</span><span class="s2">&#34;likeCount&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">viewCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;statistics&#34;</span><span class="p">][</span><span class="s2">&#34;viewCount&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;✅ 영상이 확인되었습니다.</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&gt;  제목: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&gt;  설명: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&#34;&gt;  조회수 </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">viewCount</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> | 좋아요 </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">likeCount</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> | 댓글수 </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">commentCount</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="n">LINE</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;viewCount&#34;</span><span class="p">:</span> <span class="n">viewCount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;likeCount&#34;</span><span class="p">:</span> <span class="n">likeCount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;commentCount&#34;</span><span class="p">:</span> <span class="n">commentCount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 200을 리턴받지 않으면 유튜브 api 일일한도 초과로 403을 리턴받습니다.</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">youtubeAPIExceed</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getVideoComments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;2️⃣  댓글을 가져옵니다.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">YOUTUBEAPI_COMMENTTHREADS_URL</span><span class="si">}</span><span class="s2">?key=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="si">}</span><span class="s2">&amp;maxResults=</span><span class="si">{</span><span class="n">MAXRESULTS</span><span class="si">}</span><span class="s2">&amp;part=snippet,replies&amp;videoId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">videoId</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 동영상의 댓글을 불러옵니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">getComments</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;publishedAt&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;✅ 모든 댓글이 확인되었습니다.</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getComments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">cnt</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1회 요청에 100개까지 받아올 수 있고 100개가 초과하는 댓글의 동영상은 다음 페이지 토큰이 주어집니다.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 재귀적으로 다음 페이지 토큰이 없을때 까지 실행됩니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">percent</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">MAXRESULTS</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoInfo</span><span class="p">[</span><span class="s2">&#34;commentCount&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">percent</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">        <span class="n">currCnt</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">MAXRESULTS</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;- (</span><span class="si">{</span><span class="n">percent</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">%) </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">currCnt</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">개 까지 추출중...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&#34;items&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validateComment</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Exception 발생은 api 일일조회를 초과했을 때 나타납니다.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># api 키를 바꾸고 현재 댓글을 다시 조회합니다.</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">youtubeAPIExceed</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">getComments</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;nextPageToken&#34;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 다음 댓글이 있으면 재귀로 다시 불러옵니다.</span>
</span></span><span class="line"><span class="cl">            <span class="n">nextPageToken</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&#34;nextPageToken&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">getComments</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&amp;pageToken=</span><span class="si">{</span><span class="n">nextPageToken</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validateComment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># api로 받은 json 에서 필요한 값만 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">publisedAt</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;topLevelComment&#34;</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">publisedAt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">publisedAt</span><span class="p">,</span> <span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">publisedAt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">utc_to_local</span><span class="p">(</span><span class="n">publisedAt</span><span class="p">),</span> <span class="s2">&#34;%y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">comment</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;publishedAt&#34;</span> <span class="p">:</span> <span class="n">publisedAt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;authorDisplayName&#34;</span> <span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;topLevelComment&#34;</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;authorDisplayName&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># &lt;a href=&#34;about:invalid#zCSafez&#34;&gt;&lt;/a&gt;는 PC에서 유튜브에만 존재하는 이모티콘이 이러게 나옵니다</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;textDisplay&#34;</span> <span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;topLevelComment&#34;</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;textDisplay&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&amp;quot;&#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&#34;about:invalid#zCSafez&#34;&gt;&lt;/a&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;[이모티콘]&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;likeCount&#34;</span> <span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;topLevelComment&#34;</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;likeCount&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;authorChannelId&#34;</span> <span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;@</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;topLevelComment&#34;</span><span class="p">][</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;authorChannelId&#34;</span><span class="p">][</span><span class="s2">&#34;value&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;totalReplyCount&#34;</span> <span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;snippet&#34;</span><span class="p">][</span><span class="s2">&#34;totalReplyCount&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">comment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">addDiffTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comments</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 배열을 돌면서 현재댓글과 다음댓글의 시간차이를 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 마지막 댓글은 현재시간과 시간차이를 저장합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">lastCommentDiffTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">],</span> <span class="s2">&#34;%y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
</span></span><span class="line"><span class="cl">        <span class="n">comments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;diffTime&#34;</span><span class="p">:</span> <span class="n">lastCommentDiffTime</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">curr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">],</span> <span class="s2">&#34;%y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">next</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">],</span> <span class="s2">&#34;%y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">diffTime</span> <span class="o">=</span> <span class="p">(</span><span class="nb">next</span><span class="o">-</span><span class="n">curr</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 삭제되는 댓글이 있을 수 있어서 음수가 나오면 0으로 표시합니다.</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">diffTime</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">diffTime</span> <span class="o">=</span> <span class="mf">0.00</span>
</span></span><span class="line"><span class="cl">            <span class="n">comments</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;diffTime&#34;</span><span class="p">:</span> <span class="n">diffTime</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printMostCommenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 가장 많이 댓글 작성한 사람을 MOST_CNT번 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">userDict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorDisplayName&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorChannelId&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">userDict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">userDict</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">userDict</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">mostCommenter</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">userDict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 가장 댓글 많이 작성한 사람 (총 </span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mostCommenter</span><span class="p">),</span><span class="s2">&#34;,&#34;</span><span class="p">)</span><span class="si">}</span><span class="s1">명)</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mostCommenter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MOST_CNT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MOST_CNT</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mostCommenter</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">회 | </span><span class="si">{</span><span class="n">mostCommenter</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mostCommenter</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mostCommenter</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">회 | </span><span class="si">{</span><span class="n">mostCommenter</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printMostLiker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 가장 많이 좋아요 받은 댓글을 MOST_CNT번 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">mostLiker</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span> <span class="s1">&#39;likeCount&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">comment</span><span class="p">[</span><span class="s1">&#39;likeCount&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mostLiker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mostLiker</span> <span class="o">=</span> <span class="n">mostLiker</span><span class="p">[:</span><span class="n">MOST_CNT</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printComments</span><span class="p">(</span><span class="n">mostLiker</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 가장 좋아요 많이 받은 댓글&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printMostReply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 가장 많이 답글 받은 댓글을 MOST_CNT번 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">mostReply</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span> <span class="s1">&#39;totalReplyCount&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">comment</span><span class="p">[</span><span class="s1">&#39;totalReplyCount&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mostReply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mostReply</span> <span class="o">=</span> <span class="n">mostReply</span><span class="p">[:</span><span class="n">MOST_CNT</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printComments</span><span class="p">(</span><span class="n">mostReply</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 가장 많이 답글 달린 댓글&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printMostDiffTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 가장 많이 버틴 댓글을 MOST_CNT번 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">mostDiffTime</span> <span class="o">=</span> <span class="n">sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span> <span class="s1">&#39;diffTime&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printComments</span><span class="p">(</span><span class="n">mostDiffTime</span><span class="p">[:</span><span class="n">MOST_CNT</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 가장 오래버틴 댓글 (삭제된 댓글은 집계하지 않습니다.)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printUsersComment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 특정 유저가 작성한 댓글을 모두 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">userComment</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorDisplayName&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">userComment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userComment</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 [</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">]님이 작성한 댓글이 없습니다</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mostLike</span> <span class="o">=</span> <span class="n">sorter</span><span class="p">(</span><span class="n">userComment</span><span class="p">,</span> <span class="s1">&#39;likeCount&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;likeCount&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">mostReply</span> <span class="o">=</span> <span class="n">sorter</span><span class="p">(</span><span class="n">userComment</span><span class="p">,</span> <span class="s1">&#39;totalReplyCount&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;totalReplyCount&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">mostDiffTime</span> <span class="o">=</span> <span class="n">sorter</span><span class="p">(</span><span class="n">userComment</span><span class="p">,</span> <span class="s1">&#39;diffTime&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;diffTime&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printComments</span><span class="p">(</span><span class="n">userComment</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">👑 [</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">]이 작성한 댓글 (삭제된 댓글은 집계하지 않습니다.)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">총 [</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">userComment</span><span class="p">),</span> <span class="s2">&#34;,&#34;</span><span class="p">)</span><span class="si">}</span><span class="s1">]개의 댓글을 작성하셨습니다.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  💚 [</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">]님이 받은 가장 많은 좋아요 갯수는 [</span><span class="si">{</span><span class="n">mostLike</span><span class="si">}</span><span class="s1">]개 입니다&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  📩 [</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">]님이 받은 가장 많은 답글 갯수는 [</span><span class="si">{</span><span class="n">mostReply</span><span class="si">}</span><span class="s1">]개 입니다&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  ⏰ [</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">]님이 가장 오래 버틴 댓글은 [</span><span class="si">{</span><span class="n">mostDiffTime</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">]분 입니다&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">printComments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 댓글들을 출력합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">SMALL_LINE</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commentPrettier</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">saveOnLocal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">commentPrettier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 댓글을 출력할때 포맷을 정해줍니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s1">닉네임: </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorDisplayName&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorChannelId&#34;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\t\t\t</span><span class="s1">댓글: </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;textDisplay&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">.33s</span><span class="si">}</span><span class="se">\n\t\t\t</span><span class="s1">좋아요: </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;likeCount&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> | 답글수: </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;totalReplyCount&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1"> | 버틴시간: </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;diffTime&#34;</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">분</span><span class="se">\n</span><span class="si">{</span><span class="n">SMALL_LINE</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">msg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">startDiffTimeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 앞으로 실시간으로 댓글을 불러옵니다</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 프로그램이 추출 이후 삭제한 댓글들도 저장됩니다</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n</span><span class="s1">✋ *</span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s1">분 버티기 이벤트 시작*</span><span class="se">\n</span><span class="s1">&gt; 제목: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">videoInfo</span><span class="p">[</span><span class="s2">&#34;title&#34;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&gt; 지금부터 </span><span class="si">{</span><span class="n">YOUTUBEAPI_REQUEST_PER_TIME</span><span class="si">}</span><span class="s1">초마다 새로운 댓글을 확인합니다.</span><span class="se">\n</span><span class="si">{</span><span class="n">LINE</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">SMALL_LINE</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">sendToChat</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">YOUTUBEAPI_COMMENTTHREADS_URL</span><span class="si">}</span><span class="s2">?key=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="si">}</span><span class="s2">&amp;maxResults=</span><span class="si">{</span><span class="n">LIVE_MAXRESULTS</span><span class="si">}</span><span class="s2">&amp;part=snippet,replies&amp;videoId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">videoId</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 이미 추출한 댓글의 마지막 댓글은 버틴시간이 없기 때문에 -1 까지 추출합니다.</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">sendToChat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commentPrettier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 이미 추출한 댓글의 publishedAt, authorChannelId 를 합쳐서 고유 key를 생성합니다</span>
</span></span><span class="line"><span class="cl">                <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span>
</span></span><span class="line"><span class="cl">                <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prev</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">]</span><span class="si">}{</span><span class="n">p</span><span class="p">[</span><span class="s2">&#34;authorChannelId&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># comments 리스트에 받아놓는데 에러 발생하면 유튜브 api 키 변경</span>
</span></span><span class="line"><span class="cl">                <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&#34;items&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validateComment</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ERROR&#34;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">youtubeAPIExceed</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># 새로운 댓글이 나오면 New 배열에 저장합니다.</span>
</span></span><span class="line"><span class="cl">                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;publishedAt&#34;</span><span class="p">]</span><span class="si">}{</span><span class="n">comment</span><span class="p">[</span><span class="s2">&#34;authorChannelId&#34;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># 새로운 댓글 -1 까지 추출 (끝은 diffTime이 없기 떄문)</span>
</span></span><span class="line"><span class="cl">                <span class="n">winner</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">addDiffTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">comment</span><span class="p">[</span><span class="s2">&#34;diffTime&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                            <span class="n">winner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">sendToChat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commentPrettier</span><span class="p">(</span><span class="n">comment</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># 우승자가 있으면 프로그램 종료</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">@channel</span><span class="se">\n</span><span class="s2">👑  </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s2">분 버티기 당첨자가 나왔습니다.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SMALL_LINE</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">commentPrettier</span><span class="p">(</span><span class="n">winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&#34;이벤트를 종료합니다.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">sendToChat</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># 계속해서 리퀘스트를 보내면 api 일일횟수가 금방 달성하기 떄문에 sleep</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 10초가 적당합니다.</span>
</span></span><span class="line"><span class="cl">                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">YOUTUBEAPI_REQUEST_PER_TIME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 에러가 나면 api 일일횟수 초과 api 키 변경</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ERROR&#34;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">youtubeAPIExceed</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">youtube</span> <span class="o">=</span> <span class="n">Youtube</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />
</p>
<h4 id="synology-api">synology api<a hidden class="anchor" aria-hidden="true" href="#synology-api">#</a></h4>
<p>Synology 챗봇으로 텍스트를 전송하기 위한 간단한 API입니다. 장고로 제작했습니다.</p>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      synology api
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="s2">&#34;배돌이의당구생활&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/text; charset=utf-8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">synology</span> <span class="o">=</span> <span class="n">SynologyChat</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">baedori_url</span> <span class="o">=</span> <span class="n">BAEDORI_BOT_URL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;msg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">synology</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baedori_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SynologyChat</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/text; charset=utf-8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;payload={&#34;text&#34;: &#34;&#39;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s1">&#39;&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&#34;success&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">send_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">LogSave</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&gt;</span><span class="si">{</span><span class="n">ADMIN_NICKNAME</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">res &gt; </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;%&#34;</span><span class="p">,</span><span class="s2">&#34;퍼센트&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># text = re.sub(&#39;[%+#\^@*\&#34;※~ㆍ!&amp;;』‘\(\)\\\&#39;…》\”\“\’·]&#39;, &#39; &#39;, text)</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[%+#\^</span><span class="se">\&#34;</span><span class="s1">※~ㆍ!&amp;;』‘</span><span class="se">\\\&#39;</span><span class="s1">…》\”\“\’·]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&lt;/p&gt;&#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&lt;p&gt;&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;nbsp&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;  &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;  &#34;</span><span class="p">,</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">text</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="exe-파일로-추출">exe 파일로 추출<a hidden class="anchor" aria-hidden="true" href="#exe-파일로-추출">#</a></h4>
<p>utils.py 코드를 pyinstaller로 exe파일로 추출합니다. 가상환경을 pipenv를 사용했습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pipenv install pyinstaller
</span></span><span class="line"><span class="cl">pipenv run pyinstaller -F utils.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>위 커맨드를 진행하면 프로젝트 상위 폴더에 &lsquo;dist&rsquo; 디렉토리가 생성되고 exe 파일이 생성됩니다.</p>
<p><figure class="align-center ">
    <img loading="lazy" src="../img/23.png#center"/> 
</figure>

크기는 약 7MB며 아이콘은 따로 변경했습니다.</p>
<h3 id="결과">결과<a hidden class="anchor" aria-hidden="true" href="#결과">#</a></h3>
<h4 id="1-모든댓글조회">1. 모든댓글조회<a hidden class="anchor" aria-hidden="true" href="#1-모든댓글조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/7.gif#center"/> 
</figure>

<h4 id="2-가장-많은-좋아요-댓글-조회">2. 가장 많은 좋아요 댓글 조회<a hidden class="anchor" aria-hidden="true" href="#2-가장-많은-좋아요-댓글-조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/25.png#center"/> 
</figure>

<h4 id="3-가장-많은-답글수-댓글-조회">3. 가장 많은 답글수 댓글 조회<a hidden class="anchor" aria-hidden="true" href="#3-가장-많은-답글수-댓글-조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/26.png#center"/> 
</figure>

<h4 id="4-가장-많이-작성한-댓글-조회">4. 가장 많이 작성한 댓글 조회<a hidden class="anchor" aria-hidden="true" href="#4-가장-많이-작성한-댓글-조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/27.png#center"/> 
</figure>

<h4 id="5-가장-많이-작성한-댓글-조회">5. 가장 많이 작성한 댓글 조회<a hidden class="anchor" aria-hidden="true" href="#5-가장-많이-작성한-댓글-조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/28.png#center"/> 
</figure>

<h4 id="6-닉네임-조회">6. 닉네임 조회<a hidden class="anchor" aria-hidden="true" href="#6-닉네임-조회">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/29.png#center"/> 
</figure>

<h4 id="7-댓글-버티기-이벤트-일정시간마다-계속-새로운-댓글-확인">7. 댓글 버티기 이벤트 (일정시간마다 계속 새로운 댓글 확인)<a hidden class="anchor" aria-hidden="true" href="#7-댓글-버티기-이벤트-일정시간마다-계속-새로운-댓글-확인">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="../img/8.gif#center"/> 
</figure>

<h4 id="로컬-파일-저장--시놀로지-챗봇">로컬 파일 저장 &amp; 시놀로지 챗봇<a hidden class="anchor" aria-hidden="true" href="#로컬-파일-저장--시놀로지-챗봇">#</a></h4>
<p><figure class="align-center ">
    <img loading="lazy" src="../img/30.png#center"/> 
</figure>

프로그램에 출력되는 모든 글은 동시에 로컬에도 저장됩니다.</p>
<p><figure class="align-center ">
    <img loading="lazy" src="../img/24.png#center"/> 
</figure>

7번 댓글 버티기 이벤트 진행시 챗봇으로 모든 댓글이 오게 해놓고 당첨자 발생시 채널에 알럿이 오게 했습니다.</p>
<br/>
<h3 id="마치며">마치며<a hidden class="anchor" aria-hidden="true" href="#마치며">#</a></h3>
<p>유튜브에서 제공하는 API로 여러가지 이벤트를 기획할 수 있습니다. 다음번에는 인스타그램 API로 비슷한 이벤트를 진행해볼까 계획중입니다. 궁금하신 점이 있으시면 댓글로 남겨주시기 바랍니다.</p>
<p>도움이 되셨으면 <a href="https://www.youtube.com/@Baedori." target="_blank">배돌이의 당구생활</a> 에도 한번 놀러와주세요 ! 다양한 이벤트 진행중 ~💚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cha2hyun.blog/tags/python/">python</a></li>
      <li><a href="https://cha2hyun.blog/tags/websockets/">websockets</a></li>
      <li><a href="https://cha2hyun.blog/tags/bs4/">bs4</a></li>
      <li><a href="https://cha2hyun.blog/tags/selenium/">selenium</a></li>
      <li><a href="https://cha2hyun.blog/tags/crawling/">crawling</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cha2hyun.blog/content/posts/synologychat/">
    <span class="title">« Prev</span>
    <br>
    <span>Synology Chat 멘션 색상 바꾸기</span>
  </a>
  <a class="next" href="https://cha2hyun.blog/content/projects/%EB%B0%B0%EB%8F%8C%EC%9D%B4%EC%9D%98%EB%8B%B9%EA%B5%AC%EC%83%9D%ED%99%9C/youtube-live-crawling/">
    <span class="title">Next »</span>
    <br>
    <span>유튜브 라이브 실시간채팅 크롤링</span>
  </a>
</nav>


<div
  style="
    padding-top: 15px;
    padding-bottom: 2px;
    font-size: x-large;
    font-weight: 700;
  "
>
  궁금하신 점이 있으신가요? 😀
</div>





<script
  src="https://giscus.app/client.js"
  data-repo="cha2hyun/cha2hyun.github.io"
  data-repo-id="R_kgDOICTfkg"
  data-category="Comments"
  data-category-id="DIC_kwDOICTfks4CcDAW"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="dark_dimmed"
  data-lang="ko"
  crossorigin="anonymous"
  async
></script>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://cha2hyun.blog/">채수현 개발일지</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
