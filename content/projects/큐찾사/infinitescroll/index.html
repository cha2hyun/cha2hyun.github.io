<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>InfiniteScroll로 무한 스크롤 구현하기 | 채수현 개발일지</title>
<meta name="keywords" content="Next.js, React Query, Infinite Scroll, Modal, LocalStorage">
<meta name="description" content="무한 스크롤과 뒤로가기시 스크롤된 위치를 기억하기.">
<meta name="author" content="cha2hyun">
<link rel="canonical" href="https://cha2hyun.blog/content/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.06cc1401233af506ee36c5cc89872a4bb4866704e48f666797e0ab85a990bd8f.css" integrity="sha256-BswUASM69QbuNsXMiYcqS7SGZwTkj2Znl&#43;CrhamQvY8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cha2hyun.blog/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cha2hyun.blog/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cha2hyun.blog/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cha2hyun.blog/favicon/apple-icon-76x76.png">
<link rel="mask-icon" href="https://cha2hyun.blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="InfiniteScroll로 무한 스크롤 구현하기" />
<meta property="og:description" content="무한 스크롤과 뒤로가기시 스크롤된 위치를 기억하기." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cha2hyun.blog/content/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/" /><meta property="og:image" content="https://cha2hyun.blog/papermod-cover.png"/><meta property="article:section" content="content" />
<meta property="article:published_time" content="2023-01-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-04T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cha2hyun.blog/papermod-cover.png"/>

<meta name="twitter:title" content="InfiniteScroll로 무한 스크롤 구현하기"/>
<meta name="twitter:description" content="무한 스크롤과 뒤로가기시 스크롤된 위치를 기억하기."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Contents",
      "item": "https://cha2hyun.blog/content/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Projects",
      "item": "https://cha2hyun.blog/content/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "InfiniteScroll로 무한 스크롤 구현하기",
      "item": "https://cha2hyun.blog/content/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "InfiniteScroll로 무한 스크롤 구현하기",
  "name": "InfiniteScroll로 무한 스크롤 구현하기",
  "description": "무한 스크롤과 뒤로가기시 스크롤된 위치를 기억하기.",
  "keywords": [
    "Next.js", "React Query", "Infinite Scroll", "Modal", "LocalStorage"
  ],
  "articleBody": "\n들어가며 새로운 홈페이지를 기획, 개발하면서 최대한 앱과 동일한 사용자 경험을 주기 위해 고민을 많이 했습니다. 일반적인 페지네이션으로는 모바일에서 앱과 같은 경험을 주지 못하는 점이 아쉬운 점이 있습니다. React Query의 infiniteScroll을 infiniteScroll을 도입하면서 배운 내용들을 다룹니다. 속도가 중요한 것은 Modal로 표시하고 상호작용이 중요한 것은 Link로 페이지 이동하였습니다. 이미지 캐싱을 위한 방법과 불러온 데이터를 효과적으로 저장하는 방법에 대해서 알아봅니다. API는 장고로 만들었습니다.\n고치는 것 보다 새로 만드는게 더 빠른…\nCustom Modal vs Link 무한 스크롤을 도입할 때 다음과 같은 내용이 고려되었습니다.\n무한 스크롤이 적용된 리스트를 클릭했을때 어떤 식으로 상세페이지를 제공할 것인가? 상세페이지에서 다시 리스트로 돌아갈때 이미 불러온 데이터를 다시 불러오지 않아야한다. 2번이 적용된다면 다시 리스트로 돌아갈때 스크롤 했던 위치로 돌아가져야한다. 무한 스크롤이 도입될 곳은 내큐찾기와 커뮤니티 였습니다. 다만 두 카테고리는 각자 다른 특성을 가지고 있습니다. 서비스 핵심 모델이 적요되는 내큐찾기에서는 최대한 빠르게 유저에게 로딩되는 경험을 주어야하고, 커뮤니티에서는 댓글, 답글 등의 추가 기능들이 필요했습니다.\n속도가 중요한 내큐찾기에는 Modal 을 이용하였으며, API 상호작용 및 새로고침이 필요한 커뮤니티에서는 새로운 페이지로 이동하고 뒤로가기 시에 LocalStorage를 참조하여 저장된 ScrollY값으로 스크롤 이동되게 하였습니다.\n내큐찾기 (적용된 페이지)\n현재는 SEO 문제로 모달로 표현되지 않습니다. CHECK 👉 Next.js] SSR를 이용한 상세페이지 SEO 최적화 (모달을 포기한 이유)\n페이지 이동없이 Modal이 보여지는 형식으로 제공한다. Modal이 열릴때 따로 API에서 정보 불러오지 않고 즉시 보여질 수 있도록 리스트 불러올 때 API를 모달안의 정보까지 제공할 수 있도록 제작한다. 한번 불러온 이미지나 캐시에 남겨 로딩할 때도 매우빠른 로딩속도를 제공한다. 스크롤 시 마지막 아이템이 보여질 때 마다 Fade in 애니메이션을 적용하여 로딩이 즉각적으로 되는 것처럼 보여지게 한다. Infinite Scroll + Modal + aos fadein\n커뮤니티 (적용된 페이지)\nList에서 Item 클릭 시 새로운 상세페이지로 이동 이동할때 이때 LocalStoarge에 scrollY 값을 저장 상세페이지에서 다시 리스트로 돌아올 때 scrollY 값으로 스크롤 위치 이동 단, 이때 처음부터 List를 다시 불러온다면 저장된 scrollY 값으로 가질 수 없으므로 (1번 이상 추가로딩이 되었을 경우) 리스트 데이터는 새로 불러오면 안된다. Infinite Scroll + Link + LocalStorage\nAPI 준비 API는 Django를 사용합니다. ModelViewSet을 사용하였으며 LimitOffsetPagination을 적용하였습니다.\n일반적인 페이지 페지네이션의 경우 사용자가 다음 리스트를 불러오기 전에 새로운 아이템이 1개가 등록되고 리스트를 불러온다면 중복되는 아이템이 표시될 수 있으므로 offset pagination을 적용하여 전체 게시글이 늘었는지 확인하고 늘은 만큼 offset을 추가로 더해주어야 중복되는 아이템을 방지할 수 있습니다.\n리스트에서 로딩될 필터링 조건을 parameter 로 받기 위해 queryset을 변경하는 과정이 필요하였습니다. offset또한 파라미터로 받아옵니다.\nviews.py views.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class someview(viewsets.ModelViewSet): queryset = somemodel.objects.exclude(Q(something)).prefetch_related(Prefetch(something)).all() permission_classes = somepermission serializer_class = someSerializer pagination_class = LimitOffsetPagination filter_backends = (somefilters) ordering_fields = ('created_at','id') ordering = ('-created_at') search_fields = ['$title', '$content'] filterset_fields = ('__all__') def get_queryset(self): qs = super().get_queryset() # some condition return qs.filter(Query) 리턴 예시\nGET 1 2 3 4 5 6 7 8 { \"count\": 131, \"next\": \"api주소/?limit=20\u0026offset=55\u0026필터링조건\", \"previous\": \"api주소/?limit=20\u0026offset=15\u0026필터링조건\", \"results\":[ ... ] } Next 프로젝트 구조 Next + Tailwind + Typescript 스타터팩인 theodorusclarence/ts-nextjs-tailwind-starter를 설치하였습니다.\n프로젝트 구조는 다음을 참고해주시면 됩니다.\nsrc Tree 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 . ├── components │ ├── dialog │ │ └── BaseDialog.tsx │ └── layout │ ├── DialogZustandLayout.tsx │ └── Layout.tsx ├── hooks │ ├── useDialog.tsx │ ├── useObserver.js │ └── useIntersectionObserver.js ├── pages │ ├── sandbox │ │ └── dialog-zustand.tsx │ └── somepages ├── partials │ └── somepartials ├── store │ └── useDialogStore.tsx └── utils └── Transition.jsx infiniteScroll 설치 react-qeury를 설치해줍니다. 사용된 버전은 다음과 같습니다.\npackage.json 1 2 3 ... \"react-query\": \"^3.39.2\", ... Hydration을 통해 SSR(Server Side Rendering)을 할 수 도 있지만, 시도해본 결과 매 뒤로가기시 캐싱되지 않는 문제가 있었습니다. 정확히 말하면 이미 로딩했던 내용들을 다시 처음부터 로딩해야 했습니다. 내큐찾기 처럼 모달을 사용할 경우 Hydration 사용해도 지장없지만, 페이지 이동이 필요한 경우 해당 방법을 사용하면 비효율적입니다.\n_app.tsx (Hydration) src \u003e pages \u003e _app.tsx (Hydration) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 /* eslint-disable @typescript-eslint/no-explicit-any */ import AOS from \"aos\"; import Head from \"next/head\"; import { SessionProvider } from \"next-auth/react\"; import React, { useEffect } from \"react\"; import { QueryClient, QueryClientProvider } from \"react-query\"; import \"@/styles/aos.scss\"; import \"@/styles/globals.css\"; import \"@/styles/colors.css\"; const MyApp: NextComponentType\u003cAppContext, AppInitialProps, AppProps\u003e = ({ Component, pageProps, }) =\u003e { const queryClientRef = React.useRef\u003cQueryClient\u003e(); if (!queryClientRef.current) { queryClientRef.current = new QueryClient(); } useEffect(() =\u003e { AOS.init({ once: true, duration: 500, easing: \"ease-out-cubic\", }); }); return ( \u003c\u003e \u003cQueryClientProvider client={queryClientRef.current}\u003e \u003cHydrate state={pageProps.dehydratedState}\u003e \u003cComponent {...pageProps} /\u003e \u003c/Hydrate\u003e {/* */} \u003c/QueryClientProvider\u003e \u003c/\u003e ); }; MyApp.getInitialProps = async ({ Component, ctx, }: AppContext): Promise\u003cAppInitialProps\u003e =\u003e { let pageProps = {}; if (Component.getInitialProps) { pageProps = await Component.getInitialProps(ctx); } return { pageProps }; }; export default MyApp; 따라서 최종적으로 다음과 같이 적용했습니다. 중간에 meta 태그는 아이폰에서 모달이 열릴때 가로폭이 고정되지 않는 문제점을 해결하기 위해 넣었으며 따로 meta tag를 관리하는 컴포넌트가 있으면 추가해주시면 됩니다. 커뮤니티에서 댓글 작성이 로그인 여부를 확인하기 때문에 SessionProvider (next-auth)가 있습니다. 로그인 구현이 필요 없다면 넘기셔도 됩니다.\n_app.tsx src \u003e pages \u003e _app.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 /* eslint-disable @typescript-eslint/no-explicit-any */ import AOS from \"aos\"; import Head from \"next/head\"; import { SessionProvider } from \"next-auth/react\"; import React, { useEffect } from \"react\"; import { QueryClient, QueryClientProvider } from \"react-query\"; import \"@/styles/aos.scss\"; import \"@/styles/globals.css\"; import \"@/styles/colors.css\"; const MyApp = ({ Component, pageProps: { session, ...pageProps }, }: { Component: any; pageProps: any; }) =\u003e { const [queryClient] = React.useState(() =\u003e new QueryClient()); // AOS 애니메이션 적용 useEffect(() =\u003e { AOS.init({ once: true, duration: 500, easing: \"ease-out-cubic\", }); }); (\"\"); return ( // next-auth 로그인 세션을 위해 사용됨 \u003cSessionProvider session={session}\u003e \u003cHead\u003e {/* 아이폰 가로값 고정되지 않는 이슈 해결 */} \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover\" /\u003e \u003c/Head\u003e {/* infiniteScroll 위해 선언 */} \u003cQueryClientProvider client={queryClient}\u003e {/* PageProps 표시 영역 */} \u003cComponent {...pageProps} /\u003e {/* Debug 모드에서만 활용할 devtools */} {/* import { ReactQueryDevtools } from 'react-query/devtools'; */} \u003c/QueryClientProvider\u003e \u003c/SessionProvider\u003e ); }; export default MyApp; 무한 로딩 리스트를 구현하는 큰 뼈대는 다음과 같습니다. useIntersectionObserve 훅을 사용하여 리스트를 fetch 할지를 확인합니다.\nInfiniteListSkeleton.tsx InfiniteListSkeleton.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 const InfiniteListSkeleton = ('필터링 될 내용들') =\u003e { const { data, hasNextPage, fetchNextPage, refetch, isFetching } = useInfiniteQuery( 'apiRequestFunction', ({ pageParam = '' }) =\u003e // FetchList 함수는 axios로 api에 request 보내는 함수입니다. (파라미터로 필터링 될 내용을 받습니다.) FetchList( pageParam, '필터링 될 내용들' ), { // 다음 페이지는 offset 으로 확인합니다. getNextPageParam: (lastPage) =\u003e { if (lastPage.next === null) { return undefined; } const url = new URL(lastPage.next); const lastOffset = url.searchParams.get('offset'); if (lastOffset) { return parseInt(lastOffset); } else { return undefined; } }, staleTime: 60 * 1000, cacheTime: 60 * 1000, keepPreviousData: true, refetchOnMount: false, refetchOnWindowFocus: false, } ); // 1. 모달로 오픈할 거면 (커스텀 훅) const dialog = useDialog(); const openModal = (props: Results) =\u003e { dialog({ title: '', description: \u003c\u003e\u003c/\u003e, catchOnCancel: true, submitText: '네', cancleText: '닫기', variant: 'warning', props: props, }) .then() .catch(); return \u003c\u003e\u003c/\u003e; }; // 2. 페이지 이동후 스크롤 Y 값을 저장하여 해당 위치로 바로 보여지게 할 경우 const [scrollY, setScrollY] = useLocalStorage('someScroll', 0); React.useEffect(() =\u003e { if (scrollY !== 0) { window.scrollTo(0, Number(scrollY)); setScrollY(0); } // eslint-disable-next-line react-hooks/exhaustive-deps }, []); // 필터가 적용되면 offset을 초기화하고 처음부터 로딩되어야 합니다. React.useEffect(() =\u003e { if (isRefreshing) { refetch(); } setIsRefreshing(false); }, [isRefreshing, refetch, setIsRefreshing]); // useRef를 이용하여 해당 Ref를 하단에 두고 보여지면 다음 페이지를 로딩합니다. const loadMoreButtonRef = React.useRef(null); // https://developer.mozilla.org/ko/docs/Web/API/IntersectionObserver useIntersectionObserver({ root: null, target: loadMoreButtonRef, onIntersect: fetchNextPage, enabled: hasNextPage, }); return ( \u003c\u003e \u003cul\u003e {/* 로딩중일때 */} {isFetching \u0026\u0026 \u003cLoadingDiv /\u003e} {/* 리스트를 표시합ㄴ디ㅏ. */} {data?.pages.map((page) =\u003e page.results.map((props: Results) =\u003e ( // data-aos 로 애니메이션 효과를 줍니다. (라이브러리 설치 필요)) \u003cli key={props.id} data-aos='fade-up' data-aos-duration='200'\u003e {/* 1. 모달로 오픈할꺼면 */} \u003cdiv onClick={() =\u003e openModal(props)}\u003e Click ${props.id} to open Modal \u003c/div\u003e {/* 2. 페이지 이동할거면 */} \u003cLink href={{ pathname: `url/${props.id}`, query: { props: JSON.stringify(props) }, }} as={`url/${props.id}`} passHref \u003e \u003ca href={`url/${props.id}`} onClick={() =\u003e setScrollY(window.scrollY)} \u003e \u003cdiv\u003eClick ${props.id} to navigate\u003c/div\u003e \u003c/a\u003e \u003c/Link\u003e \u003c/li\u003e )))} \u003c/ul\u003e {/* 로딩중 표시를 하고 ref가 focus 될때 (리스트의 끝일때) 마다 다음 리스트를 로딩합니다. */} {hasNextPage \u0026\u0026 ( \u003c\u003e \u003cLoadingDiv /\u003e \u003cbutton onClick={() =\u003e fetchNextPage()} className='text-center' /\u003e \u003c/\u003e )} \u003cdiv ref={loadMoreButtonRef} /\u003e \u003c/\u003e ); }; export default InfiniteListSkeleton; apiRequestFunction.js 앞에서 limitOffsetPagination 으로 만든 API를 불러옵니다. 상황에 따라서 params가 추가될 수 있습니다. (필터링 조건 등)\nsrc \u003e pages \u003e api \u003e index.tsx 1 2 3 4 5 6 export const apiRequestFunction = async (offset = 0, ... , params) =\u003e { const { data } = await axios.get( `${apiUrl}?limit=${limit}\u0026offset=${offset}...` ); return data; }; useIntersectionObserver.js src \u003e hooks \u003e useIntersectionObserver.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 import React from \"react\"; export default function useIntersectionObserver({ root, target, onIntersect, threshold = 1.0, rootMargin = \"0px\", enabled = true, }) { React.useEffect(() =\u003e { if (!enabled) { return; } const observer = new IntersectionObserver( (entries) =\u003e entries.forEach((entry) =\u003e entry.isIntersecting \u0026\u0026 onIntersect()), { root: root \u0026\u0026 root.current, rootMargin, threshold, } ); const el = target \u0026\u0026 target.current; if (!el) { return; } observer.observe(el); return () =\u003e { observer.unobserve(el); }; }, [target, enabled, root, threshold, rootMargin, onIntersect]); } useObserver.js src \u003e hooks \u003e useObserver.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 import React from \"react\"; export default function useIntersectionObserver({ root, target, onIntersect, threshold = 1.0, rootMargin = \"0px\", enabled = true, }) { React.useEffect(() =\u003e { if (!enabled) { return; } const observer = new IntersectionObserver( (entries) =\u003e entries.forEach((entry) =\u003e entry.isIntersecting \u0026\u0026 onIntersect()), { root: root \u0026\u0026 root.current, rootMargin, threshold, } ); const el = target \u0026\u0026 target.current; if (!el) { return; } observer.observe(el); return () =\u003e { observer.unobserve(el); }; }, [target, enabled, root, threshold, rootMargin, onIntersect]); } infiniteScroll + Modal 모달은 theodorusclarence/expansion-pack의 Dialog using Zustand를 설치 후 커스텀하였습니다. 설치하면 DialogZustandLayout.tsx 샘플이 생깁니다. 이를 참고하여 수동으로 Layout.tsx 를 수정해주어야합니다.\nLayout.tsx src \u003e layout \u003e Layout.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import * as React from \"react\"; import BaseDialog from \"@/components/dialog/BaseDialog\"; import Footer from \"@/components/layout/Footer\"; import useDialogStore from \"@/store/useDialogStore\"; import Header from \"./Header\"; export default function Layout({ children }: { children: React.ReactNode }) { const open = useDialogStore.useOpen(); const state = useDialogStore.useState(); const handleClose = useDialogStore.useHandleClose(); const handleSubmit = useDialogStore.useHandleSubmit(); return ( \u003c\u003e \u003cHeader mode=\"\" /\u003e \u003csection className=\"min-h-full font-primary\"\u003e{children}\u003c/section\u003e \u003cBaseDialog onClose={handleClose} onSubmit={handleSubmit} open={open} options={state} /\u003e \u003cFooter /\u003e \u003c/\u003e ); } useDialog.tsx src \u003e hooks \u003e useDialog.tsx 1 2 3 4 5 import useDialogStore from \"@/store/useDialogStore\"; export default function useDialog() { return useDialogStore.useDialog(); } 여기까지 진행되면 모달을 열 수 있는 환경이 구성됩니다. src \u003e components \u003e dialog \u003e baseDialog.tsx 가 모달창입니다. 원래는 submt이나 error를 확인하는 모달이였으므로 리스트에서 클릭하여 모달이 열릴때 props를 같이 받아올 수 있도록 해당 내용을 커스텀 해줍니다. options에 props를 추가하면 됩니다.\nbaseDialog.tsx src \u003e components \u003e dialog \u003e baseDialog.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 type BaseDialogProps = { open: boolean; onSubmit: () =\u003e void; onClose: () =\u003e void; options: DialogOptions; }; export type DialogOptions = { catchOnCancel?: boolean; title: React.ReactNode; description: React.ReactNode; variant: \"success\" | \"warning\" | \"danger\"; submitText: React.ReactNode; cancleText: React.ReactNode; props: Results | null; }; export default function BaseDialog({ open, onSubmit, onClose, options: { title, description, variant, submitText, cancleText, props }, // \u003c-- 추가 }: BaseDialogProps) { const current = colorVariant[variant]; return ( \u003cTransition.Root show={open} as={React.Fragment}\u003e \u003cDialog as=\"div\" static className=\"fixed inset-0 z-40 overflow-y-auto\" open={open} onClose={() =\u003e onClose()} \u003e \u003cdiv className=\"flex min-h-screen items-start justify-center px-5 py-5 text-center drop-shadow-xl sm:block sm:p-0 md:mt-16\"\u003e \u003cTransition.Child as={React.Fragment} enter=\"ease-out duration-300\" enterFrom=\"opacity-0\" enterTo=\"opacity-100\" leave=\"ease-in duration-300\" leaveFrom=\"opacity-100\" leaveTo=\"opacity-0\" \u003e \u003cDialog.Overlay className=\"fixed inset-0 bg-black bg-opacity-75 transition-opacity\" /\u003e \u003c/Transition.Child\u003e \u003cspan className=\"hidden sm:inline-block sm:h-screen sm:align-middle\" aria-hidden=\"true\" \u003e \u0026#8203; \u003c/span\u003e \u003cTransition.Child as={React.Fragment} enter=\"ease-out duration-300\" enterFrom=\"opacity-0 trangray-y-4 sm:trangray-y-0 sm:scale-95\" enterTo=\"opacity-100 trangray-y-0 sm:scale-100\" leave=\"ease-in duration-200\" leaveFrom=\"opacity-100 trangray-y-0 sm:scale-100\" leaveTo=\"opacity-0 trangray-y-4 sm:trangray-y-0 sm:scale-95\" \u003e \u003cdiv className=\"z-auto inline-block w-full transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:my-12 sm:min-h-[1000px] sm:max-w-6xl sm:p-6 sm:align-middle\"\u003e \u003cdiv className=\"absolute top-0 right-0 block pt-4 pr-4\"\u003e \u003cbutton type=\"button\" className={clsx( \"rounded-md bg-white text-gray-400 hover:text-gray-500\", \"focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2\", \"disabled:cursor-wait disabled:brightness-90 disabled:filter\" )} onClick={onClose} \u003e \u003cspan className=\"sr-only\"\u003eClose\u003c/span\u003e \u003cHiOutlineX className=\"h-6 w-6\" aria-hidden=\"true\" /\u003e \u003c/button\u003e \u003c/div\u003e \u003cdiv\u003e {/* 불러온 props를 표시해주면 됩니다. */} {props \u0026\u0026 \u003cdiv\u003e \u003c/div\u003e} \u003c/div\u003e \u003cdiv className=\"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse\"\u003e \u003cButton type=\"button\" variant=\"outline\" onClick={onClose} className=\"font mt-3 w-full items-center justify-center !font-medium sm:mt-0 sm:w-auto sm:text-sm\" \u003e {cancleText} \u003c/Button\u003e \u003c/div\u003e \u003c/div\u003e \u003c/Transition.Child\u003e \u003c/div\u003e \u003c/Dialog\u003e \u003c/Transition.Root\u003e ); } const colorVariant = { success: { bg: { light: \"bg-green-100\", }, text: { primary: \"text-green-500\", }, icon: HiOutlineCheck, }, warning: { bg: { light: \"bg-yellow-100\", }, text: { primary: \"text-yellow-500\", }, icon: HiOutlineExclamation, }, danger: { bg: { light: \"bg-red-100\", }, text: { primary: \"text-red-500\", }, icon: HiExclamationCircle, }, }; useDialogStore.tsx src \u003e store \u003e useDialogStore.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 import { createSelectorHooks } from \"auto-zustand-selectors-hook\"; import produce from \"immer\"; import create from \"zustand\"; import { DialogOptions } from \"@/components/dialog/BaseDialog\"; type DialogStoreType = { awaitingPromise: { resolve?: () =\u003e void; reject?: () =\u003e void; }; open: boolean; state: DialogOptions; dialog: (options: Partial\u003cDialogOptions\u003e) =\u003e Promise\u003cvoid\u003e; handleClose: () =\u003e void; handleSubmit: () =\u003e void; }; const useDialogStoreBase = create\u003cDialogStoreType\u003e((set) =\u003e ({ awaitingPromise: {}, open: false, state: { title: \"Title\", description: \"Description\", submitText: \"Yes\", cancleText: \"No\", variant: \"warning\", catchOnCancel: false, props: null, // \u003c-- 추가 }, dialog: (options) =\u003e { set( produce\u003cDialogStoreType\u003e((state) =\u003e { state.open = true; state.state = { ...state.state, ...options }; }) ); return new Promise\u003cvoid\u003e((resolve, reject) =\u003e { set( produce\u003cDialogStoreType\u003e((state) =\u003e { state.awaitingPromise = { resolve, reject }; }) ); }); }, handleClose: () =\u003e { set( produce\u003cDialogStoreType\u003e((state) =\u003e { state.state.catchOnCancel \u0026\u0026 state.awaitingPromise?.reject?.(); state.open = false; }) ); }, handleSubmit: () =\u003e { set( produce\u003cDialogStoreType\u003e((state) =\u003e { state.awaitingPromise?.resolve?.(); state.open = false; }) ); }, })); const useDialogStore = createSelectorHooks(useDialogStoreBase); export default useDialogStore; 이제 아까 만들었던 (예제리스트)처럼 openModal 함수에서 props를 함께 넘겨주어 모달이 열릴때 미리 받아온 데이터를 넘겨받을 수 있습니다.\nopenModal with props 1 2 /* 1. 모달로 오픈할꺼면 */ \u003cdiv onClick={() =\u003e openModal(props)}\u003eClick ${props.id} to open Modal\u003c/div\u003e console에 찍어보면 다음과 같습니다. 맨 처음 리스트를 불러올 때 모달에 들어갈 내용들도 함께 불러왔으므로 모달이 열릴때 추가로 api에서 불러올 필요가 없어서 즉각적으로 표시되어 로딩속도가 빠르게 느껴지는 장점이 있습니다.\n응용하여 모달창이 열렸을 때 새로고침을 할 경우 router.push 하여 해당 아이템의 상세페이지로 이동하게 할 수 있습니다. 빠른 반응을 위해서 리스트에서 클릭 시에만 모달이 열리고, 새로고침, 링크공유, SEO 최적화 위해 상세페이지를 제작해 두는 것이 좋습니다.\ninfiniteScroll + LocalStorage + ScrollY 리스트에서 아이템을 클릭할 때 scrollY값을 LocalStorage에 저장하고, useEffect를 이용하여 scrollY가 0이 아닌 경우에는 LocalStorage에 저장된 scrollY 값으로 이동시켜주면 됩니다. Next/Link를 사용할때 onClick 이벤트를 발생시키기 위해서 a 태그를 중첩시켜주어야 합니다.\nListExample.tsx ListExample.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 const ListExample = () =\u003e { const { data, hasNextPage, fetchNextPage, refetch, isFetching } = useInfiniteQuery( ... ); const loadMoreButtonRef = React.useRef(null); useIntersectionObserver({ root: null, target: loadMoreButtonRef, onIntersect: fetchNextPage, enabled: hasNextPage, }); // 스크롤 값을 확인 const [scrollY, setScrollY] = useLocalStorage('PostListScroll', 0); React.useEffect(() =\u003e { if (scrollY !== 0) { window.scrollTo(0, Number(scrollY)); setScrollY(0); } // eslint-disable-next-line react-hooks/exhaustive-deps }, []); return ( \u003c\u003e \u003cul\u003e {isFetching \u0026\u0026 \u003cLoadingDiv /\u003e} {data?.pages.map((page) =\u003e page.results.map((post: Results) =\u003e ( \u003cli key={post.id} data-aos='fade-up' data-aos-duration='200'\u003e \u003cLink href={{ pathname: `community/post/${post.id}`, query: { post: JSON.stringify(post) }, }} as={`community/post/${post.id}`} passHref \u003e \u003ca href={`community/post/${post.id}`} onClick={() =\u003e setScrollY(window.scrollY)} // 클릭시에 해당 y값을 저장해줌 \u003e \u003c/a\u003e \u003c/Link\u003e \u003c/li\u003e )) )} \u003c/ul\u003e \u003cdiv ref={loadMoreButtonRef} /\u003e \u003c/\u003e ); }; export default ListExample; 콘솔을 찍어보면 다음과 같습니다. LocalStorage를 초기화 해주는 조건을 Header나 다른 감싸지는 컴포넌트에 추가해주어서 A리스트 \u003e B리스트 \u003e A리스트로 다른 리스트를 거쳐 돌아왔을때 A리스트의 scrollY값을 초기화 해주는 것도 필요합니다.\n저의 경우엔 Header에 추가주었습니다.\nheader.tsx header.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ... const [, setCommunityScrollY] = useLocalStorage\u003cnumber\u003e('PostListScroll', 0); const NavigateCommunity = () =\u003e { setCommunityScrollY(0); router.push('/community'); window.scrollTo(0, 0); setMobileNavOpen(false); }; const [, setFindcueScrollY] = useLocalStorage\u003cnumber\u003e('CueListScroll', 0); const NavigateFindCue = () =\u003e { setFindcueScrollY(0); router.push('/findcue'); window.scrollTo(0, 0); setMobileNavOpen(false); }; ... 마치며 이제 무한 스크롤을 구현할 때 상황에 따라서 모달로 열거나 새로운 페이지 이동 후 뒤로가기시 로딩된 값은 다시 불러오지 않고 해당 값으로 다시 돌아오게 할 수 있습니다.\nReference https://github.com/theodorusclarence/ts-nextjs-tailwind-starter https://github.com/theodorusclarence/expansion-pack https://tanstack.com https://developer.mozilla.org/ko/docs/Web/API/IntersectionObserver https://velog.io/@hdpark 궁금하신 점이 있으시면 아래 Comments 남겨주세요 👇\n",
  "wordCount" : "3092",
  "inLanguage": "en",
  "datePublished": "2023-01-04T00:00:00Z",
  "dateModified": "2023-01-04T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "cha2hyun"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cha2hyun.blog/content/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "채수현 개발일지",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cha2hyun.blog/favicon/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cha2hyun.blog/" accesskey="h" title="채수현 개발일지 (Alt + H)">채수현 개발일지<span style="justify-content: center; padding-left:7px;">
                    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fcha2hyun.blog&count_bg=%23000000&title_bg=%23000000&icon=&icon_color=%23E7E7E7&title=HITS&edge_flat=false"/>
                </span>
                <div style="font-size: 14px; margin-top:-30px; font-weight: normal;">📚 기억은 유한하나, 기록은 무한하다</div>
            </a>            
        </div>
        <ul id="menu">
            <li>
                <a href="https://cha2hyun.blog/archives" title="전체">
                    <span style="font-weight: bold;">전체</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/posts/" title="개발일상">
                    <span style="font-weight: bold;">개발일상</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/projects/" title="프로젝트">
                    <span style="font-weight: bold;">프로젝트</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/content/algorithm/" title="알고리즘">
                    <span style="font-weight: bold;">알고리즘</span>
                </a>
            </li>
            <li>
                <a href="https://cha2hyun.blog/search/" title="검색">
                    <span style="font-weight: bold;">검색</span>
                </a>
            </li>
            <li>
                <div class="logo-switches">
                    <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
            </li>
        </ul>
        
    </nav>
    
    
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cha2hyun.blog/">Home</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/">Contents</a>&nbsp;»&nbsp;<a href="https://cha2hyun.blog/content/projects/">Projects</a></div>
    <h1 class="post-title entry-hint-parent">
      InfiniteScroll로 무한 스크롤 구현하기
    </h1>
    <div class="post-meta"><span title='2023-01-04 00:00:00 +0000 UTC'>January 4, 2023</span>&nbsp;·&nbsp;15 min&nbsp;·&nbsp;cha2hyun


    </div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%eb%93%a4%ec%96%b4%ea%b0%80%eb%a9%b0" aria-label="들어가며">들어가며</a></li>
                <li>
                    <a href="#custom-modal-vs-link" aria-label="Custom Modal vs Link">Custom Modal vs Link</a></li>
                <li>
                    <a href="#api-%ec%a4%80%eb%b9%84" aria-label="API 준비">API 준비</a><ul>
                        
                <li>
                    <a href="#viewspy" aria-label="views.py">views.py</a></li></ul>
                </li>
                <li>
                    <a href="#next-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ea%b5%ac%ec%a1%b0" aria-label="Next 프로젝트 구조">Next 프로젝트 구조</a><ul>
                        
                <li>
                    <a href="#src-tree" aria-label="src Tree">src Tree</a></li></ul>
                </li>
                <li>
                    <a href="#infinitescroll-%ec%84%a4%ec%b9%98" aria-label="infiniteScroll 설치">infiniteScroll 설치</a><ul>
                        
                <li>
                    <a href="#_apptsx-hydration" aria-label="_app.tsx (Hydration)">_app.tsx (Hydration)</a></li>
                <li>
                    <a href="#_apptsx" aria-label="_app.tsx">_app.tsx</a></li>
                <li>
                    <a href="#infinitelistskeletontsx" aria-label="InfiniteListSkeleton.tsx">InfiniteListSkeleton.tsx</a></li>
                <li>
                    <a href="#apirequestfunctionjs" aria-label="apiRequestFunction.js">apiRequestFunction.js</a></li>
                <li>
                    <a href="#useintersectionobserverjs" aria-label="useIntersectionObserver.js">useIntersectionObserver.js</a></li>
                <li>
                    <a href="#useobserverjs" aria-label="useObserver.js">useObserver.js</a></li></ul>
                </li>
                <li>
                    <a href="#infinitescroll--modal" aria-label="infiniteScroll &#43; Modal">infiniteScroll + Modal</a><ul>
                        
                <li>
                    <a href="#layouttsx" aria-label="Layout.tsx">Layout.tsx</a></li>
                <li>
                    <a href="#usedialogtsx" aria-label="useDialog.tsx">useDialog.tsx</a></li>
                <li>
                    <a href="#basedialogtsx" aria-label="baseDialog.tsx">baseDialog.tsx</a></li>
                <li>
                    <a href="#usedialogstoretsx" aria-label="useDialogStore.tsx">useDialogStore.tsx</a></li></ul>
                </li>
                <li>
                    <a href="#infinitescroll--localstorage--scrolly" aria-label="infiniteScroll &#43; LocalStorage &#43; ScrollY">infiniteScroll + LocalStorage + ScrollY</a><ul>
                        
                <li>
                    <a href="#listexampletsx" aria-label="ListExample.tsx">ListExample.tsx</a></li>
                <li>
                    <a href="#headertsx" aria-label="header.tsx">header.tsx</a></li></ul>
                </li>
                <li>
                    <a href="#%eb%a7%88%ec%b9%98%eb%a9%b0" aria-label="마치며">마치며</a><ul>
                        
                <li>
                    <a href="#reference" aria-label="Reference">Reference</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><br>
<h3 id="들어가며">들어가며<a hidden class="anchor" aria-hidden="true" href="#들어가며">#</a></h3>
<p>새로운 홈페이지를 기획, 개발하면서 최대한 <code>앱</code>과 동일한 사용자 경험을 주기 위해 고민을 많이 했습니다. 일반적인 페지네이션으로는 모바일에서 <code>앱</code>과 같은 경험을 주지 못하는 점이 아쉬운 점이 있습니다. <code>React Query</code>의 <code>infiniteScroll</code>을 <code>infiniteScroll</code>을 도입하면서 배운 내용들을 다룹니다. 속도가 중요한 것은 Modal로 표시하고 상호작용이 중요한 것은 Link로 페이지 이동하였습니다. 이미지 캐싱을 위한 방법과 불러온 데이터를 효과적으로 저장하는 방법에 대해서 알아봅니다. API는 장고로 만들었습니다.</p>
<p><figure class="align-center ">
    <img loading="lazy" src="../img/1.png#center"
         alt="고치는 것 보다 새로 만드는게 더 빠른&amp;hellip;"/> <figcaption>
            <p>고치는 것 보다 새로 만드는게 더 빠른&hellip;</p>
        </figcaption>
</figure>

<br></p>
<h3 id="custom-modal-vs-link">Custom Modal vs Link<a hidden class="anchor" aria-hidden="true" href="#custom-modal-vs-link">#</a></h3>
<p>무한 스크롤을 도입할 때 다음과 같은 내용이 고려되었습니다.</p>
<ol>
<li>무한 스크롤이 적용된 리스트를 클릭했을때 어떤 식으로 상세페이지를 제공할 것인가?</li>
<li>상세페이지에서 다시 리스트로 돌아갈때 이미 불러온 데이터를 다시 불러오지 않아야한다.</li>
<li>2번이 적용된다면 다시 리스트로 돌아갈때 스크롤 했던 위치로 돌아가져야한다.</li>
</ol>
<p>무한 스크롤이 도입될 곳은 <code>내큐찾기</code>와 <code>커뮤니티</code> 였습니다. 다만 두 카테고리는 각자 다른 특성을 가지고 있습니다. 서비스 핵심 모델이 적요되는 <code>내큐찾기</code>에서는 최대한 빠르게 유저에게 로딩되는 경험을 주어야하고, <code>커뮤니티</code>에서는 댓글, 답글 등의 추가 기능들이 필요했습니다.</p>
<p>속도가 중요한 <code>내큐찾기</code>에는 <code>Modal</code> 을 이용하였으며, API 상호작용 및 새로고침이 필요한 <code>커뮤니티</code>에서는 <code>새로운 페이지</code>로 이동하고 뒤로가기 시에 LocalStorage를 참조하여 저장된 ScrollY값으로 스크롤 이동되게 하였습니다.</p>
<p><strong>내큐찾기</strong> <a href="https://www.cue8949.com/findcue" target="_blank">(적용된 페이지)</a></p>
<blockquote>
<p>현재는 SEO 문제로 모달로 표현되지 않습니다. <br /><strong>CHECK</strong> 👉 <a href="/projects/큐찾사/ssrandseo">Next.js] SSR를 이용한 상세페이지 SEO 최적화</a> (모달을 포기한 이유)</p>
</blockquote>
<ul>
<li>페이지 이동없이 <code>Modal</code>이 보여지는 형식으로 제공한다.</li>
<li><code>Modal</code>이 열릴때 따로 API에서 정보 불러오지 않고 즉시 보여질 수 있도록 리스트 불러올 때 API를 모달안의 정보까지 제공할 수 있도록 제작한다.</li>
<li>한번 불러온 이미지나 <code>캐시</code>에 남겨 로딩할 때도 매우빠른 로딩속도를 제공한다.</li>
<li>스크롤 시 마지막 아이템이 보여질 때 마다 Fade in 애니메이션을 적용하여 로딩이 즉각적으로 되는 것처럼 보여지게 한다.</li>
</ul>
<figure class="align-center ">
    <img loading="lazy" src="../img/2.gif#center"
         alt="Infinite Scroll &#43; Modal &#43; aos fadein"/> <figcaption>
            <p><code>Infinite Scroll</code> + <code>Modal</code> + <code>aos fadein</code></p>
        </figcaption>
</figure>

<p><strong>커뮤니티</strong> <a href="https://www.cue8949.com/community" target="_blank">(적용된 페이지)</a></p>
<ul>
<li><code>List</code>에서 <code>Item</code> 클릭 시 <code>새로운 상세페이지</code>로 이동</li>
<li>이동할때 이때 <code>LocalStoarge</code>에 <code>scrollY</code> 값을 저장</li>
<li>상세페이지에서 다시 리스트로 돌아올 때 <code>scrollY 값으로 스크롤 위치 이동</code></li>
<li>단, 이때 처음부터 List를 다시 불러온다면 저장된 scrollY 값으로 가질 수 없으므로 (1번 이상 추가로딩이 되었을 경우) <code>리스트 데이터는 새로 불러오면 안된다</code>.</li>
</ul>
<figure class="align-center ">
    <img loading="lazy" src="../img/3.gif#center"
         alt="Infinite Scroll &#43; Link &#43; LocalStorage"/> <figcaption>
            <p><code>Infinite Scroll</code> + <code>Link</code> + <code>LocalStorage</code></p>
        </figcaption>
</figure>

<br>
<h3 id="api-준비">API 준비<a hidden class="anchor" aria-hidden="true" href="#api-준비">#</a></h3>
<p>API는 Django를 사용합니다. ModelViewSet을 사용하였으며 <code>LimitOffsetPagination</code>을 적용하였습니다.</p>
<p>일반적인 페이지 페지네이션의 경우 사용자가 다음 리스트를 불러오기 전에 새로운 아이템이 1개가 등록되고 리스트를 불러온다면 중복되는 아이템이 표시될 수 있으므로 offset pagination을 적용하여 전체 게시글이 늘었는지 확인하고 늘은 만큼 offset을 추가로 더해주어야 중복되는 아이템을 방지할 수 있습니다.</p>
<p>리스트에서 로딩될 <code>필터링 조건</code>을 <code>parameter</code> 로 받기 위해 queryset을 변경하는 과정이 필요하였습니다. <code>offset</code>또한 파라미터로 받아옵니다.</p>
<h4 id="viewspy"><code>views.py</code><a hidden class="anchor" aria-hidden="true" href="#viewspy">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      views.py
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">someview</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">queryset</span> <span class="o">=</span> <span class="n">somemodel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">something</span><span class="p">))</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">Prefetch</span><span class="p">(</span><span class="n">something</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="n">somepermission</span>
</span></span><span class="line"><span class="cl">    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">someSerializer</span>
</span></span><span class="line"><span class="cl">    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">LimitOffsetPagination</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">somefilters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$title&#39;</span><span class="p">,</span> <span class="s1">&#39;$content&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filterset_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__all__&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># some condition</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Query</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>리턴 예시</p>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      GET
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Json" data-lang="Json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="mi">131</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;next&#34;</span><span class="p">:</span> <span class="s2">&#34;api주소/?limit=20&amp;offset=55&amp;필터링조건&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;previous&#34;</span><span class="p">:</span> <span class="s2">&#34;api주소/?limit=20&amp;offset=15&amp;필터링조건&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;results&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">        <span class="err">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h3 id="next-프로젝트-구조">Next 프로젝트 구조<a hidden class="anchor" aria-hidden="true" href="#next-프로젝트-구조">#</a></h3>
<p>Next + Tailwind + Typescript 스타터팩인 <a href="https://github.com/theodorusclarence/ts-nextjs-tailwind-starter" target="_blank">theodorusclarence/ts-nextjs-tailwind-starter</a>를 설치하였습니다.</p>
<p>프로젝트 구조는 다음을 참고해주시면 됩니다.</p>
<h4 id="src-tree"><code>src Tree</code><a hidden class="anchor" aria-hidden="true" href="#src-tree">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── components
</span></span><span class="line"><span class="cl">│   ├── dialog
</span></span><span class="line"><span class="cl">│   │   └── BaseDialog.tsx
</span></span><span class="line"><span class="cl">│   └── layout
</span></span><span class="line"><span class="cl">│       ├── DialogZustandLayout.tsx
</span></span><span class="line"><span class="cl">│       └── Layout.tsx
</span></span><span class="line"><span class="cl">├── hooks
</span></span><span class="line"><span class="cl">│   ├── useDialog.tsx
</span></span><span class="line"><span class="cl">│   ├── useObserver.js
</span></span><span class="line"><span class="cl">│   └── useIntersectionObserver.js
</span></span><span class="line"><span class="cl">├── pages
</span></span><span class="line"><span class="cl">│   ├── sandbox
</span></span><span class="line"><span class="cl">│   │   └── dialog-zustand.tsx
</span></span><span class="line"><span class="cl">│   └── somepages
</span></span><span class="line"><span class="cl">├── partials
</span></span><span class="line"><span class="cl">│   └── somepartials
</span></span><span class="line"><span class="cl">├── store
</span></span><span class="line"><span class="cl">│   └── useDialogStore.tsx
</span></span><span class="line"><span class="cl">└── utils
</span></span><span class="line"><span class="cl">    └── Transition.jsx
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="infinitescroll-설치">infiniteScroll 설치<a hidden class="anchor" aria-hidden="true" href="#infinitescroll-설치">#</a></h3>
<p>react-qeury를 설치해줍니다. 사용된 버전은 다음과 같습니다.</p>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      package.json
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Json" data-lang="Json"><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;react-query&#34;</span><span class="err">:</span> <span class="s2">&#34;^3.39.2&#34;</span><span class="err">,</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>Hydration을 통해 SSR(Server Side Rendering)을 할 수 도 있지만, 시도해본 결과 매 뒤로가기시 <code>캐싱되지 않는 문제</code>가 있었습니다. 정확히 말하면 이미 로딩했던 내용들을 다시 처음부터 로딩해야 했습니다. 내큐찾기 처럼 모달을 사용할 경우 Hydration 사용해도 지장없지만, 페이지 이동이 필요한 경우 해당 방법을 사용하면 비효율적입니다.</p>
<h4 id="_apptsx-hydration"><code>_app.tsx (Hydration)</code><a hidden class="anchor" aria-hidden="true" href="#_apptsx-hydration">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; pages &gt; _app.tsx (Hydration)
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="cm">/* eslint-disable @typescript-eslint/no-explicit-any */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">AOS</span> <span class="kr">from</span> <span class="s2">&#34;aos&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Head</span> <span class="kr">from</span> <span class="s2">&#34;next/head&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">SessionProvider</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next-auth/react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">QueryClient</span><span class="p">,</span> <span class="nx">QueryClientProvider</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react-query&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/aos.scss&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/globals.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/colors.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyApp</span>: <span class="kt">NextComponentType</span><span class="p">&lt;</span><span class="nt">AppContext</span><span class="err">,</span> <span class="na">AppInitialProps</span><span class="err">,</span> <span class="na">AppProps</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Component</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pageProps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">queryClientRef</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">QueryClient</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queryClientRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">queryClientRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryClient</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AOS</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">once</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">duration</span>: <span class="kt">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">easing</span><span class="o">:</span> <span class="s2">&#34;ease-out-cubic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">QueryClientProvider</span> <span class="na">client</span><span class="o">=</span><span class="p">{</span><span class="nx">queryClientRef</span><span class="p">.</span><span class="nx">current</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">Hydrate</span> <span class="na">state</span><span class="o">=</span><span class="p">{</span><span class="nx">pageProps</span><span class="p">.</span><span class="nx">dehydratedState</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">Component</span> <span class="p">{</span><span class="na">...pageProps</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">Hydrate</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* &lt;ReactQueryDevtools /&gt; */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">QueryClientProvider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">MyApp</span><span class="p">.</span><span class="nx">getInitialProps</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Component</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="o">:</span> <span class="nx">AppContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">AppInitialProps</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">pageProps</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">Component</span><span class="p">.</span><span class="nx">getInitialProps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pageProps</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Component</span><span class="p">.</span><span class="nx">getInitialProps</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">pageProps</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">MyApp</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>따라서 최종적으로 다음과 같이 적용했습니다. 중간에 <code>meta</code> 태그는 아이폰에서 모달이 열릴때 가로폭이 고정되지 않는 문제점을 해결하기 위해 넣었으며 따로 meta tag를 관리하는 컴포넌트가 있으면 추가해주시면 됩니다. 커뮤니티에서 댓글 작성이 로그인 여부를 확인하기 때문에 <code>SessionProvider (next-auth)</code>가 있습니다. 로그인 구현이 필요 없다면 넘기셔도 됩니다.</p>
<h4 id="_apptsx"><code>_app.tsx</code><a hidden class="anchor" aria-hidden="true" href="#_apptsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; pages &gt; _app.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="cm">/* eslint-disable @typescript-eslint/no-explicit-any */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">AOS</span> <span class="kr">from</span> <span class="s2">&#34;aos&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Head</span> <span class="kr">from</span> <span class="s2">&#34;next/head&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">SessionProvider</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next-auth/react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">QueryClient</span><span class="p">,</span> <span class="nx">QueryClientProvider</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react-query&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/aos.scss&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/globals.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/colors.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyApp</span> <span class="o">=</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Component</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pageProps</span><span class="o">:</span> <span class="p">{</span> <span class="nx">session</span><span class="p">,</span> <span class="p">...</span><span class="nx">pageProps</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Component</span>: <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pageProps</span>: <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">queryClient</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">QueryClient</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// AOS 애니메이션 적용
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AOS</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">once</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">duration</span>: <span class="kt">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">easing</span><span class="o">:</span> <span class="s2">&#34;ease-out-cubic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// next-auth 로그인 세션을 위해 사용됨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">&lt;</span><span class="nt">SessionProvider</span> <span class="na">session</span><span class="o">=</span><span class="p">{</span><span class="nx">session</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* 아이폰 가로값 고정되지 않는 이슈 해결 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span>
</span></span><span class="line"><span class="cl">          <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">Head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="cm">/* infiniteScroll 위해 선언 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">QueryClientProvider</span> <span class="na">client</span><span class="o">=</span><span class="p">{</span><span class="nx">queryClient</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* PageProps 표시 영역 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">Component</span> <span class="p">{</span><span class="na">...pageProps</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* Debug 모드에서만 활용할 devtools */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* import { ReactQueryDevtools } from &#39;react-query/devtools&#39;;
</span></span></span><span class="line"><span class="cl"><span class="cm">        &lt;ReactQueryDevtools initialIsOpen={false} /&gt; */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">QueryClientProvider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">SessionProvider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">MyApp</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>무한 로딩 리스트를 구현하는 큰 뼈대는 다음과 같습니다. <code>useIntersectionObserve</code> 훅을 사용하여 리스트를 fetch 할지를 확인합니다.</p>
<h4 id="infinitelistskeletontsx"><code>InfiniteListSkeleton.tsx</code><a hidden class="anchor" aria-hidden="true" href="#infinitelistskeletontsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      InfiniteListSkeleton.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Typescript" data-lang="Typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">InfiniteListSkeleton</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;필터링 될 내용들&#39;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">hasNextPage</span><span class="p">,</span> <span class="nx">fetchNextPage</span><span class="p">,</span> <span class="nx">refetch</span><span class="p">,</span> <span class="nx">isFetching</span> <span class="p">}</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useInfiniteQuery</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;apiRequestFunction&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">({</span> <span class="nx">pageParam</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">})</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// FetchList 함수는 axios로 api에 request 보내는 함수입니다. (파라미터로 필터링 될 내용을 받습니다.)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">FetchList</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nx">pageParam</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;필터링 될 내용들&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 다음 페이지는 offset 으로 확인합니다.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">getNextPageParam</span><span class="o">:</span> <span class="p">(</span><span class="nx">lastPage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">lastPage</span><span class="p">.</span><span class="nx">next</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">lastPage</span><span class="p">.</span><span class="nx">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="nx">lastOffset</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">lastOffset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">lastOffset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">staleTime</span>: <span class="kt">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheTime</span>: <span class="kt">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">keepPreviousData</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">refetchOnMount</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">refetchOnWindowFocus</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 1. 모달로 오픈할 거면 (커스텀 훅)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">useDialog</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">openModal</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span>: <span class="kt">Results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dialog</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">description</span><span class="o">:</span> <span class="p">&lt;&gt;&lt;/&gt;,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">catchOnCancel</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">submitText</span><span class="o">:</span> <span class="s1">&#39;네&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cancleText</span><span class="o">:</span> <span class="s1">&#39;닫기&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">variant</span><span class="o">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">props</span>: <span class="kt">props</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">then</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="k">catch</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">&lt;&gt;&lt;/&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 2. 페이지 이동후 스크롤 Y 값을 저장하여 해당 위치로 바로 보여지게 할 경우
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">scrollY</span><span class="p">,</span> <span class="nx">setScrollY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useLocalStorage</span><span class="p">(</span><span class="s1">&#39;someScroll&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">scrollY</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">scrollY</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setScrollY</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 필터가 적용되면 offset을 초기화하고 처음부터 로딩되어야 합니다.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isRefreshing</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">refetch</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setIsRefreshing</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">isRefreshing</span><span class="p">,</span> <span class="nx">refetch</span><span class="p">,</span> <span class="nx">setIsRefreshing</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// useRef를 이용하여 해당 Ref를 하단에 두고 보여지면 다음 페이지를 로딩합니다.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">loadMoreButtonRef</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// https://developer.mozilla.org/ko/docs/Web/API/IntersectionObserver
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">useIntersectionObserver</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">root</span>: <span class="kt">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">target</span>: <span class="kt">loadMoreButtonRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onIntersect</span>: <span class="kt">fetchNextPage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enabled</span>: <span class="kt">hasNextPage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* 로딩중일때 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">isFetching</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">LoadingDiv</span> <span class="p">/&gt;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="cm">/* 리스트를 표시합ㄴ디ㅏ. */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">page</span><span class="p">)</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">page</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">props</span>: <span class="kt">Results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// data-aos 로 애니메이션 효과를 줍니다. (라이브러리 설치 필요))
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="na">data</span><span class="err">-</span><span class="na">aos</span><span class="o">=</span><span class="s">&#39;fade-up&#39;</span> <span class="na">data</span><span class="err">-</span><span class="na">aos</span><span class="err">-</span><span class="na">duration</span><span class="o">=</span><span class="s">&#39;200&#39;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">{</span><span class="cm">/* 1. 모달로 오픈할꺼면 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">openModal</span><span class="p">(</span><span class="nx">props</span><span class="p">)}&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nx">Click</span> <span class="nx">$</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">to</span> <span class="nx">open</span> <span class="nx">Modal</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">{</span><span class="cm">/* 2. 페이지 이동할거면 */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">Link</span>
</span></span><span class="line"><span class="cl">                <span class="na">href</span><span class="o">=</span><span class="p">{{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">pathname</span><span class="o">:</span> <span class="sb">`url/</span><span class="si">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">props</span>: <span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">}}</span>
</span></span><span class="line"><span class="cl">                <span class="na">as</span><span class="o">=</span><span class="p">{</span><span class="sb">`url/</span><span class="si">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="na">passHref</span>
</span></span><span class="line"><span class="cl">              <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">a</span>
</span></span><span class="line"><span class="cl">                  <span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`url/</span><span class="si">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">setScrollY</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">                <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">Click</span> <span class="nx">$</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">to</span> <span class="nx">navigate</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">)))}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="cm">/* 로딩중 표시를 하고 ref가 focus 될때 (리스트의 끝일때) 마다 다음 리스트를 로딩합니다. */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">hasNextPage</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">LoadingDiv</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">fetchNextPage</span><span class="p">()}</span> <span class="na">className</span><span class="o">=</span><span class="s">&#39;text-center&#39;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">)}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">loadMoreButtonRef</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">InfiniteListSkeleton</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="apirequestfunctionjs"><code>apiRequestFunction.js</code><a hidden class="anchor" aria-hidden="true" href="#apirequestfunctionjs">#</a></h4>
<p>앞에서 limitOffsetPagination 으로 만든 API를 불러옵니다. 상황에 따라서 params가 추가될 수 있습니다. (필터링 조건 등)</p>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; pages &gt; api &gt; index.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">apiRequestFunction</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">...</span> <span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">?limit=</span><span class="si">${</span><span class="nx">limit</span><span class="si">}</span><span class="sb">&amp;offset=</span><span class="si">${</span><span class="nx">offset</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="useintersectionobserverjs"><code>useIntersectionObserver.js</code><a hidden class="anchor" aria-hidden="true" href="#useintersectionobserverjs">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; hooks &gt; useIntersectionObserver.js
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useIntersectionObserver</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">root</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">target</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onIntersect</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">threshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rootMargin</span> <span class="o">=</span> <span class="s2">&#34;0px&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IntersectionObserver</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">entries</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span> <span class="o">&amp;&amp;</span> <span class="nx">onIntersect</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">root</span><span class="o">:</span> <span class="nx">root</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rootMargin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">threshold</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">observer</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">target</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">threshold</span><span class="p">,</span> <span class="nx">rootMargin</span><span class="p">,</span> <span class="nx">onIntersect</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="useobserverjs"><code>useObserver.js</code><a hidden class="anchor" aria-hidden="true" href="#useobserverjs">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; hooks &gt; useObserver.js
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useIntersectionObserver</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">root</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">target</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onIntersect</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">threshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rootMargin</span> <span class="o">=</span> <span class="s2">&#34;0px&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IntersectionObserver</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">entries</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span> <span class="o">&amp;&amp;</span> <span class="nx">onIntersect</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">root</span><span class="o">:</span> <span class="nx">root</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rootMargin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">threshold</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">observer</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">target</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">threshold</span><span class="p">,</span> <span class="nx">rootMargin</span><span class="p">,</span> <span class="nx">onIntersect</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h3 id="infinitescroll--modal">infiniteScroll + Modal<a hidden class="anchor" aria-hidden="true" href="#infinitescroll--modal">#</a></h3>
<p>모달은 <a href="https://github.com/theodorusclarence/expansion-pack/blob/main/dialog-zustand/README.md" target="_blank">theodorusclarence/expansion-pack</a>의 <code>Dialog using Zustand</code>를 설치 후 커스텀하였습니다. 설치하면 <code>DialogZustandLayout.tsx</code> 샘플이 생깁니다. 이를 참고하여 수동으로 Layout.tsx 를 수정해주어야합니다.</p>
<h4 id="layouttsx"><code>Layout.tsx</code><a hidden class="anchor" aria-hidden="true" href="#layouttsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; layout &gt; Layout.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">React</span> <span class="kr">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">BaseDialog</span> <span class="kr">from</span> <span class="s2">&#34;@/components/dialog/BaseDialog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Footer</span> <span class="kr">from</span> <span class="s2">&#34;@/components/layout/Footer&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">useDialogStore</span> <span class="kr">from</span> <span class="s2">&#34;@/store/useDialogStore&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Header</span> <span class="kr">from</span> <span class="s2">&#34;./Header&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Layout</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}</span><span class="o">:</span> <span class="p">{</span> <span class="nx">children</span>: <span class="kt">React.ReactNode</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">open</span> <span class="o">=</span> <span class="nx">useDialogStore</span><span class="p">.</span><span class="nx">useOpen</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">useDialogStore</span><span class="p">.</span><span class="nx">useState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleClose</span> <span class="o">=</span> <span class="nx">useDialogStore</span><span class="p">.</span><span class="nx">useHandleClose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleSubmit</span> <span class="o">=</span> <span class="nx">useDialogStore</span><span class="p">.</span><span class="nx">useHandleSubmit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Header</span> <span class="na">mode</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;min-h-full font-primary&#34;</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">BaseDialog</span>
</span></span><span class="line"><span class="cl">        <span class="na">onClose</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClose</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">open</span><span class="o">=</span><span class="p">{</span><span class="nx">open</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">options</span><span class="o">=</span><span class="p">{</span><span class="nx">state</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Footer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="usedialogtsx"><code>useDialog.tsx</code><a hidden class="anchor" aria-hidden="true" href="#usedialogtsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; hooks &gt; useDialog.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">useDialogStore</span> <span class="kr">from</span> <span class="s2">&#34;@/store/useDialogStore&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useDialog() {</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">useDialogStore</span><span class="p">.</span><span class="nx">useDialog</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>여기까지 진행되면 모달을 열 수 있는 환경이 구성됩니다. <code>src &gt; components &gt; dialog &gt; baseDialog.tsx</code> 가 모달창입니다. 원래는 <code>submt</code>이나 <code>error</code>를 확인하는 모달이였으므로 리스트에서 클릭하여 모달이 열릴때 <code>props</code>를 같이 받아올 수 있도록 해당 내용을 커스텀 해줍니다. <code>options</code>에 <code>props</code>를 추가하면 됩니다.</p>
<h4 id="basedialogtsx"><code>baseDialog.tsx</code><a hidden class="anchor" aria-hidden="true" href="#basedialogtsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; components &gt; dialog &gt; baseDialog.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">BaseDialogProps</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">open</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onSubmit</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onClose</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">options</span>: <span class="kt">DialogOptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">type</span> <span class="nx">DialogOptions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">catchOnCancel?</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">title</span>: <span class="kt">React.ReactNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">description</span>: <span class="kt">React.ReactNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">variant</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span> <span class="o">|</span> <span class="s2">&#34;warning&#34;</span> <span class="o">|</span> <span class="s2">&#34;danger&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">submitText</span>: <span class="kt">React.ReactNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cancleText</span>: <span class="kt">React.ReactNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">props</span>: <span class="kt">Results</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">BaseDialog</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">open</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onSubmit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onClose</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="nx">variant</span><span class="p">,</span> <span class="nx">submitText</span><span class="p">,</span> <span class="nx">cancleText</span><span class="p">,</span> <span class="nx">props</span> <span class="p">},</span> <span class="c1">// &lt;-- 추가
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="o">:</span> <span class="nx">BaseDialogProps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">colorVariant</span><span class="p">[</span><span class="nx">variant</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">Transition.Root</span> <span class="na">show</span><span class="o">=</span><span class="p">{</span><span class="nx">open</span><span class="p">}</span> <span class="na">as</span><span class="o">=</span><span class="p">{</span><span class="nx">React</span><span class="p">.</span><span class="nx">Fragment</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Dialog</span>
</span></span><span class="line"><span class="cl">        <span class="na">as</span><span class="o">=</span><span class="s">&#34;div&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">static</span>
</span></span><span class="line"><span class="cl">        <span class="na">className</span><span class="o">=</span><span class="s">&#34;fixed inset-0 z-40 overflow-y-auto&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">open</span><span class="o">=</span><span class="p">{</span><span class="nx">open</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">onClose</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">onClose</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;flex min-h-screen items-start justify-center px-5 py-5 text-center drop-shadow-xl sm:block sm:p-0 md:mt-16&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">Transition.Child</span>
</span></span><span class="line"><span class="cl">            <span class="na">as</span><span class="o">=</span><span class="p">{</span><span class="nx">React</span><span class="p">.</span><span class="nx">Fragment</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="na">enter</span><span class="o">=</span><span class="s">&#34;ease-out duration-300&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">enterFrom</span><span class="o">=</span><span class="s">&#34;opacity-0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">enterTo</span><span class="o">=</span><span class="s">&#34;opacity-100&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leave</span><span class="o">=</span><span class="s">&#34;ease-in duration-300&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leaveFrom</span><span class="o">=</span><span class="s">&#34;opacity-100&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leaveTo</span><span class="o">=</span><span class="s">&#34;opacity-0&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">Dialog.Overlay</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;fixed inset-0 bg-black bg-opacity-75 transition-opacity&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">Transition.Child</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">span</span>
</span></span><span class="line"><span class="cl">            <span class="na">className</span><span class="o">=</span><span class="s">&#34;hidden sm:inline-block sm:h-screen sm:align-middle&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">aria</span><span class="err">-</span><span class="na">hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&amp;</span><span class="err">#</span><span class="mi">8203</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">Transition.Child</span>
</span></span><span class="line"><span class="cl">            <span class="na">as</span><span class="o">=</span><span class="p">{</span><span class="nx">React</span><span class="p">.</span><span class="nx">Fragment</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="na">enter</span><span class="o">=</span><span class="s">&#34;ease-out duration-300&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">enterFrom</span><span class="o">=</span><span class="s">&#34;opacity-0 trangray-y-4 sm:trangray-y-0 sm:scale-95&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">enterTo</span><span class="o">=</span><span class="s">&#34;opacity-100 trangray-y-0 sm:scale-100&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leave</span><span class="o">=</span><span class="s">&#34;ease-in duration-200&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leaveFrom</span><span class="o">=</span><span class="s">&#34;opacity-100 trangray-y-0 sm:scale-100&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">leaveTo</span><span class="o">=</span><span class="s">&#34;opacity-0 trangray-y-4 sm:trangray-y-0 sm:scale-95&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;z-auto inline-block w-full transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:my-12 sm:min-h-[1000px] sm:max-w-6xl sm:p-6 sm:align-middle&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;absolute top-0 right-0  block pt-4 pr-4&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">button</span>
</span></span><span class="line"><span class="cl">                  <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">clsx</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;rounded-md bg-white text-gray-400 hover:text-gray-500&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;disabled:cursor-wait disabled:brightness-90 disabled:filter&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">)}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClose</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;sr-only&#34;</span><span class="p">&gt;</span><span class="nx">Close</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">HiOutlineX</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;h-6 w-6&#34;</span> <span class="na">aria</span><span class="err">-</span><span class="na">hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span><span class="cm">/* 불러온 props를 표시해주면 됩니다. */</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span><span class="nx">props</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;mt-5 sm:mt-4 sm:flex sm:flex-row-reverse&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">Button</span>
</span></span><span class="line"><span class="cl">                  <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="na">variant</span><span class="o">=</span><span class="s">&#34;outline&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClose</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">className</span><span class="o">=</span><span class="s">&#34;font mt-3 w-full items-center justify-center !font-medium sm:mt-0 sm:w-auto sm:text-sm&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span><span class="nx">cancleText</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">Button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">Transition.Child</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">Dialog</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">Transition.Root</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">colorVariant</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">success</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bg</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">light</span><span class="o">:</span> <span class="s2">&#34;bg-green-100&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">primary</span><span class="o">:</span> <span class="s2">&#34;text-green-500&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">icon</span>: <span class="kt">HiOutlineCheck</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">warning</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bg</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">light</span><span class="o">:</span> <span class="s2">&#34;bg-yellow-100&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">primary</span><span class="o">:</span> <span class="s2">&#34;text-yellow-500&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">icon</span>: <span class="kt">HiOutlineExclamation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">danger</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bg</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">light</span><span class="o">:</span> <span class="s2">&#34;bg-red-100&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">primary</span><span class="o">:</span> <span class="s2">&#34;text-red-500&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">icon</span>: <span class="kt">HiExclamationCircle</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<h4 id="usedialogstoretsx"><code>useDialogStore.tsx</code><a hidden class="anchor" aria-hidden="true" href="#usedialogstoretsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      src &gt; store &gt; useDialogStore.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createSelectorHooks</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;auto-zustand-selectors-hook&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">produce</span> <span class="kr">from</span> <span class="s2">&#34;immer&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">create</span> <span class="kr">from</span> <span class="s2">&#34;zustand&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">DialogOptions</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@/components/dialog/BaseDialog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">DialogStoreType</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">awaitingPromise</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolve</span><span class="o">?:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">reject</span><span class="o">?:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">open</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span>: <span class="kt">DialogOptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span>: <span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">DialogOptions</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleClose</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleSubmit</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">useDialogStoreBase</span> <span class="o">=</span> <span class="nx">create</span><span class="p">&lt;</span><span class="nt">DialogStoreType</span><span class="p">&gt;((</span><span class="kr">set</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">awaitingPromise</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">open</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">title</span><span class="o">:</span> <span class="s2">&#34;Title&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">description</span><span class="o">:</span> <span class="s2">&#34;Description&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">submitText</span><span class="o">:</span> <span class="s2">&#34;Yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cancleText</span><span class="o">:</span> <span class="s2">&#34;No&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">variant</span><span class="o">:</span> <span class="s2">&#34;warning&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">catchOnCancel</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">props</span>: <span class="kt">null</span><span class="p">,</span> <span class="c1">// &lt;-- 추가
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">produce</span><span class="p">&lt;</span><span class="nt">DialogStoreType</span><span class="p">&gt;((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="p">...</span><span class="nx">options</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">produce</span><span class="p">&lt;</span><span class="nt">DialogStoreType</span><span class="p">&gt;((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">state</span><span class="p">.</span><span class="nx">awaitingPromise</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleClose</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">produce</span><span class="p">&lt;</span><span class="nt">DialogStoreType</span><span class="p">&gt;((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">catchOnCancel</span> <span class="o">&amp;&amp;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">awaitingPromise</span><span class="o">?</span><span class="p">.</span><span class="nx">reject</span><span class="o">?</span><span class="p">.();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleSubmit</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">produce</span><span class="p">&lt;</span><span class="nt">DialogStoreType</span><span class="p">&gt;((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">awaitingPromise</span><span class="o">?</span><span class="p">.</span><span class="nx">resolve</span><span class="o">?</span><span class="p">.();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">useDialogStore</span> <span class="o">=</span> <span class="nx">createSelectorHooks</span><span class="p">(</span><span class="nx">useDialogStoreBase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">useDialogStore</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>이제 아까 만들었던 <a href="/projects/%ED%81%90%EC%B0%BE%EC%82%AC/infinitescroll/#infinitelistskeletontsx">(예제리스트)</a>처럼 <code>openModal</code> 함수에서 <code>props</code>를 함께 넘겨주어 모달이 열릴때 미리 받아온 데이터를 넘겨받을 수 있습니다.</p>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      openModal with props
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="cm">/* 1. 모달로 오픈할꺼면 */</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">openModal</span><span class="p">(</span><span class="nx">props</span><span class="p">)}&gt;</span><span class="nx">Click</span> <span class="nx">$</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">to</span> <span class="nx">open</span> <span class="nx">Modal</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>console에 찍어보면 다음과 같습니다. 맨 처음 리스트를 불러올 때 모달에 들어갈 내용들도 함께 불러왔으므로 모달이 열릴때 추가로 api에서 불러올 필요가 없어서 <strong>즉각</strong>적으로 표시되어 로딩속도가 빠르게 느껴지는 장점이 있습니다.</p>
<figure class="align-center ">
    <img loading="lazy" src="../img/4.png#center"/> 
</figure>

<p>응용하여 모달창이 열렸을 때 새로고침을 할 경우 router.push 하여 해당 아이템의 상세페이지로 이동하게 할 수 있습니다. 빠른 반응을 위해서 리스트에서 클릭 시에만 모달이 열리고, 새로고침, 링크공유, SEO 최적화 위해 상세페이지를 제작해 두는 것이 좋습니다.</p>
<h3 id="infinitescroll--localstorage--scrolly">infiniteScroll + LocalStorage + ScrollY<a hidden class="anchor" aria-hidden="true" href="#infinitescroll--localstorage--scrolly">#</a></h3>
<p>리스트에서 아이템을 클릭할 때 <code>scrollY</code>값을 <code>LocalStorage</code>에 저장하고, <code>useEffect</code>를 이용하여 <code>scrollY가 0이 아닌 경우</code>에는 <code>LocalStorage</code>에 저장된 <code>scrollY</code> 값으로 이동시켜주면 됩니다. <code>Next/Link</code>를 사용할때 <code>onClick</code> 이벤트를 발생시키기 위해서 <code>a 태그</code>를 중첩시켜주어야 합니다.</p>
<h4 id="listexampletsx"><code>ListExample.tsx</code><a hidden class="anchor" aria-hidden="true" href="#listexampletsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      ListExample.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ListExample</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">hasNextPage</span><span class="p">,</span> <span class="nx">fetchNextPage</span><span class="p">,</span> <span class="nx">refetch</span><span class="p">,</span> <span class="nx">isFetching</span> <span class="p">}</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useInfiniteQuery</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">loadMoreButtonRef</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">useIntersectionObserver</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">root</span>: <span class="kt">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">target</span>: <span class="kt">loadMoreButtonRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onIntersect</span>: <span class="kt">fetchNextPage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enabled</span>: <span class="kt">hasNextPage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 스크롤 값을 확인
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">scrollY</span><span class="p">,</span> <span class="nx">setScrollY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useLocalStorage</span><span class="p">(</span><span class="s1">&#39;PostListScroll&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">React</span><span class="p">.</span><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">scrollY</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">scrollY</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setScrollY</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">isFetching</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nt">LoadingDiv</span> <span class="p">/&gt;}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">page</span><span class="p">)</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">page</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">post</span>: <span class="kt">Results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="na">data</span><span class="err">-</span><span class="na">aos</span><span class="o">=</span><span class="s">&#39;fade-up&#39;</span> <span class="na">data</span><span class="err">-</span><span class="na">aos</span><span class="err">-</span><span class="na">duration</span><span class="o">=</span><span class="s">&#39;200&#39;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">Link</span>
</span></span><span class="line"><span class="cl">                <span class="na">href</span><span class="o">=</span><span class="p">{{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">pathname</span><span class="o">:</span> <span class="sb">`community/post/</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">post</span>: <span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">}}</span>
</span></span><span class="line"><span class="cl">                <span class="na">as</span><span class="o">=</span><span class="p">{</span><span class="sb">`community/post/</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="na">passHref</span>
</span></span><span class="line"><span class="cl">              <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">a</span>
</span></span><span class="line"><span class="cl">                  <span class="na">href</span><span class="o">=</span><span class="p">{</span><span class="sb">`community/post/</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">setScrollY</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">)}</span> <span class="err">//</span> <span class="na">클릭시에</span> <span class="na">해당</span> <span class="na">y값을</span> <span class="na">저장해줌</span>
</span></span><span class="line"><span class="cl">                <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">Link</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">)}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">loadMoreButtonRef</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">ListExample</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<p>콘솔을 찍어보면 다음과 같습니다.
<figure class="align-center ">
    <img loading="lazy" src="../img/5.gif#center"/> 
</figure>
</p>
<p><code>LocalStorage</code>를 초기화 해주는 조건을 <code>Header나 다른 감싸지는 컴포넌트</code>에 추가해주어서 <code>A리스트 &gt; B리스트 &gt; A리스트</code>로 다른 리스트를 거쳐 돌아왔을때 A리스트의 scrollY값을 초기화 해주는 것도 필요합니다.</p>
<p>저의 경우엔 Header에 추가주었습니다.</p>
<h4 id="headertsx"><code>header.tsx</code><a hidden class="anchor" aria-hidden="true" href="#headertsx">#</a></h4>


<div class="terminal space shadow">
  <div class="top">
    <div class="btns">
      <span class="circle red"></span>
      <span class="circle yellow"></span>
      <span class="circle green"></span>
    </div>
    <div class="title">
      header.tsx
    </div>
  </div>
  <div class="terminalbody"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[,</span> <span class="nx">setCommunityScrollY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useLocalStorage</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;(</span><span class="s1">&#39;PostListScroll&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">NavigateCommunity</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setCommunityScrollY</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/community&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setMobileNavOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[,</span> <span class="nx">setFindcueScrollY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useLocalStorage</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;(</span><span class="s1">&#39;CueListScroll&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">NavigateFindCue</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setFindcueScrollY</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/findcue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setMobileNavOpen</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
</div>
<br />

<br>
<h3 id="마치며">마치며<a hidden class="anchor" aria-hidden="true" href="#마치며">#</a></h3>
<p>이제 무한 스크롤을 구현할 때 상황에 따라서 모달로 열거나 새로운 페이지 이동 후 뒤로가기시 로딩된 값은 다시 불러오지 않고 해당 값으로 다시 돌아오게 할 수 있습니다.</p>
<h4 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">#</a></h4>
<ul>
<li><a href="https://github.com/theodorusclarence/ts-nextjs-tailwind-starter">https://github.com/theodorusclarence/ts-nextjs-tailwind-starter</a></li>
<li><a href="https://github.com/theodorusclarence/expansion-pack">https://github.com/theodorusclarence/expansion-pack</a></li>
<li><a href="https://tanstack.com">https://tanstack.com</a></li>
<li><a href="https://developer.mozilla.org/ko/docs/Web/API/IntersectionObserver">https://developer.mozilla.org/ko/docs/Web/API/IntersectionObserver</a></li>
<li><a href="https://velog.io/@hdpark">https://velog.io/@hdpark</a></li>
</ul>
<hr>
<p><strong>궁금하신 점이 있으시면 아래 Comments 남겨주세요 👇</strong></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cha2hyun.blog/tags/next.js/">Next.js</a></li>
      <li><a href="https://cha2hyun.blog/tags/react-query/">React Query</a></li>
      <li><a href="https://cha2hyun.blog/tags/infinite-scroll/">Infinite Scroll</a></li>
      <li><a href="https://cha2hyun.blog/tags/modal/">Modal</a></li>
      <li><a href="https://cha2hyun.blog/tags/localstorage/">LocalStorage</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cha2hyun.blog/content/projects/%ED%81%90%EC%B0%BE%EC%82%AC/ssrandseo/">
    <span class="title">« Prev</span>
    <br>
    <span>SSR를 이용한 SEO 최적화 (구글, 네이버 최상단 노출 성공)</span>
  </a>
  <a class="next" href="https://cha2hyun.blog/content/posts/nestjs-graphql-kakao-jwt/">
    <span class="title">Next »</span>
    <br>
    <span>첫 Boilerplate 템플릿 (NestJS 카카오 OAuth 및 jwt토큰 이용하기)</span>
  </a>
</nav>


<div
  style="
    padding-top: 15px;
    padding-bottom: 2px;
    font-size: x-large;
    font-weight: 700;
  "
>
  궁금하신 점이 있으신가요? 😀
</div>



<script
  src="https://utteranc.es/client.js"
  repo="cha2hyun/blog-comments"
  issue-term="title"
  theme="boxy-light"
  crossorigin="anonymous"
  async
></script>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://cha2hyun.blog/">채수현 개발일지</a></span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
